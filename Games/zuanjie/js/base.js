/** * Created by lipei on 2015/5/20. */var Page;!function () {    Page = {        pageList : [],        curPage : 0,        work : function () {            var self = this;            Page.pageList[self.curPage].addDom(function(){                Page.pageList[self.curPage].loading(function(){                    Page.pageList[self.curPage].init(function(){                        self._pageAnimate(self.curPage,"enter","none");                    })                })            });        },        gotoPage : function (pageid,leave_config,enter_config) {            var self = this;            var numargs = arguments.length; // 获取被传递参数的数值。            var expargs = this.gotoPage.length; // 获取期望参数的数值。            Page.pageList[pageid].addDom(function(){                Page.pageList[pageid].loading(function(){                    Page.pageList[pageid].init(function(){                        self._pageAnimate(self.curPage,"leave",leave_config.mode);                        if(numargs==2){                            self._pageAnimate(pageid,"enter",leave_config.mode);                        }else{                            self._pageAnimate(pageid,"enter",enter_config.mode);                        }                        self.curPage = pageid;                    });                });            });        },        gotoNext : function (leave_config,enter_config){            var self = this;            self.gotoPage(self.curPage+1,leave_config,enter_config)        },        gotoPrev : function (leave_config,enter_config) {            var self = this;            self.gotoPage(self.curPage-1,leave_config,enter_config)        },        _pageAnimate : function(id_,status_,mode_) {            var self = this;            var value1,value2;            var h = document.documentElement.clientHeight;            var w = document.documentElement.clientWidth;            switch (mode_){                case "up" :                case "down" :                case "left" :                case "right" :                    if (status_ == "enter"){                        value2 = 0;                        if (mode_ == "up")value1 = h;                        if (mode_ == "down")value1 = -h;                        if (mode_ == "left")value1 = w;                        if (mode_ == "right")value1 = -w;                    }else{                        value1 = 0;                        if (mode_ == "up")value2 = -h;                        if (mode_ == "down")value2 = h;                        if (mode_ == "left")value2 = -w;                        if (mode_ == "right")value2 = w;                    }                    if (mode_ == "up" || mode_ == "down"){                        $(Page.pageList[id_].element_).css({"position":"absolute","left":0,"top":0,"transform":"translate3d(0,"+ value1 +"px,0)"});                        setTimeout(function(){                            $(Page.pageList[id_].element_).css({"transition":"all 1000ms","transform":"translate3d(0,"+ value2 +"px,0)"});                        },100);                    }else{                        $(Page.pageList[id_].element_).css({"transform": "matrix(1, 0, 0, 1, " + value1 + ", 0)"});                        $(Page.pageList[id_].element_).css({"transition":"all 1000ms"});                        $(Page.pageList[id_].element_).css({"transform":"matrix(1, 0, 0, 1, " + value2 + ", 0)"});                    }                    setTimeout(function () {                        $(Page.pageList[id_].element_).css({"transition":""});                        if (status_ == "enter"){Page.pageList[id_].onEnter();}else{Page.pageList[id_].onLeave();}                    },1100);                    //$(self.element_).one("webkitTransitionEnd otransitionEnd transitionEnd",function(){                    //                    //});                    break;                case "none" :                    if (status_ == "enter"){Page.pageList[id_].onEnter();}else{Page.pageList[id_].onLeave();}                    break;                default :                    self._animateExtend[mode_](arguments);                    break;            }        }    }}();var BaseMgr;!function () {    BaseMgr = function (element_,pageName_) {        this.element_ = element_;        this.pageName_ = pageName_;    };    BaseMgr.prototype = {        init : function () {            console.log(this.pageName_+ " run!");        },        addDom : function (Callback_) {            var self_ = this;            $(this.element_).load(this.pageName_, function (responseTxt, statusTxt, xhr) {                console.log(self_.pageName_ + " add!");                if(Callback_)Callback_();            });        },        //n:需要合并的对象 override:是否重写        extend : function (n,override) {            for(var p in n)if(n.hasOwnProperty(p) && (!this.hasOwnProperty(p) || override))this[p]=n[p];        }    }}();var loadingMgr;/** * loadingMgr示例 * loadingMgr.loadImages({    isshow : false,    complete : function () {    } }); */!function () {    loadingMgr = {        loadImages: function (Parameter) {            var element = $("body");            if(element.find("#loading").size()>0 && Parameter.isshow){                $("#loading").stop(true).fadeIn(200);            }else{            }            //element.find("#loading").find(".percent").remove();            //element.find("#loading").append("<div class='percent'>0%</div>");            var self_ = this;            var sources = Parameter.loadArr;            var loadingPercent = "";            var count = 0;            var images = {};            var imgNum = sources.length;            for (var src in sources) {                var path = src;                images[path] = new Image();                images[path].onload = function () {                    count++;                    loadingPercent = self_.fix(Math.ceil(100/imgNum*count),2)+"%";                    Parameter.process(loadingPercent);                    //console.log(loadingPercent);                    if (count >= imgNum) {                        $("#loading").stop(true).fadeOut(200);                        Parameter.complete(images);                    }                };                images[path].src = sources[path];            }        },        fix :function (num, length) {            return ('' + num).length < length ? ((new Array(length + 1)).join('0') + num).slice(-length) : '' + num;        }    }}();var PageMgr;!function () {    PageMgr = function(element_,pageName_){        BaseMgr.call(this,element_,pageName_);        this.pageid = Page.pageList.length;        this.loadingFinish = false;        Page.pageList.push(this);        this.extend({            init : function (Callback_) {                this.element = $(this.element_);                this.beforeEnter();                Callback_();            },            loading : function (Callback_) {                var self = this;                var arr = [];                var reg = /url\((.*)\)/ig;                $(self.element_).find("img").each(function(){                    arr.push($(this).attr("src"));                });                $(self.element_).find("[class]").each(function(){                    var img = reg.exec($(this).css("background"));                    if(img != null){arr.push(img[1])}                });                if(self.loadImg instanceof Array){arr = arr.concat(self.loadImg);}                if(arr.length == 0 || self.loadingFinish){                    Callback_();                    return;                }                loadingMgr.loadImages({                    loadArr : arr,                    process : function (e) {                        $("body").find("#loading").find(".percent").html(e);                    },                    complete : function(){                        console.log("loading finish!");                        self.loadingFinish = true;                        Callback_();                    },                    isshow : true                });                //console.log(arr);            },            beforeEnter : function () {                console.log("版块进入前无执行数据");            },            onEnter : function () {                console.log("版块进入无执行数据");            },            onLeave : function () {                console.log("版块离开无执行数据");            }        })    };    PageMgr.prototype = new BaseMgr();}();