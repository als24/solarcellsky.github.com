! function(e) {
    "PageShare".sReg(function() {
        return e.Class.extend({
            init: function(t) {
                var n = this;
                n.duan = "GD", e.inGod || (n.duan = "WX", n._weixinInit())
            },
            setLink: function(e) {
                var t = "",
                    n = e.match(/([^\?#]*\??)([^#]*)?(#.*)?/),
                    o = n[1],
                    a = void 0 === n[2] ? "" : n[2],
                    i = void 0 === n[3] ? "" : n[3];
                "" !== a ? t = o + a + "&" : "" === a && o.indexOf("?") < 0 ? t = o + "?" : "" === a && o.indexOf("?") >= 0 && (t = o);
                var r = {
                    weibo: t + "gd_from=weibo" + i,
                    weixin: t + "gd_from=weixin" + i,
                    pengyou: t + "gd_from=pengyou" + i
                };
                return r
            },
            setNoShareTimeline: function() {
                var e = this;
                e.shareNoTimeline = !0
            },
            _shareGD: function(e) {
                var t = this,
                    n = t.setShareObj(),
                    o = [];
                t.shareNoTimeline || o.push({
                    type: "pengyou",
                    title: n.quan || n.desc,
                    url: n.pengyou,
                    imgUrl: n.imgUrl
                }), o.push({
                    type: "weixin",
                    message: n.desc,
                    title: n.wxTitle,
                    url: n.weixin,
                    imgUrl: n.imgUrl
                }), new API.Share({
                    content: o
                }, function(t) {
                    var n = {
                        result: t.result
                    };
                    n.log = "share_result_" + t.type + "_" + t.result, e ? $("body").trigger(e, n) : $("body").trigger("share_native", n)
                })
            },
            _shareWX: function(e) {
                var t = this;
                wx.ready(function() {
                    wx.checkJsApi({
                        jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage", "hideMenuItems"],
                        success: function(n) {
                            t.shareNoTimeline && wx.hideMenuItems({
                                menuList: ["menuItem:share:timeline"]
                            });
                            var o = t.setShareObj();
                            n.checkResult.onMenuShareAppMessage && wx.onMenuShareAppMessage({
                                title: o.title,
                                desc: o.desc,
                                link: o.weixin,
                                imgUrl: o.imgUrl,
                                success: function(t) {
                                    var n = {
                                        type: "pengyou",
                                        status: 1,
                                        log: "share_result_ok_pengyou"
                                    };
                                    e ? $("body").trigger(e, n) : $("body").trigger("share_weixin", n)
                                },
                                error: function(t) {
                                    var n = {
                                        type: "pengyou",
                                        status: 0,
                                        log: "share_result_error_pengyou"
                                    };
                                    e ? $("body").trigger(e, n) : $("body").trigger("share_weixin", n)
                                },
                                cancel: function(e) {
                                    setTimeout(function() {
                                        document.body.scrollTop = document.body.scrollTop + 1
                                    }, 0)
                                }
                            }), n.checkResult.onMenuShareTimeline && wx.onMenuShareTimeline({
                                title: o.quan || o.desc,
                                link: o.pengyou,
                                imgUrl: o.imgUrl,
                                success: function(e) {
                                    var t = {
                                        type: "weixin",
                                        status: 1,
                                        log: "share_result_ok_weixin"
                                    };
                                    $("body").trigger("share_weixin", t)
                                },
                                error: function(e) {
                                    var t = {
                                        type: "weixin",
                                        status: 0,
                                        log: "share_result__weixin"
                                    };
                                    $("body").trigger("share_weixin", t)
                                }
                            })
                        }
                    })
                })
            },
            _weixinInit: function() {
                var e = this;
                e.share()
            },
            getShareInfo: function(t) {
                var n = [{
                        title: "打开后领取1G流量",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "打开后领取100元加油卡",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "打开后领取1辆奔驰Smart",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！1G流量给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！100元加油卡给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！1辆奔驰Smart给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }],
                    o = [{
                        title: "打开后领取1G流量",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "打开后领取100元加油卡",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "打开后领取1辆奔驰Smart",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！1G流量给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！100元加油卡给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }, {
                        title: "说！1辆奔驰Smart给你要不要！",
                        desc: "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"
                    }],
                    a = ["2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。", "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。", "2.5亿兆流量、3000万加油卡、16辆Smart。你懂的。"],
                    i = a[e.random(0, a.length + n.length - 1)],
                    r = t ? o : n;
                return r = r[e.random(0, r.length - 1)], {
                    wxTitle: r.title,
                    title: r.title,
                    desc: r.desc,
                    quan: i,
                    imgUrl: "img/hongbao.png"
                }
            },
            setShareObj: function(e) {
                void 0
            },
            share: function(e) {
                var t = this;
                t["_share" + t.duan](e)
            }
        })
    })
}(God),
function(e) {
    "ChestShare".sReg(function() {
        return e.PageShare.extend({
            setShareObj: function() {
                var t = this,
                    n = this.getShareInfo(!e.inGod);
                n.link = e.inGod ? e.common.urlConfig.wap + "activity/digger/game_wx.html" : e.global.shareid ? e.common.urlConfig.wap + "activity/digger/game_wx.html?shareGDId=" + e.global.shareid : e.common.urlConfig.wap + "activity/digger/game_wx.html";
                var o = t.setLink(n.link);
                return n.weibo = o.weibo, n.weixin = o.weixin, n.pengyou = o.pengyou, n
            }
        })
    })
}(God),
function(e) {
    $("body").on("share_native", function(t, n) {
        e.pageLog.sendLog(n.log)
    }).on("share_weixin", function(t, n) {
        e.pageLog.sendLog(n.log)
    })
}(God), ! function(e, t) {
    var n = {
        init: function() {
            this.addEvt()
        },
        addEvt: function() {
            e.document.onclick = function(e) {
                var t = e.target.className;
                ("friend" === e.target.id || t.indexOf("shareagain") >= 0 || t.indexOf("sharetimeline") >= 0) && n.popWin()
            }
        },
        popWin: function() {
            if (t.getElementById("popup")) t.getElementById("popup").style.display = "block";
            else {
                var e = t.createElement("div");
                e.setAttribute("id", "popup"), e.style.display = "block", e.innerHTML = '<img src="http://h4.amap.com/activity/digger/img/share_smart-08a5395f.png"/>', e.addEventListener("click", function(e) {
                    e.preventDefault(), t.getElementById("popup").style.display = "none"
                }, !1), t.body.appendChild(e)
            }
        }
    };
    e.Pop = n
}(window, document), ! function() {
    function e() {
        u || (u = !0, new API.weixinAwardHome(t))
    }

    function t(e) {
        function t() {
            e.timestamp > e.data.end_time ? God.widget.car.init("#car", l, 0, e.data.limited_end) : God.widget.car.init("#car", l, e.data.limited_st, e.data.limited_end), God.widget.car.flyIn(e.data.pieces.list)
        }
        if (u = !1, e.data.open_share || (a.setNoShareTimeline(), a.share()), God.pageLog.sendLog("getData_" + e.code), 1 == e.code) d ? t() : l.onload = t, God.widget.clock.init(1e3 * e.timestamp), God.day101.set101(e.data.end_time), i = new Date(1e3 * e.data.start_time), r = new Date(1e3 * e.data.end_time), s = e.data, n(e.data), e.data.mobile_bind || $(".bind-mobile").show(), God.common.setHasLogin(), $("#body").show();
        else {
            if (14 == e.code || 18 == e.code) return void God.common.goWxAuth(location.href, void 0, "info");
            God.pageLog.sendLog("treasures_weixinAwardHome_wx_error"), setTimeout(function() {
                location.href = "error_wx.html"
            }, 400)
        }
    }

    function n(e) {
        $(".myPiece").html("我的Smart碎片：已获得" + e.pieces.list.length + "块"), 20 == e.pieces.list.length && ($(".i-win").show(), $(".invite").remove(), $(".overdue").remove()), ! function() {
            var t, n = e.pieces.list.length;
            20 === n ? t = ["恭喜您赢得Smart"] : 0 === n ? t = ["世界那么大，你却一块Smart碎片都没有。"] : 4 > n ? t = ["千里之行始于碎片，努力的人运气不会差", "你的人生巅峰就从这块碎片开始了！", "这半亩汽车矿是你的了，开始努力挖吧~"] : 7 > n ? t = ["继续攒碎片，Smart百分百是你的（吧）", "挖挖挖…哇！土里是可以长汽车的！", "桃花潭水深千尺，怒挖碎片是正事！"] : 10 > n ? t = ["你已攒齐三个轮子和218颗螺丝钉~干巴爹~", "轻点按~你一定不想看到一块“屏幕碎片”", "洛阳亲友如相问，就说我在挖碎片~"] : 13 > n ? t = ["大喜！半辆车入手，陛下请宣旨大赦天下~", "攒够半辆了！基友前来祝贺，准备请客吧！", "喜大普奔，半辆车入手，偷着乐去吧！"] : 16 > n ? t = ["嘘……好多碎片了，80%的人都在眼红你~", "总裁V587，汽车碎片都被你承包了吧！", "低调，看过《一块碎片引发的血案么》？"] : 19 > n ? t = ["再来一发，就能get新技能“碎片变汽车”！", "我们一致认为你该准备一本驾照了~", "这么多块了……你的手机屏幕还好嘛？"] : 19 === n && (t = ["想要最后一块碎片吗？去抢吧！我把Smart都放在那里了！", "抢到最后一块碎片可以100%召唤一辆Smart！", "你已经有19块碎片了！但抢不到最后一块就然并卵了！"]);
            var o = t[God.random(0, t.length - 1)];
            $(".piece-intro").text(o).show()
        }(), ! function() {
            $(".fuel-sum").html(e.fuel.sum + "元"), $(".fuel-can-exchange").html(e.fuel.real + "元油卡"), $(".fuel-validity").html("有效期：" + e.fuel.validity);
            var t = [30, 50, 100];
            if (e.fuel.accepted) t.length = 0, $("#fuel_use").hide(), $(".btn-fuel").removeClass("btn-update").addClass("btn-use").attr("data-real", e.fuel.real).html("去使用"), $(".fuel-more").html("券码:" + e.fuel.awardid);
            else {
                for (var n = t.length - 1; n >= 0; n--) t[n] <= e.fuel.real && t.splice(n, 1);
                t.length && $(".fuel-more").html("继续挖宝还有：" + t.join("元油卡、") + "元油卡"), 3 == t.length && ($(".fuel-can-exchange").html("30元油卡"), $(".btn-fuel").removeClass("btn-update").addClass("btn-none").html("领取"))
            }
            $(".btn-fuel")[0].dataset.awardid = e.fuel.awardid, $(".part-fuel").show(), o($(".btn-fuel"))
        }(), ! function() {
            $(".flux-sum").html(e.traffic.sum + "MB"), $(".flux-validity").html("有效期：" + e.traffic.validity);
            var t = (1e3 == e.traffic.real ? "1000M" : e.traffic.real + "M") + "B流量包";
            if ($(".flux-can-exchange").html(t), e.traffic.accepted) $(".btn-flux").removeClass("btn-update").removeClass("btn-notyet").addClass("btn-use").html("去使用"), $("#flux_use").hide(), $(".flux-more").hide();
            else {
                for (var n = ["100MB", "200MB", "500MB", "1000MB"], a = n.length - 1; a >= 0; a--) parseInt(n[a]) <= e.traffic.real && ("1000MB" == n[a] && e.traffic.real >= 1e3 || "1000MB" != n[a]) && n.splice(a, 1);
                n.length ? $(".flux-more").html("继续挖宝还有：" + n.join("、")) : $(".flux-more").hide(), 4 == n.length && ($(".flux-can-exchange").html("100MB流量包"), $(".btn-flux").removeClass("btn-update").addClass("btn-none").html("领取"))
            }
            $(".part-flux").show(), o($(".btn-flux"))
        }(), ! function() {
            $(".coupon-sum").html(e.coupon.info.count + "张");
            var t = $("#coupon"),
                n = e.coupon.info.award_typeid;
            if (e.coupon.list.length)
                for (var o = 0; o < e.coupon.list.length; o++) {
                    var a = e.coupon.list[o],
                        i = $("<div>").addClass("award-part-cont"),
                        d = $("<div>").addClass("icon icon-coupon").appendTo(i);
                    $("<i>").css("background-image", "url(" + a.picurl + ")").appendTo(d);
                    var l = $("<div>").addClass("info").appendTo(i);
                    $("<h4>").text(a.name || "").appendTo(l), $("<p>").addClass("validity").text("有效期：" + a.validity).appendTo(l), a.awardid && $("<p>").addClass("code").html("券码：<strong>" + a.awardid + "</strong>").appendTo(l);
                    var s = $("<div>");
                    if (a.accepted) var u = $("<button>").addClass("btn-go btn-use").html("去使用").appendTo(s);
                    else {
                        var c = God.widget.clock.getTime();
                        if (c > r) var u = $("<button>").addClass("btn-go btn-overdue").html("已过期").appendTo(s);
                        else var u = $("<button>").addClass("btn-go btn-update").html("领取").appendTo(s)
                    }
                    s.appendTo(l), u[0].dataset.type = "coupon", u[0].dataset.typeid = a.typeid, u[0].dataset.awardid = n, t.append(i)
                } else $(".no-coupon").show();
            $(".part-coupon").show()
        }()
    }

    function o(e) {
        for (var t = God.day101.isEnd(), n = 0; n < e.length; n++) {
            var o = e.eq(n);
            o.removeClass("btn-notyet btn-overdue"), t ? o.hasClass("btn-use") || o.addClass("btn-overdue").html("已过期") : God.day101.is101() || o.hasClass("btn-use") || o.addClass("btn-notyet").html("领取")
        }
        t ? $(".overdue").show() : ($(".overdue").hide(), $(".invite").show())
    }
    God.global.shareid = 0;
    var a = new God.ChestShare;
    Pop.init();
    var i, r, d = !1,
        l = document.createElement("img");
    l.src = "http://h2.amap.com/activity/digger/img/car-81562dbb.png", l.onload = function() {
        d = !0
    };
    var s = {};
    God.event.on("click", ".error-btn-refresh", function() {
        $(this).hasClass("disable") || (God.pageLog.sendLog("error_refresh"), e())
    });
    var u = !1;
    God.event.on("click", ".btn-go", function() {
        function e() {
            God.pageLog.sendLog("go_exchange_" + n)
        }
        God.pageLog.sendLog("btn_go_click");
        var t = $(this);
        if (t.hasClass("btn-overdue")) return God.pageLog.sendLog("btn_go_overdue"), void God.widget.alert.alert("本次活动已经结束，不能再领取奖品");
        if (!s.mobile_bind) return God.pageLog.sendLog("btn_go_bind"), void God.widget.alert.alert("请绑定手机后领取奖品哦！", {
            text: "下次再说"
        }, {
            text: "绑定手机",
            callback: function() {
                God.util.locationRedirect("bind_wx.html")
            }
        });
        if (t.hasClass("btn-none")) return God.pageLog.sendLog("btn_go_none"), void God.widget.alert.alert("亲，再努力一下下就能兑换奖品了哦", {
            text: "去玩游戏赚钱",
            callback: function() {
                location.href = "game_wx.html"
            }
        });
        if (t.hasClass("btn-notyet")) return God.pageLog.sendLog("btn_go_notyet"), void God.widget.alert.alert("亲，请于10月1号领取奖励哦，全天可领</div>");
        if (t.hasClass("btn-got")) return God.pageLog.sendLog("btn_go_got"), void God.widget.alert.alert("您已经领取过这个奖品了");
        if (t.hasClass("btn-use")) {
            God.pageLog.sendLog("btn_go_use");
            var n = this.dataset.type;
            if ("fuel" == n) {
                var o = "?real=" + t.attr("data-real");
                location.href = "undefined" != typeof God.inGod && God.inGod ? "prod_fuel.html" + o : "prod_fuel_wx.html" + o
            } else "flux" == n ? location.href = "undefined" != typeof God.inGod && God.inGod ? "prod_flux.html" : "prod_flux_wx.html" : "coupon" == n && (location.href = "undefined" != typeof God.inGod && God.inGod ? "prod.html?id=" + this.dataset.typeid + "&award_typeid=" + this.dataset.awardid : "prod_wx.html?id=" + this.dataset.typeid + "&award_typeid=" + this.dataset.awardid)
        } else {
            if (!God.inGod) {
                var a = God.common.urlConfig.wap + "activity/digger/game.html",
                    i = God.os + "amap://openFeature?featureName=OpenURL&sa=1&sourceApplication=banner&url=" + encodeURIComponent(a) + "&urlType=0&contentType=autonavi";
                return void window.open("http://wap.amap.com/callnative/?schema=" + encodeURIComponent(i) + "&title=" + encodeURIComponent("打开高德地图客户端"))
            }
            var r, d, n = this.dataset.type;
            switch (n) {
                case "fuel":
                    if (r = s.fuel.award_typeid, s.fuel.sum < 100) {
                        var l = 0,
                            u = "";
                        return s.fuel.sum >= 50 ? (l = 100 - s.fuel.sum, u = "100") : s.fuel.sum >= 30 && (l = 50 - s.fuel.sum, u = "50"), God.widget.alert.alert('<div style="text-align:left">请注意使用累计额度仅可兑换1次，确认兑换吗？<br/>您还差' + l + "元即可兑换" + u + "元油卡</div>", {
                            text: "再赚赚"
                        }, {
                            text: "就换这些",
                            callback: e
                        }), void God.pageLog.sendLog("btn_go_exchange_confirm")
                    }
                    break;
                case "flux":
                    if (r = s.traffic.award_typeid, s.traffic.sum < 1e3) {
                        var l = 0,
                            u = "";
                        return s.traffic.sum >= 500 ? (l = 1e3 - s.traffic.sum, u = "1000MB") : s.traffic.sum >= 200 ? (l = 500 - s.traffic.sum, u = "500MB") : s.traffic.sum >= 100 && (l = 200 - s.traffic.sum, u = "200MB"), void God.widget.alert.alert('<div style="text-align:left">请注意使用累计额度仅可兑换1次，确认兑换吗？<br/>您还差' + l + "MB即可兑换" + u + "流量</div>", {
                            text: "再赚赚"
                        }, {
                            text: "就换这些",
                            callback: e
                        })
                    }
                    break;
                case "coupon":
                    r = s.coupon.info.award_typeid, d = this.dataset.typeid
            }
            e()
        }
    }), God.event.on("tap", ".info", function() {
        $(this).children("div").children("button").trigger("click")
    }), God.event.on("tap", ".bind-mobile", function() {
        God.pageLog.sendLog("btn_bind_mobile"), location.href = "bind_wx.html"
    }), God.event.on("tap", ".btn-invite", function() {
        God.pageLog.sendLog("btn_invite")
    }), God.event.on("tap", ".btn-get-smart", function() {
        God.pageLog.sendLog("btn_get_smart");
        var e = God.common.urlConfig.wap + "activity/digger/game.html",
            t = God.os + "amap://openFeature?featureName=OpenURL&sa=1&sourceApplication=banner&url=" + encodeURIComponent(e) + "&urlType=0&contentType=autonavi";
        window.open("http://wap.amap.com/callnative/?schema=" + encodeURIComponent(t) + "&title=" + encodeURIComponent("打开高德地图客户端"))
    }), God.event.on("tap", ".btn-flaunt", function() {
        God.pageLog.sendLog("btn_flaunt")
    }), ! function() {
        God.common.checkWxAuth("info") ? (e(), new API.share_weixin(function(e) {
            if (14 == e.code) return void God.common.goWxAuth(location.href, void 0, "info");
            var t = "";
            1 == e.code ? (t = e.share_id, God.global.shareid = t) : (God.pageLog.sendLog("treasures_share_weixin_wx_error"), setTimeout(function() {
                location.href = "error_wx.html"
            }, 400))
        })) : God.common.goWxAuth(location.href, void 0, "info")
    }(), God.pageLog.sendLog("digger_treasures", "pv")
}();
