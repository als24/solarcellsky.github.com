/*! Copyright (c) ZUIKU.COM */
define(function(require,exports,module){$.Action={};var a=function(a){a=a||{};var b=$(a.currentTarget),c=(a.data,b.attr("data-action")||""),d=/^([0-9]+#)?([a-zA-Z\. ]+::)?(([a-zA-Z0-9_]+):\/\/([a-zA-Z0-9_\/]+)(#([\w\W]+))?)$/,f=d.exec(c),g=null,h=null,i=null;f&&(h=Number((f[1]||"3").replace("#","")),g=(f[2]||e.CLICK_EVENT).replace("::",""),i=f[3],function(a,b){for(var c=a.split(" "),d=c.length,e=0;d>e;e++)if(c[e]==b)return!0;return!1}(g,a.type)&&(h>0&&(e.checkBitFlag(h,1)&&a.preventDefault&&a.preventDefault(),e.checkBitFlag(h,2)&&a.stopPropagation&&a.stopPropagation()),e.requestExternal(i,[b,a])))},b=function(b){a(b)},c=function(a,b,d,f){var g=null,h=null,i=d||"";for(var j in a)if(a.hasOwnProperty(j)){if(g=a[j],h=Object.prototype.toString.call(g),"[object Array]"==h){e.execAfterMergerHandler(f,[a,g,h,i+j]);continue}"[object Object]"==h?b=c(a[j],b,i+j+"."):b[i+j]=a[j]}return b},d=function(a,b,c){for(var d=a.substring(0,a.lastIndexOf(".")),f=a.replace(d+".",""),g=d.split("."),h=g.length,i=[],j=[],k=null,l=/\[[0-9]+\]/g,m=-1,n=null,o="",p=function(a,b,c){var d=[],f=[],g=0,h=null,i=null;if(c){for(var j in c)if(c.hasOwnProperty(j)){if(f=c[j],i=Object.prototype.toString.call(f),"[object Object]"==i){d=p(a,b,f);continue}if(j===a){f=c[j],g=f.length;for(var k=0;b>k;k++)h=f[k],h&&(i=Object.prototype.toString.call(h),d.push("[object String]"==i?'"'+h.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"':"[object Object]"==i||"[object Array]"==i?JSON.stringify(h):h));return d}}}else for(var k=0;b>k;k++)d.push('"'+e.PACKAGE_HOLDER+'"');return d},q=h-1;q>=0;q--)if(k=g[q],q==h-1)l.test(k)?(n=k.substring(0,k.indexOf("[")),m=Number(k.substring(k.indexOf("[")+1,k.indexOf("]"))),o=p(n,m,c),i.push((n?'"'+n+'": [':"[")+o.concat(function(a,b){var c='"'+a+'":',d=Object.prototype.toString.call(b);return"[object String]"==d?c=c+'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"':c+="[object Object]"==d||"[object Array]"==d?JSON.stringify(b):b,c="{"+c+"}"}(f,b))+(k?"]":"]"))):i.push((k?'"'+k+'": {':"")+function(a,b){var d='"'+a+'":',e=!1;l.test(a)&&(n=a.substring(0,a.indexOf("[")),m=Number(a.substring(a.indexOf("[")+1,a.indexOf("]"))),o=p(n,m,c),e=!0,d='"'+n+'": [');var f=Object.prototype.toString.call(b);return e?(d+=o.concat("[object String]"==f?'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"':"[object Object]"==f||"[object Array]"==f?JSON.stringify(b):b),d+="]"):"[object String]"==f?d=d+'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"':d+="[object Object]"==f||"[object Array]"==f?JSON.stringify(b):b,d}(f,b)+(k?"}":""));else{var r=i.pop();if(!r)continue;l.test(k)?(n=k.substring(0,k.indexOf("[")),m=Number(k.substring(k.indexOf("[")+1,k.indexOf("]"))),o=p(n,m,c),i.push('"'+n+'": [{'+o.concat(r)+"}]")):i.push('"'+k+'": {'+r+"}")}var s=i.pop();s="{"+(s||"")+"}";var j=$.parseJSON(s);return j},e={CLICK_EVENT:"ontouchstart"in window?"tap":"click",RequestStatus:{timeout:{status:65025,text:"亲，网络不给力啊~~"},error:{status:65026,text:"亲，系统出了点小问题，请稍候片刻再试"},abort:{status:65027,text:"抱歉，您的请求被中断，请重新发起"},parsererror:{status:65028,text:"数据处理异常"},success:{status:0,text:"OK"}},PACKAGE_HOLDER:"FORMAT_PACKAGE_HOLDER",toSimpleJSONObject:c,formatPackage:d,checkBitFlag:function(a,b){return!!(a&b)&&b>0},formatData:function(a,b,d,e){var f="",g=null,h=null;d=void 0===d?"\\$":d?"\\"+d:"",d=d.replace(/\\\\/g,"\\"),a=a||"",b=c(b||{},{},"",e||null);for(var i in b)b.hasOwnProperty(i)&&(h=b[i],g=new RegExp(d+"\\!?\\{"+i.replace(/\./g,"\\.")+"\\}","gm"),f=a=a.replace(g,h),g=null);return f=f||a,g=new RegExp(d+"\\!\\{[^\\{\\}]+\\}","gm"),f=f.replace(g,""),g=null,f},formatList:function(a,b,c,d,f,g,h){var i=c.length,j=null,k=[],l=0;if(i>0&&h)"last"==h?l=i-1:"first"==h?l=0:(l=Number(h),l>=i&&(l=i-1)),j=c[l],"eachpck"in j&&(a=j.eachpck),"eachindex"in j&&(l=Number(j.eachindex)),j.eachpck=a,j.eachindex=l,j.eachsn=l+1,g&&(j=e.execAfterMergerHandler(g,[j])),k.push(e.formatData(b,j,d,f));else for(var m=0;i>m;m++)j=c[m],j.eachpck=a,j.eachindex=m,j.eachsn=m+1,g&&(j=e.execAfterMergerHandler(g,[j])),k.push(e.formatData(b,j,d,f));return k.join("\n")},formatEach:function(a,b,c,d,f,g,h){var i=/@@foreach(#(last|first|[0-9]+))?::([^\s ]+)::start([\w\W]+)@@end/gm,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=!1;for(void 0!==g&&null!==g&&""!==g&&(i=new RegExp("@@foreach(#(last|first|[0-9]+))?::([^\\s ]+)::start\\("+g+"\\)([\\w\\W]+)@@end\\("+g+"\\)","gm"));null!=(j=i.exec(a));){p=j[2]||null,k=j[3],l=j[4],q=!0,m=k.split("."),o=$.extend({},b);for(var r=0,s=m.length;s>r;r++)n=m[r],n in o&&(o=o[n]);l=e.formatList(k,l,o,c,d,f,p)}return q?(l=a.replace(i,l||h||""),i.test(l)&&(l=e.formatEach(l,b,c,d,f))):i.test(a)&&(l=e.formatEach(a,b,c,d,f)),l||a},hideAddressBar:function(){setTimeout(function(){window.scrollTo(0,1)},0)},getOrientation:function(){var a=window.orientation;return 0===a||180==a?0:90==a||-90==a?1:0},execHandler:function(a){if(a&&a instanceof Object){var b=a.callback||null,c=a.args||[],d=a.context||null,e=a.delay||-1;if(b&&b instanceof Function){if(!("number"==typeof e&&e>=0))return b.apply(d,c);setTimeout(function(){b.apply(d,c)},e)}}},execAfterMergerHandler:function(a,b){var c=$.extend({},a);if(a&&a instanceof Object){{var d=(a.callback||null,a.args||[]);a.context||null}c.args=b.concat(d)}return this.execHandler(c)},decodeHTML:function(a){var b=a.replace(/&#60;/g,"<");return b=b.replace(/&#62;/g,">"),b=b.replace(/&#34;/g,'"'),b=b.replace(/&#39;/g,"'"),b=b.replace(/&#38;/g,"&")},encodeHTML:function(a){var b=a.replace(/&/g,"&#38;");return b=b.replace(/>/g,"&#62;"),b=b.replace(/"/g,"&#34;"),b=b.replace(/'/g,"&#39;"),b=b.replace(/</g,"&#60;")},getCursorPosition:function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else"number"==typeof a.selectionStart&&(b=a.selectionStart);return b},setCursorPosition:function(a,b){setTimeout(function(){if("number"==typeof a.selectionStart)a.selectionStart=a.selectionEnd=b;else if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},15)},requestExternal:function(a,b){var c=/^([a-zA-Z0-9_]+):\/\/([a-zA-Z0-9_\/]+)(#([\w\W]+))?$/,d=c.exec(a),e=null,f=null,g=null,h=null,i=null;if(!d)return{result:void 0,code:-2};if(f=d[1],g=d[2],i=d[4]||null,e=$[f]||null){if(-1==g.indexOf("/"))h=g;else{var j=g.split("/"),k=j.length;e=function(a,b,c){for(var d=null,e=0;c-1>e;e++){if(d=b[e],!(null!=a&&d in a))return null;a=a[d]||null}return a}(e,j,k),h=j[k-1]}return null!=e&&h in e?{result:e[h].apply(null,[i].concat(b||[])),code:0}:{result:void 0,code:-1}}},setActionHook:function(a,c){var d=$(a||"body"),f=c||e.CLICK_EVENT,g=null;if("[object Array]"==Object.prototype.toString.call(f))for(var h=0;h<f.length;h++)g=d.attr("data-action-"+f[h]),"1"!=g&&(d.on(f[h],"[data-action]",b),d.attr("data-action-"+f[h],"1"));else g=d.attr("data-action-"+f),"1"!=g&&(d.on(f,"[data-action]",b),d.attr("data-action-"+f,"1"));d=null},fireAction:function(b){a(b||{type:e.CLICK_EVENT,currentTarget:actionNode,data:void 0})},injectAction:function(a){$.extend(!0,$.Action,a)},getDevicePixelRatio:function(){return window.devicePixelRatio||1},isHiddenNode:function(a){var b=a[0],c=!1,d=null;do{if(d=a.css("display"),"none"==d){c=!0;break}a=a.parent(),b=a[0]}while(b!=document.documentElement);return c},findNodeRealSize:function(a,b,c){var d=(a.css(b)||"").toLowerCase();if(d){if(-1!=d.indexOf("px"))return Number(d.substr(0,d.length-2))*c;if(-1!=d.indexOf("%"))return d=Number(d.substr(0,d.length-1)),this.findNodeRealSize(a.parent(),b,Math.round(d/100));var e=d.replace(/[^0-9]+/g,"");return e?Number(d.replace(/[^0-9]+/g,""))*c:this.findNodeRealSize(a.parent(),b,c)}return this.findNodeRealSize(a.parent(),b,c)},getNodeRealSize:function(a,b){var c=a.offset()||{width:0,height:0},d=c.width,e=c.height,f={width:d,height:e};return(0>=d||0>=e)&&(f.width=this.findNodeRealSize(a,"width",b),f.height=this.findNodeRealSize(a,"height",b)),f},getNetworkType:function(){var a=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},b=a.type||"",c=void 0===a.downlinkMax?0:a.downlinkMax,d=b;return"cellular"==b&&(d=2>c?"2g":c>=2&&42>=c?"3g":100==c?"4g":b),d},getTime:function(){return Date.now?Date.now():(new Date).getTime()},GUID:function(){var a=String(e.getTime()),b=String(0xfffffffffff*Math.random()),c=b.substring(0,b.indexOf(".")),d=b.substring(b.indexOf(".")+1);c.length>13?c=c.substr(0,13):c.length<13&&(c+=d.substr(0,13-c.length));for(var f=a+c,g=0,h="",i="",j=0;26>j;j+=2)g=Number(f.substr(j,2)),h=g.toString(16),h.length<2&&(h="0"+h),i+=h;return i},getRemainingSize:function(a,b){b=b||$(window);var c=b.outerWidth?b.outerWidth():b.width(),d=b.outerHeight?b.outerHeight():b.height(),e=(a.outerWidth?a.outerWidth():a.width(),a.outerHeight?a.outerHeight():a.height()),f=a.offset(),g=f.left,h=f.top;return{height:d-(h+e),width:c-g}},asDataURL:function(a,b){var c=new FileReader;c.onload=function(a){e.execAfterMergerHandler(b,[a,a.target.result])},c.onerror=function(a){e.execAfterMergerHandler(b,[a,null])},c.readAsDataURL(a)},asBlob:function(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})},register:function(a,b){return window[a]=b,e},unregister:function(a){return a in window&&delete window[a],e},getRegisterValue:function(a){return a in window?window[a]:void 0},getFileSize:function(a){var b=Math.pow(2,10),c=Math.pow(2,20),d=Math.pow(2,30),e=Math.pow(2,40),f=a+"Bytes";return a>=e?f=(a/e).toFixed(2)+"TB":a>=d?f=(a/d).toFixed(2)+"GB":a>=c?f=(a/c).toFixed(2)+"MB":a>=b&&(f=(a/b).toFixed(2)+"KB"),f},delay:function(a,b){var c=e.getTime();setTimeout(function(){var a=e.getTime(),d=a-c;e.execAfterMergerHandler(b,[d])},a)}};module.exports=e});