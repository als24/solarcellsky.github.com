/*! Copyright (c) ZUIKU.COM */
define(function(require,exports,module){var a={parse:function(a){var b=window.name,c=new RegExp("/"+a.key+"=(\\{[\\w\\W]*\\})/","g"),d=c.exec(b),e="{}";return e=d?d[1]:window[a.key]||"{}"},get:function(a,b){var c=b.get(a),d=null,e=null,f=null;return null!=c?e=c.value:(d=this.parse(b),f=$.parseJSON(d),a in f&&(c=b.expired(f[a])?null:f[a],e=null==c?null:c.value)),e},remove:function(a,b){var c=this.parse(b);b.db=$.parseJSON(c),b.remove(a),this.flush(b)},clear:function(a){a.clear(),this.flush(a)},flush:function(a){window[a.key]=a.toString(),window.name="/"+a.key+"="+a.toString()+"/"}},b=function(a){this.key="SE_"+a.toUpperCase()+"_BLOCK",this.db=this.initDB(a)};b.prototype={initDB:function(b){var c="{}";if("name"==b)c=a.parse(this);else try{c=window[b].getItem(this.key)||"{}"}catch(d){c="{}"}return $.parseJSON(c)},expired:function(a,b){if(b&&b.expired){var c=(new Date).getTime(),d=c-b.expired>=0;return!0===d&&this.remove(a),d}return!1},put:function(a,b){this.db[a]=b},get:function(a){if(a in this.db){var b=this.db[a];return this.expired(a,b)?null:b}return null},remove:function(a){a in this.db&&delete this.db[a]},clear:function(){this.db={}},toString:function(){var a={};for(var b in this.db)this.db.hasOwnProperty(b)&&(this.expired(b,this.db[b])?this.remove(b):a[b]=this.db[b]);return JSON.stringify(a)}};var c=new b("localStorage"),d=new b("sessionStorage"),e=(new b("name"),{supported:-1,set:function(a,b,d){c.put(a,{value:b,expired:d||0,timestamp:(new Date).getTime()}),this.flush()},get:function(b){var d=c.get(b),e=null,f=null,g=null;return null!=d?f=d.value:this.support()?(e=window.localStorage.getItem(c.key)||"{}",g=$.parseJSON(e),b in g&&(d=c.expired(g[b])?null:g[b],f=null==d?null:d.value)):f=a.get(b,c),f},remove:function(b){var d=null;this.support()?(d=window.localStorage.getItem(c.key)||"{}",c.db=$.parseJSON(d),c.remove(b),this.flush()):a.remove(b,c)},clear:function(){this.support()?(c.clear(),this.flush()):a.clear(c)},flush:function(){this.support()?window.localStorage.setItem(c.key,c.toString()):a.flush(c)},support:function(){var a=!1,b="SE_CACHE_SUPPORT",c=this.supported;if(-1!=c)return c;try{var d=window.localStorage;d.setItem(b,"1"),a="1"==d.getItem(b),this.supported=a,d.removeItem(b)}catch(e){}finally{return a}}}),f={supported:-1,set:function(a,b){d.put(a,{value:b,expired:0,timestamp:(new Date).getTime()}),this.flush()},get:function(b){var c=d.get(b),e=null,f=null,g=null;return null!=c?f=c.value:this.support()?(e=window.sessionStorage.getItem(d.key)||"{}",g=$.parseJSON(e),b in g&&(c=d.expired(g[b])?null:g[b],f=null==c?null:c.value)):f=a.get(b,d),f},remove:function(b){var c=null;this.support()?(c=window.sessionStorage.getItem(d.key)||"{}",d.db=$.parseJSON(c),d.remove(b),this.flush()):a.remove(b,d)},clear:function(){this.support()?(d.clear(),this.flush()):a.clear(d)},flush:function(){this.support()?window.sessionStorage.setItem(d.key,d.toString()):a.flush(d)},support:function(){var a=!1,b="SE_CACHE_SUPPORT",c=this.supported;if(-1!=c)return c;try{var d=window.sessionStorage;d.setItem(b,"1"),a="1"==d.getItem(b),this.supported=a,d.removeItem(b)}catch(e){}finally{return a}}};module.exports={Persistent:e,Session:f}});