;/*!/static/common/utils.js*/
define("mactivity:static/common/utils",function(t,e,n){var r={format:function(t,e){return t.replace(/\{(\w+)\}/g,function(t,n){return"undefined"==typeof e[n]||null==e[n]?"":e[n]})},getNoPicUrl:function(){return"images/nopic.gif"},stretchImg:function(t,e,n,i,o){var a=new Image;t.onerror=function(){this.src=r.getNoPicUrl(),this.style.display=""},a.onload=function(){var r,a,l,c,s=this.width,u=this.height,d=Math.max(e/s,n/u);o&&(d=Math.min(e/s,n/u)),r=parseInt(d*s,10)||e,a=parseInt(d*u,10)||n,t.style.width=r+"px",t.style.height=a+"px",c=parseInt((n-a)/2,10),l=parseInt((e-r)/2,10),i&&$(t).css({"margin-top":c,"margin-left":l}),t.style.display=""},a.src=t.src},reloadImg:function(t){function e(t){r.css("visibility","visible").show().attr("src",t)}var n=this,r=t.find("img");r=r[0]?r:t,r.css("visibility","hidden").hide();var i=r.attr("src"),o=new Image;o.onload=function(){e(i)},o.onerror=function(){e(n.getNoPicUrl())},o.src=i},errorImg:function(t){t.src=r.getNoPicUrl()},getPartnerslink:function(t,e,n){return t&&e&&n?e+"&"+$.param($.extend({},n,{from:"inf",fun:t})):e||""},dateFormat:function(t,e){var n=t,r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in r)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[i]:("00"+r[i]).substr((""+r[i]).length)));return e},jstime:function(t){t?(this.__start&&(this.__time=this.__time||[],this.__time.push(t+":"+((new Date).getTime()-this.__start)+"ms")),this.__start=(new Date).getTime()):alert(this.__time.join("\n"))},getStrLength:function(t){var e=t.match(/[^\x00-\xff]/gi);return t.length+(null==e?0:e.length)},SubString:function(t,e){var n=/[^\x00-\xff]/g;if(t.replace(n,"mm").length<=e)return t;for(var r=Math.floor(e/2),i=r;i<t.length;i++)if(t.substr(0,i).replace(n,"mm").length>=e)return t.substr(0,i);return t},scrollController:function(t,e){var n=$(t)[0].getBoundingClientRect().bottom-Math.min(document.documentElement.clientHeight,document.body.clientHeight),r=document.body.scrollTop,i=document.documentElement.scrollTop,o=0,a=(new Date).getTime(),l=1,c=setInterval(function(){var t=(new Date).getTime(),s=Math.min(1,(t-a)/e),u=o+(n-o)*s;document.body.scrollTop=r+u,document.documentElement.scrollTop=i+u,s>=l&&(clearInterval(c),document.body.scrollTop=r+n,document.documentElement.scrollTop=i+n)},15)},getParams:function(t){var e,n,r,i={};if(t=t||window.location.href,-1==t.indexOf("?"))return i;for(n=t.slice(t.indexOf("?")+1).split("&"),r=0;r<n.length;r++)n[r]&&-1!=n[r].indexOf("=")&&(e=n[r].split("="),e[1]&&(i[e[0]]=-1!=e[1].indexOf("#")?e[1].slice(0,e[1].indexOf("#")):e[1]));return i},getParam:function(t,e){return this.getParams(e)[t]},now:function(){return(new Date).getTime()},getRandomCDN:function(){return"http://webmap"+Math.floor(3*Math.random())+".map.bdimg.com"},thumbnails:function(t){var e,n;return t=$.extend({width:100,height:100,align:"center,center",quality:80,cdn:!0},t),e=t.cdn,delete t.cdn,n="/maps/services/thumbnails?"+$.param(t),e?this.getRandomCDN()+n:n},encodeHTML:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},urlToJSON:function(t){if(!t)return{};var e,n,r,i={},o=t.split("&");for(e=0,r=o.length;r>e;e++)n=o[e].split("="),i[n[0]]=decodeURIComponent(n[1]);return i},jsonToUrl:function(t){if(!t)return"";var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e+"="+encodeURIComponent(t[e]));return n.join("&")},loadJs:function(t,e,n){var r=document.getElementsByTagName("head")[0],i=null;null==document.getElementById(t)?(i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",e),i.setAttribute("id",t),null!=n&&(i.onload=i.onreadystatechange=function(){return i.ready?!1:void(i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(i.ready=!0,n()))}),r.appendChild(i)):null!=n&&n()},isAndroid:function(){var t=navigator.userAgent;return/android/i.test(t)}};n.exports=r});
;/*!/static/common/NABridge.js*/
define("mactivity:static/common/NABridge",function(r,e,t){var n={count:0,getScheme:function(){var r="bdwm://";return r},getHost:function(){var r="waimai";return r},getBridge:function(){return null==window.WebViewJavascriptBridge?"":WebViewJavascriptBridge},openOutUrl:function(r,e){var t=this,n="",i=t.getScheme(),a=t.getHost(),c="?tag="+(null==r?"":r),d="&data="+(null==e?"":o.encode(JSON.stringify(e)));return n=i+a+c+d},openInUrl:function(r,e,t){var n=this,o=null==r?"":r,i=null==e?"":JSON.stringify(e),a=n.getBridge(),c=n.count;if(window.android){var d="_na_web_callback_"+c++ +"_"+(new Date).getTime();android.sendMsgToNa(o,i,d),window[d]=function(r){t(r),delete window[d]}}else a&&a.callHandler(o,i,t)}},o={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(r){var e,t,n,i,a,c,d,h="",f=0;for(r=o._utf8_encode(r);f<r.length;)e=r.charCodeAt(f++),t=r.charCodeAt(f++),n=r.charCodeAt(f++),i=e>>2,a=(3&e)<<4|t>>4,c=(15&t)<<2|n>>6,d=63&n,isNaN(t)?c=d=64:isNaN(n)&&(d=64),h=h+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(c)+this._keyStr.charAt(d);return h},decode:function(r){var e,t,n,i,a,c,d,h="",f=0;for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<r.length;)i=this._keyStr.indexOf(r.charAt(f++)),a=this._keyStr.indexOf(r.charAt(f++)),c=this._keyStr.indexOf(r.charAt(f++)),d=this._keyStr.indexOf(r.charAt(f++)),e=i<<2|a>>4,t=(15&a)<<4|c>>2,n=(3&c)<<6|d,h+=String.fromCharCode(e),64!=c&&(h+=String.fromCharCode(t)),64!=d&&(h+=String.fromCharCode(n));return h=o._utf8_decode(h)},_utf8_encode:function(r){r=r.replace(/\r\n/g,"\n");for(var e="",t=0;t<r.length;t++){var n=r.charCodeAt(t);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},_utf8_decode:function(r){for(var e="",t=0,n=c1=c2=0;t<r.length;)n=r.charCodeAt(t),128>n?(e+=String.fromCharCode(n),t++):n>191&&224>n?(c2=r.charCodeAt(t+1),e+=String.fromCharCode((31&n)<<6|63&c2),t+=2):(c2=r.charCodeAt(t+1),c3=r.charCodeAt(t+2),e+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),t+=3);return e}};t.exports=n});
;/*!/widget/common/platformInvoke/invoke.js*/
define("mactivity:widget/common/platformInvoke/invoke",function(e,i,o){var t=e("mactivity:static/common/utils"),a=e("mactivity:static/common/NABridge"),n=t.getParam("vmgdb")||"",s=n.substr(0,4),r=(t.getParam("channel")||"",t.getParam("third_party")||""),p=t.getParam("open_type")||"",m=t.getParam("jump_to")||"",d="/static/mactivity/images/share-icon_08f6f8f.jpg",h=location.href,l=navigator.userAgent,c=/micromessenger/.test(l.toLowerCase())?!0:!1,u={home:"bdwm://native?pageName=home",coupon:"bdwm://native?pageName=coupon",myComment:"bdwm://native?pageName=myComment",userCenter:"bdwm://native?pageName=userCenter",orderList:"bdwm://native?pageName=orderList",address:"bdwm://native?pageName=address",search:"bdwm://native?pageName=search",pinzhi:"bdwm://native?pageName=webview&url=http%3A%2F%2Fwaimai.baidu.com%2Fstatic%2Fpinzhi2%2Findex.html%23%2F"},f=function(e){e&&"function"==typeof e&&(window.BNJS&&"object"==typeof window.BNJS&&BNJS._isAllReady?e():document.addEventListener("BNJSReady",function(){e()},!1))},v=function(e){e&&"function"==typeof e&&(window.WMApp&&"object"==typeof window.WMApp?e():document.addEventListener("WMAppReady",function(){e()},!1))};WMAppInvoke=function(){if(!c&&"webapp"===g.platform&&"outside"===p){var e,i=t.getParams(h);i.sign&&delete i.sign,i.open_type&&delete i.open_type;var o="";u[m]?o=u[m]:(e=encodeURIComponent(location.href.split("?")[0]+"?"+$.param(i)),o="bdwm://native?pageName=webview&url="+e),location.href=o,null!=l.match(/iPhone|iPod/i)&&setTimeout(function(){document.location="https://itunes.apple.com/cn/app/bai-du-wai-mai-mei-shi-you/id911686788?mt=8"},200),null!=l.match(/Android/i)&&setTimeout(function(){location.href="http://bcscdn.baidu.com/lbsapp//BaiduWaimai.apk"},500)}},setTimeout(WMAppInvoke,1e3);var g={platform:"webapp",time:1e3,selector:{shoplist:"[invoke-shoplist]",shopmenu:"[invoke-shopmenu]",book:"[invoke-book]",universallink:"[invoke-universallink]"},token:{appId:"",timestamp:"",nonceStr:"",signature:""},platforms:["webapp","wmapp","bainuo","box","wise","map","newapp"],shareInfo:{title:"百度外卖",desc:"百度外卖，只做有品质的外卖",link:location.href,imgUrl:location.origin+String(d),headerTitle:document.title||"百度外卖",invokeMask:!1},setShare:function(e){$.extend(this.shareInfo,e),"wmapp"===this.platform?this.setShareWMApp():"box"===this.platform?this.setShareWMApp():"wise"===this.platform?this.setShareBox():"newapp"===this.platform?this.setShareNewApp():this.setShareWX()},setShareWMApp:function(){try{window.android&&/^([0-2]\..*|3\.0\.1)$/.test(window.appversion)&&delete this.shareInfo.imgUrl;var e="&open_type=outside";"no"==this.shareInfo.open_type&&(e=""),this.shareInfo.link=p?this.shareInfo.link:this.shareInfo.link+e,a.openInUrl("setWXShareParams",this.shareInfo,function(){})}catch(i){}},webappJumpTo:function(e,i){c?(0==$("#invokeMask").length&&($("body").append('<div id="invokeMask"></div>'),self.shareInfo.invokeMask||$("#invokeMask").css({"background-image":"url(http://waimai.baidu.com/static/open_in_browser.png)","background-repeat":"no-repeat","background-size":"contain"}),self.shareInfo.invokeMask&&$("#invokeMask").html("<img src='"+this.shareInfo.invokeMask+"'>")),$("#invokeMask").removeClass("hide").addClass("show")):"shopmenu"===e?location.href="bdwm://native?pageName=shopMenu&shopId="+i.shopId:"shoplist"==e?location.href="bdwm://native?pageName=shopList&taste="+i.taste+"&promotion="+i.promotion:"home"===e&&(location.href="bdwm://native?pageName=home")},setShareBox:function(){var e={successcallback:"onSuccess",errorcallback:"onFail",options:{type:"url",mediaType:"all",title:this.shareInfo.title,content:this.shareInfo.desc,iconUrl:this.shareInfo.imgUrl,imageUrl:this.shareInfo.imgUrl,linkUrl:this.shareInfo.link}};"android"===Box.os.name&&Box.version_compare(Box.version,"6.5")<0&&delete e.options.imageUrl},setShareWX:function(){var e=this.shareInfo,i=$.extend({debug:!1,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]},this.token);wx.config(i),wx.ready(function(){wx.onMenuShareAppMessage(e),wx.onMenuShareTimeline(e)})},setShareNewApp:function(){WMApp.page.setTitleBar({titleText:this.shareInfo.headerTitle,titleClickAble:0,actionText:"分享",actionClickAble:1});var e="&open_type=outside";"no"==this.shareInfo.open_type&&(e="");var i=p?this.shareInfo.link:this.shareInfo.link+e,o={imageUrl:this.shareInfo.imgUrl,title:this.shareInfo.title,description:this.shareInfo.desc,linkUrl:i};WMApp.entry.setPageAction("onActionClick",function(){WMApp.share.share(o)})},invokePlatformAPI:function(e,i,o,t){if((i||"shopmenu"!==e)&&-1!==$.inArray(this.platform,this.platforms)){var a={};if("string"==typeof i){var n=i&&i.split(",")||[];a.shopId=n[0],a.url=n[0],a.dishId=n[1]||"",a.dishActivityId=n[2]||"",a.categoryId=n[3]||"",a.is_store=o||n[4]||"",a.shopName=t}else a=i;this["invoke"+this.platform+"API"](e,a)}},invokenewappAPI:function(e,i){if("url"===e){var o={pageName:"webview",pageParams:{url:encodeURIComponent(i.url)||"",header:i.header||1,scrollViewBounces:i.scrollViewBounces||0,pageData:i.pageData||{}}};WMApp.page.changePage(o)}else if("native"===e){var o={pageName:i.pageName||"home",pageParams:{shopId:i.shopId,categoryId:i.categoryId,dishId:i.dishId,dishActivityId:i.dishActivityId,taste:i.taste,promotion:i.promotion,title:i.title,orderId:i.orderId,itemId:i.itemId,addToCart:i.addToCart||1,products:i.products}};WMApp.page.changePage(o)}else"book"===e?location.href=i.url:"shoplist"===e?WMApp.page.changePage({pageName:"shopList",pageParams:{taste:i.taste||"",promotion:i.promotion||"",title:i.title||""}}):"shopmenu"===e&&WMApp.page.changePage(1==i.is_store?{pageName:"superMarket",pageParams:{shopId:i.shopId,itemId:i.itemId,addToCart:i.addToCart||1}}:{pageName:"shopMenu",pageParams:{shopId:i.shopId,categoryId:i.categoryId||"",dishId:i.dishId||"",dishActivityId:i.dishActivityId||""}})},invokewebappAPI:function(e,i){var o=this,a="http://a.app.qq.com/o/simple.jsp?pkgname=com.baidu.lbs.waimai",n=function(){"outside"===p?c&&(0==$("#invokeMask").length&&($("body").append('<div id="invokeMask"></div>'),o.shareInfo.invokeMask||$("#invokeMask").css({"background-image":"url(http://waimai.baidu.com/static/open_in_browser.png)","background-repeat":"no-repeat","background-size":"contain"}),o.shareInfo.invokeMask&&$("#invokeMask").html("<img src='"+this.shareInfo.invokeMask+"'>")),$("#invokeMask").removeClass("hide").addClass("show")):location.href=a};if("url"===e)i.openInWeb=0==i.openInWeb?!1:!0,i.openInWeb?location.href=i.url:n();else if("book"===e){var s=decodeURIComponent(t.getParam("url",i.url));location.href="undefined"!==s?me.getUniversalLink(s):a}else n()},invokewmappAPI:function(e,i){if("book"===e)location.href=i.url;else if("shoplist"===e)a.openInUrl("jumpToShopList",{taste:"",promotion:"",sortby:""},"");else if("shopmenu"===e){var o=window.appversion.split("."),t=!1;o.length&&(t=o[0]>3||3==o[0]&&o[1]>2||3==o[0]&&2==o[1]&&o[2]>=1),1==i.is_store?t?a.openInUrl("jumpToNewShopMenu",{shop_id:i.shopId,dish_id:i.dishId,dish_activity_id:i.dishActivityId,category_id:i.categoryId},""):alert("该版本不支持超市商户，请殿下升级新版本哦～"):a.openInUrl("jumpToShopMenu",{release_id:i.shopId,shop_id:i.shopId,dish_id:i.dishId,dish_activity_id:i.dishActivityId,category_id:i.categoryId},"")}},invokebainuoAPI:function(e,i){"url"===e?f(function(){var e=encodeURIComponent(i.url);BNJS.page.start("bainuo://component?url="+e)}):"native"===e?f(function(){BNJS.page.start("bainuo://component?compid=waimai&comppage="+i.comppage,{type:i.type||"shoplist",name:i.title,taste:i.taste||0,promotion:i.promotion||0,sortby:i.sortby||""})}):"book"===e||"shoplist"===e?f(function(){BNJS.page.start("bainuo://component?compid=waimai&comppage=shoplist")}):"shopmenu"===e&&f(function(){BNJS.page.start("bainuo://component?compid=waimai&comppage=shopinfo",{shop_name:i.shopName,shop_id:i.shopId,dish_id:i.dishId,category_id:i.categoryId,wm_action:i.addToCart||"put"})})},invokeboxAPI:function(e,i){this.invokewiseAPI(e,i)},invokewiseAPI:function(e,i){var o=i.shopId,i={shoplist:{website_url:"http://waimai.baidu.com/mobile/waimai?qt=shoplist&vmgdb="+n,params:"http://waimai.baidu.com/mobile/waimai/vmgdb="+n,o2o:"http://waimai.baidu.com?vmgdb="+n},shopmenu:{website_url:"http://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+o+"&vmgdb="+n,params:"http://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+o+"&vmgdb="+n,o2o:"http://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+o+"&vmgdb="+n},book:{website_url:"http://waimai.baidu.com/mobile/waimai?qt=shoplist&vmgdb="+n,params:"http://waimai.baidu.com/mobile/waimai/vmgdb="+n,o2o:"http://waimai.baidu.com?vmgdb="+n}},t=i[e];if("undefined"!=typeof Box&&Box.isBox){if("android"===Box.os.name)if(Box.version_compare(Box.version,"6.6")>=0){var a={website_url:t.website_url,params:t.params,app_id:"2533830",package_name:"com.baidu.searchbox.takeout",method_name:"url_invoke",from:"web:life",log_url:"null",use_new_window:"0",log_header:"null"};Box.android.invokeApp("Bdbox_android_plugin","invokePlugin",JSON.stringify(a))}else Box.o2o(t.o2o);else if("ios"===Box.os.name)if(Box.version_compare(Box.version,"6.7.0.1")>=0){var s=t.website_url,a={url:s,plugin_id:"box.plugin.waimai"};Box.ios.invokeApp("invokePlug",{action:"open",params:encodeURIComponent(JSON.stringify(a)),minver:"6.1.0.0"},"")}else Box.o2o(t.o2o)}else location.href=t.website_url},invokemapAPI:function(e,i){var o="baidumap://map/component?comName=takeout&target=loadfromWebView&param=";if("book"===e||"shoplist"===e){var t={entering_from:"web_view",page:"shoplist"};window.location.href=o+JSON.stringify(t)}else if("shopmenu"===e){var t={entering_from:"web_view",page:"shopmenu",qid:"da_qid",shop_id:i.shopId};window.location.href=o+JSON.stringify(t)}},onEvents:function(){var e=this;$("body").delegate(this.selector.shoplist,"click",function(i){i.preventDefault(),e.invokePlatformAPI("shoplist",$(this).attr("invoke-shoplist"))}).delegate(this.selector.book,"click",function(i){i.preventDefault(),e.invokeBookAction(this)}).delegate(this.selector.universallink,"click",function(i){i.preventDefault(),location.href=e.getUniversalLink($(this).attr("invoke-universallink"))}).delegate("#invokeMask","click",function(){$(this).removeClass("show").addClass("hide")})},getUniversalLink:function(e){var i;return i=-1!=e.indexOf("http://waimai.baidu.com")?e:"/"==e[0]?"http://waimai.baidu.com"+e:"http://waimai.baidu.com"+location.pathname+"/"+e},invokeBookAction:function(e){var i=this;i.invokePlatformAPI("book",$(e).attr("invoke-book"))},clearTimer:function(){clearTimeout(this.timer)},init:function(){g.timer=setTimeout(function(){g.clearTimer();var e=["wmapp","newapp","bainuo","wise"];-1===e.indexOf(g.platform)&&(window.Box&&window.Box.isBox&&(g.platform="box"),g.setShare(),g.onEvents())},g.time)},isAndroid:function(){var e=navigator.userAgent;return/android/i.test(e)}};f(function(){return g.platform="bainuo",BNJS.ui.title.setTitle(document.title),g.onEvents(),BNJS.location.address?void 0:void BNJS.ui.showErrorPage("您的定位未打开，请打开定位后重试~")}),a.openInUrl("getAppVersion","",function(e){window.appversion=e.result,g.platform="wmapp",g.setShare(),g.onEvents()}),v(function(){g.platform="newapp",setTimeout(function(){g.setShare(),g.onEvents()},0)}),"0010"===s?g.platform="wise":"0020"===s&&(g.platform="box"),"map"===r&&(g.platform="map"),o.exports={init:function(e,i){$.extend(g.token,e),$.extend(g.shareInfo,i),g.init()},jumpTo:function(e,i,o,t){g.invokePlatformAPI(e,i,o,t)},bainuoJumpTo:function(e,i,o,t){g.invokebainuoAPI(e,i,o,t)},setShare:function(e){g.setShare(e)},getUniversalLink:function(e){return g.getUniversalLink(e)}}});
;/*!/static/common/Cookie.js*/
define("mactivity:static/common/Cookie",function(e,n,t){var o=function(e){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(e)},i=function(e){if(o(e)){var n=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),t=n.exec(document.cookie);if(t)return t[2]||null}return null},r=function(e){var n=i(e);return"string"==typeof n?n=decodeURIComponent(n):null},u=function(e,n,t){if(o(e)){t=t||{};var i=t.expires;"number"==typeof t.expires&&(i=new Date,i.setTime(i.getTime()+t.expires)),document.cookie=e+"="+n+(t.path?"; path="+t.path:"")+(i?"; expires="+i.toGMTString():"")+(t.domain?"; domain="+t.domain:"")+(t.secure?"; secure":"")}},c=function(e,n){n=n||{},n.expires=new Date(0),u(e,"",n)},f=function(e,n,t){u(e,encodeURIComponent(n),t)};t.exports={getRaw:i,get:r,remove:c,setRaw:u,set:f}});
;/*!/static/common/localstorage.js*/
define("mactivity:static/common/localstorage",function(e,r,t){"use strict";var c=window.localStorage,s="<#lsvalid#>",a="</#lsvalid#>",o=new RegExp("^(<#lsvalid#>)(.*)(</#lsvalid#>)$"),i=function(){},n=i.prototype;n.deleteData=function(e,r){if(c){r=r||{};try{c.removeItem(e),r.success&&r.success()}catch(t){r.error&&r.error()}}},n.addData=function(e,r,t){if(c){t=t||{};try{var o="object"==typeof r?JSON.stringify(r):r;c.setItem(e,s+o+a),t.success&&t.success()}catch(i){t.error&&t.error()}}},n.getData=function(e){if(c){var r=c.getItem(e);if(null===r)return null;var t=null;return(t=r.match(o))?r=t[2]:void 0}},n.selectData=function(e,r){if(c){var t,s=c.getItem(e);if(r=r||{},null===s)return void(r.success&&r.success(s));var a=null;if(a=s.match(o)){s=a[2];try{t=JSON.parse(s),r.success&&r.success(t)}catch(i){r.error&&r.error()}}else r.error&&r.error()}},t.exports=new i});
;/*!/widget/common/activeLocation/locationH5/CookieDataCenter.js*/
define("mactivity:widget/common/activeLocation/locationH5/CookieDataCenter",function(e,t,E){var _,O=e("mactivity:static/common/Cookie"),n=e("mactivity:static/common/localstorage"),I=e("mactivity:static/common/utils"),o=864e5,a=(new Date).getTime();_={COOKIE_CITY_KEY:"wm_city",COOKIE_CITY_EXPIRES:a+5e3*o,COOKIE_ADDR_KEY:"wm_addr",COOKIE_ADDR_EXPIRES:a+1*o,DEFAULT_CITY:{code:131,name:"北京"},CITY_SUPPORT:{131:1,289:1,179:1,315:1,224:1},DEFAULT_PATH:"/",COOKIE_SEND_ADDR_ID:"SEND_ADDR_ID",COOKIE_USER_INFO:"WM_USER_INFO",COOKIE_SEND_TIME:"SEND_TIME",COOKIE_SEND_DATE:"SEND_DATE",COOKIE_USER_NOTE:"WM_USER_NOTE",COOKIE_USER_CURRENT_URL:"WM_USER_CURRENT_URL",COOKIE_USE_INVOICE:"WM_USER_INVOICE",COOKIE_SHOP_ID:"WM_SHOP_ID"},E.exports={initCity:function(){var e=this.getCity(_.COOKIE_CITY_KEY);e&&e.code||this.setCity(_.DEFAULT_CITY)},setCity:function(e){var t=encodeURIComponent(JSON.stringify(e));O.setRaw(_.COOKIE_CITY_KEY,t,{expires:_.COOKIE_CITY_EXPIRES,path:_.DEFAULT_PATH})},getCity:function(){var e=decodeURIComponent(O.getRaw(_.COOKIE_CITY_KEY));return JSON.parse(e)||_.DEFAULT_CITY},setAddr:function(e){if(e.address){var t={};t.address=I.encodeHTML(decodeURIComponent(e.address)),t.lat=e.lat,t.lng=e.lng;var E=encodeURIComponent(JSON.stringify(t));O.setRaw(_.COOKIE_ADDR_KEY,E,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH})}},getAddr:function(){var e=decodeURIComponent(O.getRaw(_.COOKIE_ADDR_KEY));return e&&"null"!=e?JSON.parse(e):""},setAddrId:function(e){e&&O.setRaw(_.COOKIE_SEND_ADDR_ID,e,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH})},getAddrId:function(){return O.getRaw(_.COOKIE_SEND_ADDR_ID)},setSendDate:function(e){e&&(n.addData(_.COOKIE_SEND_DATE,e),O.setRaw(_.COOKIE_SEND_DATE,e,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH}))},getSendDate:function(){var e=n.getData(_.COOKIE_SEND_DATE)||decodeURIComponent(O.getRaw(_.COOKIE_SEND_DATE));return e&&"null"!=e?e:0},setSendTime:function(e){e&&(n.addData(_.COOKIE_SEND_TIME,e),O.setRaw(_.COOKIE_SEND_TIME,e,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH}))},getSendTime:function(){var e=n.getData(_.COOKIE_SEND_TIME)||decodeURIComponent(O.getRaw(_.COOKIE_SEND_TIME));return e&&"null"!=e?e:0},clearSendTime:function(){n.deleteData(_.COOKIE_SEND_TIME)},setNote:function(e){e=e||"";var t=encodeURIComponent(e);n.addData(_.COOKIE_USER_NOTE,e),O.setRaw(_.COOKIE_USER_NOTE,t,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH})},getNote:function(){var e=n.getData(_.COOKIE_USER_NOTE)||decodeURIComponent(O.getRaw(_.COOKIE_USER_NOTE));return e&&"null"!=e?e:""},clearNote:function(){this.setNote(),n.deleteData(_.COOKIE_USER_NOTE)},setShopId:function(e){e=e||"";var t=encodeURIComponent(e);n.addData(_.COOKIE_SHOP_ID,e),O.setRaw(_.COOKIE_SHOP_ID,t,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH})},getShopId:function(){var e=n.getData(_.COOKIE_SHOP_ID)||decodeURIComponent(O.getRaw(_.COOKIE_SHOP_ID));return e&&"null"!=e?e:""},clearShopId:function(){this.setShopId(),n.deleteData(_.COOKIE_SHOP_ID)},setUserInfo:function(e){e&&n.addData(_.COOKIE_USER_INFO,JSON.stringify(e))},getUserInfo:function(){var e=n.getData(_.COOKIE_USER_INFO);return JSON.parse(e)},clearUserInfo:function(){n.deleteData(_.COOKIE_USER_INFO)},setUrl:function(e){e||(e=window.location.href),e=encodeURIComponent(e),O.setRaw(_.COOKIE_USER_CURRENT_URL,e,{expires:_.COOKIE_ADDR_EXPIRES,path:_.DEFAULT_PATH})},getUrl:function(){var e=O.getRaw(_.COOKIE_USER_CURRENT_URL);return decodeURIComponent(e)},setInvoice:function(e){if(e&&e.need&&e.title){var t={title:e.title,need:e.need};t=encodeURIComponent(JSON.stringify(t)),O.setRaw(_.COOKIE_USE_INVOICE,t)}else O.remove(_.COOKIE_USE_INVOICE)},getInvoice:function(){var e=O.getRaw(_.COOKIE_USE_INVOICE);return decodeURIComponent(e)},clearInvoice:function(){O.remove(_.COOKIE_USE_INVOICE)},clearLocal:function(){n.deleteData(_.COOKIE_USER_INFO),this.clearNote(),this.clearShopId()}}});
;/*!/widget/common/activeLocation/locationH5/positionManager.js*/
define("mactivity:widget/common/activeLocation/locationH5/positionManager",function(t,a,o){var i=t("mactivity:widget/common/activeLocation/locationH5/CookieDataCenter"),n=t("mactivity:static/common/utils"),e=function(){};e.prototype.getPosition=function(){var t=i.getAddr().address||"",a=i.getAddr().lng||"",o=i.getAddr().lat||"",e=n.getParam("address")||"",r=n.getParam("lat")||"",s=n.getParam("lng")||"",d=(n.getParam("shop_id")||"",r?r:o),g=s?s:a,c=e?e:t;return{address:c,lat:d,lng:g}},e.prototype.savePosition=function(t,a,o){i.setAddr({address:t,lng:o,lat:a})};var r=new e;!function(){var t=n.getParam("address"),a=n.getParam("lat"),o=n.getParam("lng");t&&a&&o&&r.savePosition(t,a,o)}(r),o.exports={getPosition:function(){return r.getPosition()},savePosition:function(t,a,o){return r.savePosition(t,a,o)}}});
;/*!/static/common/stat.js*/
define("mactivity:static/common/stat",function(t,e,i){"use strict";var n=t("mactivity:static/common/Cookie"),a=20138,r=function(){var t=n.get("flow_ctrl")||!1;return t===!1?!1:!0}(),o=function(t,e,i){var a={expires:1e4,path:"/"},r=i||function(){},o=e||{};u(t,o),o=$.extend({module:window._APP_HASH.module,action:window._APP_HASH.action,page:window._APP_HASH.page,third_party:window._APP_HASH.third_party,resid:31,da_ver:"2.1.0"},o),t&&(o.code=t,o.trackCode=t),n.set("H_MAP_CLK",JSON.stringify(o),a),r()},d=function(t){if("object"==typeof t&&t.code)return void o(t.code,t);if("string"==typeof t)try{for(var e=t.replace(/[{}"']/g,"").split(","),i={},a=0;a<e.length;a++){var r=e[a].split(":");i[$.trim(r[0])]=$.trim(r[1])}o(i.code,i)}catch(d){}else null==n.get("H_MAP_CLK")&&o("",{})},c=function(){listener&&listener.on("common.page","switchstart",function(t,e){var i,n=e.target;n&&(i=$(n).data("log"),d(i));var a=$(n).data("da-src");a&&pbstat.addStat(a)}),$(document).on("click","a,[data-href]",function(){var t=$(this).data("log");t&&d(t);var e=$(this).data("da-src");e&&pbstat.addStat(e)},!0)},s=function(){var t=["http://map.baidu.com/mobile/img/t.gif?newmap=1","http://log.waimai.baidu.com/static/transparent.gif?newmap=1"];return/(&|\?)(kehuduan=1|nostat=1)(&|$|#)/.test(location.href)&&(t="http://map.baidu.com/mobile/img/nostat.gif?newmap=1"),function(){return t}}(),u=($("#statImg"),function(t,e,i){var a=i||function(){};if(t){e=e||{},r&&(e.flow_ctrl=!0),e.module="waimai",e.third_party=n.get("WMREFER")||"",e.resid=31,e.da_ver="2.1.0";var o=m();o&&(o.resid&&(e.resid=o.resid),o.third_party&&(e.third_party=o.third_party));var d=p(e),c=function(t){var e=s(),i=new Image,n=0,r=e.length;t&&(u._sending=!0,setTimeout(function(){for(u._sending=!1;r>n;n++)i.src=e[n]+t.src;$(document).trigger("addStat",t.code),f()},50),a())},f=function(){var t=u._reqQueue.shift();t&&c(t)},_=Date.now(),g={src:"&t="+_+"&code="+t+"&"+d,code:t};u._sending?u._reqQueue.push(g):c(g)}});u._reqQueue=[];var f=function(){var t=a,e={},i=!1,n=200,r=!1,o=[],d=function(n){if(!i){var a=n||{},d=n.pid||"unkown",s=n.page_id||"unkown",f={pid:d,page_id:s},p=e;o.push(f),a.step_len=o.length,a.time=Date.now(),a=$.extend({},a,f,p),u(t,a),e={ref_pid:f.pid,ref_page_id:f.page_id},(!window.checkLandingPage()||r)&&c(),r=!0}},c=function(){i=!0;var t=setTimeout(function(){i=!1,clearTimeout(t)},n)};return d}(),p=function(t){if(!t)return"";var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e+"="+encodeURIComponent(t[e]));return i.join("&")},m=function(){for(var t=location.search,e=t.split("&"),i={},n=0,a=e.length;a>n;n++){var r=e[n].split("=");i[r[0]]=r[1]}if(i.from&&i.resid){var o=i.from.split("-"),d=i.resid,c=o[0],s=o[1];return{third_party:c,resid:d,os:s}}return!1};i.exports={addStat:u,sendPvStat:f,initClickStat:c,addCookieStat:o}});
;/*!/widget/common/activeLocation/locationH5/location_h5.js*/
define("mactivity:widget/common/activeLocation/locationH5/location_h5",function(t,o,a){var i=t("mactivity:static/common/stat"),s=function(){this.opts={enableHighAcuracy:!0,timeout:5e3}};s.prototype.locate=function(t,o){var a=this;lbstag&&lbstag.geolocation.getCurrentPosition(function(s){s?(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Success",da_act:"show"}),a.getAddressByBaidu(s,t,o)):(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Fail",da_act:"show"}),o&&o())},function(t){o&&o(t)},a.opts)},s.prototype.getAddressByBaidu=function(t,o,a){$.ajax({url:"/shopui/api/geo",type:"GET",dataType:"json",data:{lat:t.coords.y,lng:t.coords.x,display:"json"},success:function(a){if(a){var i={};i.address=a.result.poi_address,i.lat=t.coords.y,i.lng=t.coords.x,o(i)}},error:function(){a&&a()}})},a.exports=new s});
;/*!/static/common/coordService.js*/
define("mactivity:static/common/coordService",function(t,e,o){function r(){this.MCBAND=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],this.LLBAND=[75,60,45,30,15,0],this.MC2LL=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],this.LL2MC=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]]}r.prototype.getRange=function(t,e,i){return void 0!==e&&(t=t>e?t:e),void 0!==i&&(t=t>i?i:t),t},r.prototype.getLoop=function(t,e,i){for(;t>i;)$v-=i-e;for(;e>t;)t+=i-e;return t},r.prototype.convertor=function(t,e){return t&&e?(x=e[0]+e[1]*Math.abs(t[0]),temp=Math.abs(t[1])/e[9],y=e[2]+e[3]*temp+e[4]*temp*temp+e[5]*temp*temp*temp+e[6]*temp*temp*temp*temp+e[7]*temp*temp*temp*temp*temp+e[8]*temp*temp*temp*temp*temp*temp,x*=t[0]<0?-1:1,y*=t[1]<0?-1:1,[x,y]):void 0},r.prototype.convertLL2MC=function(t){var e,o;for(t[0]=this.getLoop(t[0],-180,180),t[1]=this.getRange(t[1],-74,74),e=t,cnt=this.LLBAND.length,i=0;cnt>i;i++)if(e[1]>=this.LLBAND[i]){o=this.LL2MC[i];break}if(!o)for(i=cnt-1;i>=0;i--)if(e[1]<=-this.LLBAND[i]){o=this.LL2MC[i];break}return mc=this.convertor(t,o),fmtMc=[mc[0].toFixed(4),mc[1].toFixed(4)]},r.prototype.convertMC2LL=function(t){var e,o;for(e=[Math.abs(t[0]),Math.abs(t[1])],cnt=this.MCBAND.length,i=0;cnt>i;i++)if(e[1]>=this.MCBAND[i]){o=this.MC2LL[i];break}return arrTemp=this.convertor(t,o),lng=arrTemp[0].toFixed(6),lat=arrTemp[1].toFixed(6),ll=[lng,lat]};var n=new r;o.exports={convertLL2MC:function(t){return n.convertLL2MC(t)},convertMC2LL:function(t){return n.convertMC2LL(t)}}});
;/*!/widget/common/activeLocation/location.js*/
define("mactivity:widget/common/activeLocation/location",function(o,t,n){var i=o("mactivity:static/common/Cookie"),a=o("mactivity:static/common/utils"),c=o("mactivity:widget/common/activeLocation/locationH5/positionManager"),e=o("mactivity:widget/common/activeLocation/locationH5/location_h5"),r=o("mactivity:static/common/coordService"),d=o("mactivity:static/common/NABridge"),s=a.getParam("third_party")||"",l="nuomi"===s,g=function(o){o&&"function"==typeof o&&(window.BNJS&&"object"==typeof window.BNJS&&BNJS._isAllReady?o():document.addEventListener("BNJSReady",function(){o()},!1))},u=function(o){o&&"function"==typeof o&&(window.WMApp&&"object"==typeof window.WMApp?o():document.addEventListener("WMAppReady",function(){o()},!1))},f=!1;n.exports=Widget.extend({el:"#location-searchbox",events:{'click [data-node="changeCity"]':"_changeCity"},channels:{"activity.common.location changeIcon":"_changeIcon"},NALocation:!1,LLtoMC:function(o){var t=20037508.34*Number(o[0])/180,n=Math.log(Math.tan((90+Number(o[1]))*Math.PI/360))/(Math.PI/180)*20037508.34/180;return[t,n]},setWXconfig:function(o){var t=$.extend({debug:!1,jsApiList:["getLocation"]},o);wx.config(t)},init:function(o){var t=this;t.hideLocBtn(),t.initUrlParams(),t._fngetUrlAddr()||(t.judgeNa(o.token),setTimeout(function(){!t.NALocation&&t._fngetAddr()},1500))},hideLocBtn:function(){var o=this,t=function(){o.$dom.changeCity.hide()};l&&t(),d.openInUrl("getAppVersion","",function(){t()}),u(function(){o.NALocation=!0,t()}),f&&t()},judgeNa:function(o){var t=this;return l?(t.NALocation=!0,void t._fngetNmAddr()):(d.openInUrl("getAppVersion","",function(){}),u(function(){t.NALocation=!0,t._fngetNaAddr()}),void(f&&(t.setWXconfig(o),t.NALocation=!0,wx.ready(function(){t._fngetWXAddr()}))))},initUrlParams:function(){this.params={channel:"",needlocation:"",lat:"",cityid:"",address:"",type:""},$.extend(this.params,a.getParams())},_fngetUrlAddr:function(){var o=this;if(o.params.lat&&o.params.lng){var t={};return t.coords={},t.coords.y=o.params.lat,t.coords.x=o.params.lng,o._triggerData({lat:o.params.lat,lng:o.params.lng}),o._getPioAddr(t),!0}return!1},_fngetAddr:function(){var o=this,t=this.getBoxLocation();if(t){var n={coords:{x:t.lng,y:t.lat}};return this._getPioAddr(n),this._triggerData(t),this._showLocationIcon(t),void o.$dom.changeCity.hide()}if(c.getPosition().lat&&c.getPosition().lng){var i=c.getPosition();if(o._triggerData(i),i.address)o._showLocationIcon(i.address);else{var n={};n.coords={},n.coords.y=i.lat,n.coords.x=i.lng,o._getPioAddr(n)}}else try{e.locate(function(t){o._triggerData({lng:t.lng,lat:t.lat}),o._showLocationIcon(t.address)},function(){o._showLocationIcon(),o._renderNoShop()})}catch(a){o._renderNoShop()}},getBoxLocation:function(){var o=window.Box&&Box.isBox;if(o){var t="BAIDULOC",n=i.get(t).split("_"),a=n&&n.length>=2,c=a?n[0]:"",e=a?n[1]:"";return e&&c?{lat:e,lng:c}:void 0}},_fngetNaAddr:function(){var o=this;if("undefined"!=typeof WMApp){var t=WMApp.location.getSyncLocation(),n={};t.lat&&t.lng&&"0.0"!=t.lat?(n.lat=t.lat,n.lng=t.lng,o._triggerData(n),o._showLocationIcon(t.address)):WMApp.location.getAsyncLocation(function(t){o._triggerData({lat:t.locLat,lng:t.locLng});var n={};n.coords={},n.coords.x=t.locLng,n.coords.y=t.locLat,o._getPioAddr(n)})}},_fngetNmAddr:function(){var o=this;g(function(){if(BNJS.location.hasLocation){var t=r.convertLL2MC([BNJS.location.longitude,BNJS.location.latitude]),n={lng:t[0],lat:t[1]};o._triggerData(n),o._showLocationIcon(BNJS.location.address)}})},_fngetWXAddr:function(){var o=this;wx.getLocation({type:"wgs84",success:function(t){var n=r.convertLL2MC([t.longitude,t.latitude]),i={lng:n[0],lat:n[1]};o._triggerData(i);var a={};a.coords={},a.coords.x=i.lng,a.coords.y=i.lat,o._getPioAddr(a)},fail:function(){o._fngetAddr()}})},_changeCity:function(){var o="http://"+window.location.host+window.location.pathname,t={};$.extend(t,this.params),$.extend(t,{lat:"",lng:""});var n=0;for(var i in t)i&&(o+=(0===n++?"?":"&")+i+"="+t[i]);location.href="/mobile/waimai?qt=confirmcity&url="+encodeURIComponent(o)},_changeIcon:function(){$(".shop-list-title img").css("visibility","hidden"),this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location")},_showLocationIcon:function(o){o?(this.$dom.icon.removeClass("icon-sug-error").addClass("icon-location"),this.$dom.address.html(o)):(this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"))},_getPioAddr:function(o){var t=this;e.getAddressByBaidu(o,function(n){n.address?t._showLocationIcon(n.address):t._ajaxAddr(o)},function(){t._ajaxAddr(o)})},_ajaxAddr:function(o){var t=this;$.ajax({url:"http://api.map.baidu.com/?qt=rgc_standard&callback=",data:{x:o.coords.x,y:o.coords.y,dis_poi:"100",poi_num:"10",ie:"utf-8",oue:"1",res:"api"},context:this,dataType:"jsonp",success:function(o){return o.content&&o.content.address?void t._showLocationIcon():void t._showLocationIcon(o.content.address)},error:function(){t._showLocationIcon()}})},_renderNoShop:function(){this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"),setTimeout(function(){listener.trigger("activity.common.noShop","no_list"),window.loadData&&"function"==typeof window.loadData&&window.loadData()})},_renderShopLit:function(o){setTimeout(function(){listener.trigger("activity.common.shopList","show_list",o)})},_triggerData:function(o){setTimeout(function(){window.loadData&&"function"==typeof window.loadData&&window.loadData(o),listener.trigger("activity.common.shopData","get_data",o),c.savePosition(o.address,o.lat,o.lng)})}})});
;/*!/widget/common/urlFactory/urlnav.js*/
define("mactivity:widget/common/urlFactory/urlnav",function(r,e,t){t.exports={parseURL:function(r){var e=document.createElement("a");return e.href=r,{source:r,protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port,query:e.search,params:function(){for(var r,t={},a=e.search.replace(/^\?/,"").split("&"),n=a.length,c=0;n>c;c++)a[c]&&(r=a[c].split("="),t[r[0]]=r[1]);return t}(),hash:e.hash.replace("#",""),path:e.pathname.replace(/^([^\/])/,"/$1"),segments:e.pathname.replace(/^\//,"").split("/")}},thirdParty:function(r){var e=this.parseURL(location.href).params;return e.url&&(r+="&url="+e.url),e.third_party&&(r+="&third_party="+e.third_party),e.channel&&(r+="&channel="+e.channel),r}}});
;/*!/widget/common/urlFactory/urlOperator.js*/
define("mactivity:widget/common/urlFactory/urlOperator",function(t,r,a){var n=function(){};n.prototype={getCurrentParam:function(t){return this.getParam(window.location.href,t)},getParam:function(t,r){if(t){var a=this.getParamMap(t),n=a[r];return n}},setParamMap:function(t,r){if(!t||!r)return t;for(var a in r){var n=r[a];t=this.setParam(t,a,n)}return t},setParam:function(t,r,a){if(!t||!r)return t;var n=this.getPathName(t),e=this.getParamMap(t);e[r]=a;var i=[];for(var u in e){var o=e[u];(null===o||void 0===o)&&(o=""),i.push(u+"="+o)}var s=n+"?"+i.join("&");return s},getParamMap:function(t){var r={},a=this.getParams(t);return $.each(a,function(t,a){var n=a.split("="),e=n[0],i=a.substring(e.length+1,a.length);r[e]=i}),r},getParams:function(t){var r=[],a=this.getParamStr(t);return a?r=a.split("&"):r},getParamStr:function(t){var r=this.getPathName(t),a=t.substring(r.length+1,t.length);return a},getPathName:function(t){var r=t.split("?"),a=r[0];return a}};var e=new n;a.exports=e});
;/*!/widget/common/urlFactory/urlFactory.js*/
define("mactivity:widget/common/urlFactory/urlFactory",function(t,r,i){var o=t("mactivity:widget/common/urlFactory/urlnav"),a=t("mactivity:widget/common/activeLocation/locationH5/CookieDataCenter"),e=t("mactivity:widget/common/activeLocation/locationH5/positionManager"),s=t("mactivity:widget/common/activeLocation/locationH5/CookieDataCenter"),n=t("mactivity:widget/common/urlFactory/urlOperator"),m=function(){var t=n.getCurrentParam("shop_id")||"",r=e.getPosition(),i=r.lat,a=r.lng,m=r.address,d=s.getCity(),l=n.getCurrentParam("categorytype")||"",c=l?"&categorytype="+l:l,h=n.getCurrentParam("urlfrom")||"",p={shoplist:o.thirdParty("/mobile/waimai?qt=shoplist")+"&address="+m+"&lat="+i+"&lng="+a,shopmarket:o.thirdParty("/mobile/waimai?qt=shoplist")+"&address="+m+"&lat="+i+"&lng="+a+"&categorytype=market",shoppoint:o.thirdParty("/mobile/waimai?qt=shoplist")+"&address="+m+"&lat="+i+"&lng="+a+"&categorytype=point",shopsearch:o.thirdParty("/mobile/waimai?qt=shopsearch")+"&address="+m+"&lat="+i+"&lng="+a+c,shopdetail:o.thirdParty("/mobile/waimai?qt=shopdetail")+"&shop_id="+t+"&address="+m+"&lat="+i+"&lng="+a+c,shopmenu:o.thirdParty("/mobile/waimai?qt=shopmenu")+"&is_attr=1&shop_id="+t+"&address="+m+"&lat="+i+"&lng="+a+c,orderconfirm:o.thirdParty("/mobile/waimai?qt=orderconfirm")+"&waversion=1&shop_id="+t+"&address="+m+"&lng="+a+"&lat="+i+c,shopcomment:o.thirdParty("/mobile/waimai?qt=shopcomment")+"&shop_id="+t+"&address="+m+"&lng="+a+"&lat="+i+c,shopcommentadd:o.thirdParty("/mobile/waimai?qt=shopcommentadd")+"&shop_id="+t+"&address="+m+"&lng="+a+"&lat="+i+c+"&urlfrom="+h,index:o.thirdParty("/mobile/waimai"),orderlist:o.thirdParty("/mobile/waimai?qt=orderlist")+c,confirmaddr:o.thirdParty("/mobile/waimai?qt=confirmaddr")+"&city="+d.city+"&code="+d.code+c,favoritelist:o.thirdParty("/mobile/waimai?qt=favoritelist")};return p}(),d=function(t,r){var i=m[t];return i||(i=o.thirdParty("/mobile/waimai?qt="+t)),r&&(i=n.setParamMap(i,r)),i=window.location.origin+i},l=function(){var t=document.referrer,r=(n.getCurrentParam("qt"),n.getParam(t,"qt")),i=n.getParam(a.getUrl(),"qt"),o=n.getCurrentParam("shop_id"),e={shopmarket:"shopsearch",shoplist:"shopsearch",shopsearch:"shoplist",shopmenu:function(){var t=n.getParam(a.getUrl(),"categorytype");return"point"===t?"shoppoint":"market"===t?"shopmarket":"favoritelist"===r||"favoritelist"===i?"favoritelist":"shoplist"}(),shopdetail:"shopmenu",orderconfirm:function(){return"shopmenu"===r?"shopmenu":"shopcommentadd"===r?"shopcommentadd":void 0}(),addresslist:function(){return o?null:"shoplist"}(),orderdetail:function(){return"orderconfirm"===r||"orderconfirm"===i?"index":"orderlist"}(),orderhistory:"orderlist",orderlist:"shoplist",coupon:function(){return"orderconfirm"===r||"orderconfirm"===i?null:"shoplist"}(),refundlist:"shoplist",favoritelist:"shoplist"};return e}(),c=function(t){var r=l[t];if(r)var i=d(r);return i};i.exports={getUrl:d,getBackUrl:c}});
;/*!/widget/common/popup/popup.js*/
define("mactivity:widget/common/popup/popup",function(t,i,o){o.exports={_defaultOptions:{autoCloseTime:2e3,isTouchHide:!1},_$el:null,_autoCloseTimeout:null,_create:function(t){var i,o;t.layer&&(o=$("<div/>").addClass("common-widget-popup-layer").appendTo(document.body)),i=$("<div></div>").addClass("common-widget-popup").text(t.text||"").hide().appendTo(document.body),this._layout(i),this._$el=i,this._$layer=o},_layout:function(t){var i,o;"none"===t.css("display")&&(o=t.css("visibility"),t.css({visibility:"visibile"}).show()),i=t.offset(),t.css({left:(window.innerWidth-i.width)/2,top:(window.innerHeight-i.height)/2,visibility:o})},open:function(t){var i=this;t=this._options=$.extend({},this._defaultOptions,"string"==typeof t?{text:t}:t),this._$el?(t.html?this._$el.html(t.html):this._$el.text(t.text),this._layout(this._$el)):this._create(t),this._$el.show(),t.autoCloseTime&&(clearTimeout(this._autoCloseTimeout),this._autoCloseTimeout=setTimeout($.proxy(this.close,this),t.autoCloseTime)),t.isTouchHide?(this._$el.on("click",function o(t){t.stopPropagation(),$("#bmap_pop_cover").hide(),i.close(),this._boxTouchHandle=o,this._$el.off("click",o)}),$(document.body).on("click",function e(t){t.stopPropagation(),$("#bmap_pop_cover").hide(),i.close(),this._docTouchHandle=e,$(document.body).off("click",e)})):(this._boxTouchHandle&&this._$el.off("click",this._boxTouchHandle),this._docTouchHandle&&$(document.body).off("click",this._docTouchHandle)),listener.on("common","sizechange",function(){setTimeout(function(){i.setPos()},1e3)})},close:function(){var t;this._$layer&&(this._$layer.remove(),this._$layer=null),this._$el&&(this._$el.remove(),this._$el=null,$.isFunction(t=this._options.onClose)&&t.call(this),this._autoCloseTimeout=null)},setPos:function(){if(this._$el){var t=this._$el.offset(),i=(window.innerWidth-t.width)/2,o=(window.innerHeight-t.height)/2+window.scrollY;this._$el.css({left:i,top:o})}}}});
;/*!/widget/common/dialog/dialog.js*/
define("mactivity:widget/common/dialog/dialog",function(t,i,n){function e(){this.cfg={el:".custom-dialog",tpl:"content-tpl",maskTap:!0},this.initialize.apply(this,arguments)}e.prototype={constructor:e,initialize:function(t){var i=this;i.cfg=$.extend(i.cfg,t),i.$el=$(i.cfg.el),i.$el.html(i.cfg.tpl),i.$mask=$("#mask"),i.$mask.on("click",function(){})},show:function(t,i,n){var e=this;"function"===$.type(i)&&(n=i,i={}),e.$mask.show(),e.$mask.animate({opacity:1},150),e.$el.removeClass("hide"),e.$el.html(t[0]({data:i})),e.$el.children(".inner").addClass(t[1]),n&&n(),$(".close").on("tap",function(){e.close()})},close:function(t){var i=this,n=i.$el.children(".inner");n.addClass("bounceOutUp"),n.on("webkitAnimationEnd",function(){i.$el.empty(),i.$mask.animate({opacity:0},150,function(){i.$mask.hide()}),i.$el.addClass("hide")}),t&&t()}},n.exports=e});
;/*!/static/common/popup.js*/
define("mactivity:static/common/popup",function(t,i,o){o.exports={_defaultOptions:{autoCloseTime:2e3,isTouchHide:!1},_$el:null,_autoCloseTimeout:null,_create:function(t){var i,o;t.layer&&(o=$("<div/>").addClass("common-widget-popup-layer").appendTo(document.body)),i=$("<div></div>").addClass("common-widget-popup").text(t.text||"").hide().appendTo(document.body),this._layout(i),this._$el=i,this._$layer=o},_layout:function(t){var i,o;"none"===t.css("display")&&(o=t.css("visibility"),t.css({visibility:"visibile"}).show()),i=t.offset(),t.css({left:(window.innerWidth-i.width)/2,top:(window.innerHeight-i.height)/2,visibility:o})},open:function(t){var i=this;t=this._options=$.extend({},this._defaultOptions,"string"==typeof t?{text:t}:t),this._$el?(t.html?this._$el.html(t.html):this._$el.text(t.text),this._layout(this._$el)):this._create(t),this._$el.show(),t.autoCloseTime&&(clearTimeout(this._autoCloseTimeout),this._autoCloseTimeout=setTimeout($.proxy(this.close,this),t.autoCloseTime)),t.isTouchHide?(this._$el.on("click",function o(t){t.stopPropagation(),$("#bmap_pop_cover").hide(),i.close(),this._boxTouchHandle=o,this._$el.off("click",o)}),$(document.body).on("click",function e(t){t.stopPropagation(),$("#bmap_pop_cover").hide(),i.close(),this._docTouchHandle=e,$(document.body).off("click",e)})):(this._boxTouchHandle&&this._$el.off("click",this._boxTouchHandle),this._docTouchHandle&&$(document.body).off("click",this._docTouchHandle)),listener.on("common","sizechange",function(){setTimeout(function(){i.setPos()},1e3)})},close:function(){var t;this._$layer&&(this._$layer.remove(),this._$layer=null),this._$el&&(this._$el.remove(),this._$el=null,$.isFunction(t=this._options.onClose)&&t.call(this),this._autoCloseTimeout=null)},setPos:function(){if(this._$el){var t=this._$el.offset(),i=(window.innerWidth-t.width)/2,o=(window.innerHeight-t.height)/2+window.scrollY;this._$el.css({left:i,top:o})}}}});
;/*!/widget/common/activeLocation/locationAPI.js*/
define("mactivity:widget/common/activeLocation/locationAPI",function(t,o,a){var n=t("mactivity:static/common/utils"),i=t("mactivity:widget/common/activeLocation/locationH5/positionManager"),c=t("mactivity:widget/common/activeLocation/locationH5/location_h5"),e={loc:{lng:"",lat:"",address:""},_initUrlParams:function(){this.params={channel:"",needlocation:"",lat:"",cityid:"",address:"",type:""},$.extend(this.params,n.getParams())},_getPioAddr:function(t,o,a){var n=this;c.getAddressByBaidu(t,function(i){i.address?(n.loc.address=i.address,o&&o(n.loc)):n._ajaxAddr(t,o,a)},function(){n._ajaxAddr(t,o,a)})},_ajaxAddr:function(t,o,a){var n=this;$.ajax({url:"http://api.map.baidu.com/?qt=rgc_standard&callback=",data:{x:t.coords.x,y:t.coords.y,dis_poi:"100",poi_num:"10",ie:"utf-8",oue:"1",res:"api"},context:this,dataType:"jsonp",success:function(t){return t.content&&t.content.address?void(a&&a(n.loc)):(n.loc.address=t.content.address,void(o&&o(n.loc)))},error:function(){a&&a(n.loc)}})},getNALocation:function(t,o){var a=this;if("undefined"!=typeof WMApp){var n=WMApp.location.getSyncLocation();n.lat&&n.lng&&"0.0"!=n.lat&&"0.0"!=n.lng?(a.loc.lat=n.lat,a.loc.lng=n.lng,a.loc.address=n.address,t&&t(a.loc)):WMApp.location.getAsyncLocation(function(n){a.loc.lat=n.locLat,a.loc.lng=n.locLng;var i={};i.coords={},i.coords.x=n.locLng,i.coords.y=n.locLat,a._getPioAddr(i,t,o)})}},getH5Location:function(t,o){if(i.getPosition().lng&&i.getPosition().lat){var a=i.getPosition();return void(t&&t(a))}try{c.locate(function(o){var a={lng:o.lng,lat:o.lat,address:o.address};t&&t(a)},function(){o&&o()})}catch(n){o&&o()}},geUrlLocation:function(t,o){var a=this;if(a._initUrlParams(),a.params.lat&&a.params.lng){var n={};return n.coords={},n.coords.y=a.params.lat,n.coords.x=a.params.lng,a._getPioAddr(n,t,o),!0}return!1}};a.exports={init:function(t){$.extend(e.token,t),e.init()},getH5Location:function(t,o){e.getH5Location(t,o)},geUrlLocation:function(t,o){e.geUrlLocation(t,o)},getNALocation:function(t,o){e.getNALocation(t,o)}}});
;/*!/static/common/iscroll.js*/
define("mactivity:static/common/iscroll",function(t,i,e){!function(t,i,s){function n(e,s){this.wrapper="string"==typeof e?i.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={disablePointer:!r.hasPointer,disableTouch:r.hasPointer||!r.hasTouch,disableMouse:r.hasPointer||r.hasTouch,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0,bindToWrapper:"undefined"==typeof t.onmousedown};for(var n in s)this.options[n]=s[n];this.translateZ=this.options.HWCompositing&&r.hasPerspective?" translateZ(0)":"",this.options.useTransition=r.hasTransition&&this.options.useTransition,this.options.useTransform=r.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?r.ease[this.options.bounceEasing]||r.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}var o=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(i){t.setTimeout(i,1e3/60)},r=function(){function e(t){return r===!1?!1:""===r?t:r+t.charAt(0).toUpperCase()+t.substr(1)}var n={},o=i.createElement("div").style,r=function(){for(var t,i=["t","webkitT","MozT","msT","OT"],e=0,s=i.length;s>e;e++)if(t=i[e]+"ransform",t in o)return i[e].substr(0,i[e].length-1);return!1}();n.getTime=Date.now||function(){return(new Date).getTime()},n.extend=function(t,i){for(var e in i)t[e]=i[e]},n.addEvent=function(t,i,e,s){t.addEventListener(i,e,!!s)},n.removeEvent=function(t,i,e,s){t.removeEventListener(i,e,!!s)},n.prefixPointerEvent=function(i){return t.MSPointerEvent?"MSPointer"+i.charAt(7).toUpperCase()+i.substr(8):i},n.momentum=function(t,i,e,n,o,r){var a,h,c=t-i,l=s.abs(c)/e;return r=void 0===r?6e-4:r,a=t+l*l/(2*r)*(0>c?-1:1),h=l/r,n>a?(a=o?n-o/2.5*(l/8):n,c=s.abs(a-t),h=c/l):a>0&&(a=o?o/2.5*(l/8):0,c=s.abs(t)+a,h=c/l),{destination:s.round(a),duration:h}};var a=e("transform");return n.extend(n,{hasTransform:a!==!1,hasPerspective:e("perspective")in o,hasTouch:"ontouchstart"in t,hasPointer:!(!t.PointerEvent&&!t.MSPointerEvent),hasTransition:e("transition")in o}),n.isBadAndroid=function(){var i=t.navigator.appVersion;if(/Android/.test(i)&&!/Chrome\/\d/.test(i)){var e=i.match(/Safari\/(\d+.\d)/);return e&&"object"==typeof e&&e.length>=2?parseFloat(e[1])<535.19:!0}return!1}(),n.extend(n.style={},{transform:a,transitionTimingFunction:e("transitionTimingFunction"),transitionDuration:e("transitionDuration"),transitionDelay:e("transitionDelay"),transformOrigin:e("transformOrigin")}),n.hasClass=function(t,i){var e=new RegExp("(^|\\s)"+i+"(\\s|$)");return e.test(t.className)},n.addClass=function(t,i){if(!n.hasClass(t,i)){var e=t.className.split(" ");e.push(i),t.className=e.join(" ")}},n.removeClass=function(t,i){if(n.hasClass(t,i)){var e=new RegExp("(^|\\s)"+i+"(\\s|$)","g");t.className=t.className.replace(e," ")}},n.offset=function(t){for(var i=-t.offsetLeft,e=-t.offsetTop;t=t.offsetParent;)i-=t.offsetLeft,e-=t.offsetTop;return{left:i,top:e}},n.preventDefaultException=function(t,i){for(var e in i)if(i[e].test(t[e]))return!0;return!1},n.extend(n.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),n.extend(n.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(t){return t*(2-t)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(t){return s.sqrt(1- --t*t)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(t){var i=4;return(t-=1)*t*((i+1)*t+i)+1}},bounce:{style:"",fn:function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},elastic:{style:"",fn:function(t){var i=.22,e=.4;return 0===t?0:1==t?1:e*s.pow(2,-10*t)*s.sin(2*(t-i/4)*s.PI/i)+1}}}),n.tap=function(t,e){var s=i.createEvent("Event");s.initEvent(e,!0,!0),s.pageX=t.pageX,s.pageY=t.pageY,t.target.dispatchEvent(s)},n.click=function(t){var e,s=t.target;/(SELECT|INPUT|TEXTAREA)/i.test(s.tagName)||(e=i.createEvent("MouseEvents"),e.initMouseEvent("click",!0,!0,t.view,1,s.screenX,s.screenY,s.clientX,s.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),e._constructed=!0,s.dispatchEvent(e))},n}();n.prototype={version:"5.2.0",_init:function(){this._initEvents()},destroy:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this._execEvent("destroy")},_transitionEnd:function(t){t.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(t){if(1!=r.eventType[t.type]){var i;if(i=t.which?t.button:t.button<2?0:4==t.button?1:2,0!==i)return}if(this.enabled&&(!this.initiated||r.eventType[t.type]===this.initiated)){!this.options.preventDefault||r.isBadAndroid||r.preventDefaultException(t.target,this.options.preventDefaultException)||t.preventDefault();var e,n=t.touches?t.touches[0]:t;this.initiated=r.eventType[t.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=r.getTime(),this.options.useTransition&&this.isInTransition?(this._transitionTime(),this.isInTransition=!1,e=this.getComputedPosition(),this._translate(s.round(e.x),s.round(e.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=n.pageX,this.pointY=n.pageY,this._execEvent("beforeScrollStart")}},_move:function(t){if(this.enabled&&r.eventType[t.type]===this.initiated){this.options.preventDefault&&t.preventDefault();var i,e,n,o,a=t.touches?t.touches[0]:t,h=a.pageX-this.pointX,c=a.pageY-this.pointY,l=r.getTime();if(this.pointX=a.pageX,this.pointY=a.pageY,this.distX+=h,this.distY+=c,n=s.abs(this.distX),o=s.abs(this.distY),!(l-this.endTime>300&&10>n&&10>o)){if(this.directionLocked||this.options.freeScroll||(this.directionLocked=n>o+this.options.directionLockThreshold?"h":o>=n+this.options.directionLockThreshold?"v":"n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)t.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);c=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)t.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);h=0}h=this.hasHorizontalScroll?h:0,c=this.hasVerticalScroll?c:0,i=this.x+h,e=this.y+c,(i>0||i<this.maxScrollX)&&(i=this.options.bounce?this.x+h/3:i>0?0:this.maxScrollX),(e>0||e<this.maxScrollY)&&(e=this.options.bounce?this.y+c/3:e>0?0:this.maxScrollY),this.directionX=h>0?-1:0>h?1:0,this.directionY=c>0?-1:0>c?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(i,e),l-this.startTime>300&&(this.startTime=l,this.startX=this.x,this.startY=this.y)}}},_end:function(t){if(this.enabled&&r.eventType[t.type]===this.initiated){this.options.preventDefault&&!r.preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault();var i,e,n=(t.changedTouches?t.changedTouches[0]:t,r.getTime()-this.startTime),o=s.round(this.x),a=s.round(this.y),h=s.abs(o-this.startX),c=s.abs(a-this.startY),l=0,p="";if(this.isInTransition=0,this.initiated=0,this.endTime=r.getTime(),!this.resetPosition(this.options.bounceTime))return this.scrollTo(o,a),this.moved?this._events.flick&&200>n&&100>h&&100>c?void this._execEvent("flick"):(this.options.momentum&&300>n&&(i=this.hasHorizontalScroll?r.momentum(this.x,this.startX,n,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:o,duration:0},e=this.hasVerticalScroll?r.momentum(this.y,this.startY,n,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:a,duration:0},o=i.destination,a=e.destination,l=s.max(i.duration,e.duration),this.isInTransition=1),o!=this.x||a!=this.y?((o>0||o<this.maxScrollX||a>0||a<this.maxScrollY)&&(p=r.ease.quadratic),void this.scrollTo(o,a,l,p)):void this._execEvent("scrollEnd")):(this.options.tap&&r.tap(t,this.options.tap),this.options.click&&r.click(t),void this._execEvent("scrollCancel"))}},_resize:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)},resetPosition:function(t){var i=this.x,e=this.y;return t=t||0,!this.hasHorizontalScroll||this.x>0?i=0:this.x<this.maxScrollX&&(i=this.maxScrollX),!this.hasVerticalScroll||this.y>0?e=0:this.y<this.maxScrollY&&(e=this.maxScrollY),i==this.x&&e==this.y?!1:(this.scrollTo(i,e,t,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=r.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)},off:function(t,i){if(this._events[t]){var e=this._events[t].indexOf(i);e>-1&&this._events[t].splice(e,1)}},_execEvent:function(t){if(this._events[t]){var i=0,e=this._events[t].length;if(e)for(;e>i;i++)this._events[t][i].apply(this,[].slice.call(arguments,1))}},scrollBy:function(t,i,e,s){t=this.x+t,i=this.y+i,e=e||0,this.scrollTo(t,i,e,s)},scrollTo:function(t,i,e,s){s=s||r.ease.circular,this.isInTransition=this.options.useTransition&&e>0;var n=this.options.useTransition&&s.style;!e||n?(n&&(this._transitionTimingFunction(s.style),this._transitionTime(e)),this._translate(t,i)):this._animate(t,i,e,s.fn)},scrollToElement:function(t,i,e,n,o){if(t=t.nodeType?t:this.scroller.querySelector(t)){var a=r.offset(t);a.left-=this.wrapperOffset.left,a.top-=this.wrapperOffset.top,e===!0&&(e=s.round(t.offsetWidth/2-this.wrapper.offsetWidth/2)),n===!0&&(n=s.round(t.offsetHeight/2-this.wrapper.offsetHeight/2)),a.left-=e||0,a.top-=n||0,a.left=a.left>0?0:a.left<this.maxScrollX?this.maxScrollX:a.left,a.top=a.top>0?0:a.top<this.maxScrollY?this.maxScrollY:a.top,i=void 0===i||null===i||"auto"===i?s.max(s.abs(this.x-a.left),s.abs(this.y-a.top)):i,this.scrollTo(a.left,a.top,i,o)}},_transitionTime:function(t){t=t||0;var i=r.style.transitionDuration;if(this.scrollerStyle[i]=t+"ms",!t&&r.isBadAndroid){this.scrollerStyle[i]="0.0001ms";var e=this;o(function(){"0.0001ms"===e.scrollerStyle[i]&&(e.scrollerStyle[i]="0s")})}},_transitionTimingFunction:function(t){this.scrollerStyle[r.style.transitionTimingFunction]=t},_translate:function(t,i){this.options.useTransform?this.scrollerStyle[r.style.transform]="translate("+t+"px,"+i+"px)"+this.translateZ:(t=s.round(t),i=s.round(i),this.scrollerStyle.left=t+"px",this.scrollerStyle.top=i+"px"),this.x=t,this.y=i},_initEvents:function(i){var e=i?r.removeEvent:r.addEvent,s=this.options.bindToWrapper?this.wrapper:t;e(t,"orientationchange",this),e(t,"resize",this),this.options.click&&e(this.wrapper,"click",this,!0),this.options.disableMouse||(e(this.wrapper,"mousedown",this),e(s,"mousemove",this),e(s,"mousecancel",this),e(s,"mouseup",this)),r.hasPointer&&!this.options.disablePointer&&(e(this.wrapper,r.prefixPointerEvent("pointerdown"),this),e(s,r.prefixPointerEvent("pointermove"),this),e(s,r.prefixPointerEvent("pointercancel"),this),e(s,r.prefixPointerEvent("pointerup"),this)),r.hasTouch&&!this.options.disableTouch&&(e(this.wrapper,"touchstart",this),e(s,"touchmove",this),e(s,"touchcancel",this),e(s,"touchend",this)),e(this.scroller,"transitionend",this),e(this.scroller,"webkitTransitionEnd",this),e(this.scroller,"oTransitionEnd",this),e(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var i,e,s=t.getComputedStyle(this.scroller,null);return this.options.useTransform?(s=s[r.style.transform].split(")")[0].split(", "),i=+(s[12]||s[4]),e=+(s[13]||s[5])):(i=+s.left.replace(/[^-\d.]/g,""),e=+s.top.replace(/[^-\d.]/g,"")),{x:i,y:e}},_animate:function(t,i,e,s){function n(){var u,f,d,m=r.getTime();return m>=p?(a.isAnimating=!1,a._translate(t,i),void(a.resetPosition(a.options.bounceTime)||a._execEvent("scrollEnd"))):(m=(m-l)/e,d=s(m),u=(t-h)*d+h,f=(i-c)*d+c,a._translate(u,f),void(a.isAnimating&&o(n)))}var a=this,h=this.x,c=this.y,l=r.getTime(),p=l+e;this.isAnimating=!0,n()},handleEvent:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(t);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(t);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(t);break;case"keydown":this._key(t);break;case"click":this.enabled&&!t._constructed&&(t.preventDefault(),t.stopPropagation())}}},n.utils=r,"undefined"!=typeof e&&e.exports?e.exports=n:"function"==typeof define&&define.amd?define(function(){return n}):t.IScroll=n}(window,document,Math)});
;/*!/widget/common/shopList_rich/list.js*/
define("mactivity:widget/common/shopList_rich/list",function(require,exports,module){var util=require("mactivity:static/common/utils"),Stat=require("mactivity:static/common/stat"),cookie=require("mactivity:static/common/Cookie"),listRich=[function(_template_object){var _template_fun_array=[],fn=function(__data__){function getImageUrl(e){if(e){var t=.38*$("#shop-list-container").width(),a="@s_0,w_"+2*Math.ceil(parseFloat(t))+",q_80";if(-1!=e.indexOf("http://img.waimai.bdimg.com")){var s=e+a;return s}e=encodeURIComponent(e);var i="http://webmap1.map.bdimg.com/maps/services/thumbnails?width="+2*Math.ceil(parseFloat(t))+"&height="+2*Math.ceil(parseFloat(.789473684*t))+"&align=center,center&quality=80&src="+e;return i}}var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");var item=data[0];_template_fun_array.push('<div class="dishlists dishlist',"undefined"==typeof data.page?"":baidu.template._encodeHTML(data.page),'"><section>    <ul class="shoplist">'),_template_fun_array.push("");var shoplist=item.shop_list;_template_fun_array.push("");for(var j=0,len=shoplist.length;len>j;j++){var shopItem=shoplist[j];_template_fun_array.push(""),shopItem.logo_url=getImageUrl(shopItem.logo_url),_template_fun_array.push("");var url="/mobile/waimai?qt=shopmenu&shop_id="+shopItem.release_id;if(recall_info){var lat=recall_info.lat,lng=recall_info.lng,addr=recall_info.address;url="/mobile/waimai?qt=shopmenu&shop_id="+shopItem.release_id+"&lat="+lat+"&lng="+lng+"&address="+addr+"&is_attr1"}_template_fun_array.push('<li class="shop-item-wrapper" invoke-shopmenu="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-id="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-store="',"undefined"==typeof shopItem.is_store?"":baidu.template._encodeHTML(shopItem.is_store),'">    <div class="clearfix"><div class="list-img lazy" data-original="',"undefined"==typeof shopItem.logo_url?"":baidu.template._encodeHTML(shopItem.logo_url),'"><i class="img-mark '),window.__flag_is_11_11&&_template_fun_array.push("is11-11"),_template_fun_array.push('" '),window.__flag_is_11_11&&window.__mark_img_url&&_template_fun_array.push('style="background-image: url(',"undefined"==typeof window.__mark_img_url?"":baidu.template._encodeHTML(window.__mark_img_url),');"'),_template_fun_array.push('></i></div><div class="list-wrapper"><h4 class="text-title"><p class="text-ellipsis ',"undefined"==typeof limit?"":baidu.template._encodeHTML(limit),'">',"undefined"==typeof(shopItem.shop_name||"")?"":baidu.template._encodeHTML(shopItem.shop_name||""),'</p></h4><div class="shop-status">'),1==shopItem.business_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):2==shopItem.business_status?(_template_fun_array.push('<span class="status order">预订中</span>'),shopItem.start_time&&_template_fun_array.push('<span class="business_time">',"undefined"==typeof shopItem.start_time?"":baidu.template._encodeHTML(shopItem.start_time),"开始配送</span>"),_template_fun_array.push("")):3==shopItem.business_status?_template_fun_array.push('<span class="list-arrow"><span class="arrow_select" style="width:',"undefined"==typeof(20*shopItem.overall_rating)?"":baidu.template._encodeHTML(20*shopItem.overall_rating),'%"></span></span><span class="sell">月售',"undefined"==typeof shopItem.saled?"":baidu.template._encodeHTML(shopItem.saled),"份</span>"):4==shopItem.business_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):5==shopItem.business_status&&(_template_fun_array.push('<span class="status order">仅预定</span>'),shopItem.advance_need_order_day&&_template_fun_array.push('<span class="business_time">提前',"undefined"==typeof shopItem.advance_need_order_day?"":baidu.template._encodeHTML(shopItem.advance_need_order_day),"天预订</span>"),_template_fun_array.push("")),_template_fun_array.push('</div><div class="shop-msg"><span>起送费￥',"undefined"==typeof(Math.round(100*Number(shopItem.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(shopItem.takeout_price))/100),"</span><span>配送费"),shopItem.discount_info&&1==shopItem.discount_info.is_discount_send?_template_fun_array.push("<del>￥0</del>"):_template_fun_array.push("￥","undefined"==typeof(parseInt(shopItem.takeout_cost)||"0")?"":baidu.template._encodeHTML(parseInt(shopItem.takeout_cost)||"0"),""),_template_fun_array.push('</span><span class="">',"undefined"==typeof shopItem.delivery_time?"":baidu.template._encodeHTML(shopItem.delivery_time),"分钟</span></div></div></div><div class=\"warefare-details-card\" data-node=\"warefareDetail\">            <div class='card-warefare-list'>            <div class='icon'>            ","undefined"==typeof shopItem.welfare.rate_msg?"":baidu.template._encodeHTML(shopItem.welfare.rate_msg),"            </div>            <div class='pick_msg'>            ","undefined"==typeof shopItem.welfare.pick_msg?"":baidu.template._encodeHTML(shopItem.welfare.pick_msg),"            </div>            </div></div></li>")}_template_fun_array.push("</ul></section></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],navList=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");for(var i=0,len=data.length;len>i;i++){var item=data[i],className=0===i?"active":"";className+=" dmac-b-navelem"+i,_template_fun_array.push('<div class="swiper-slide">    <div class="dmac-b-navelem ',"undefined"==typeof className?"":baidu.template._encodeHTML(className),'" data-sectionid="',"undefined"==typeof i?"":baidu.template._encodeHTML(i),'">        <span class="status underway">',"undefined"==typeof item.navText?"":baidu.template._encodeHTML(item.navText),"</span>    </div></div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],client=util.getParam("client"),channel=util.getParam("channel"),page=0,cityid="",addressData,isnuomi="nuomi"===client;if(!isnuomi)var NABridge=require("mactivity:static/common/NABridge");var self=this,noShopPic="/static/mactivity/images/wap-empty-result_4419fce.png";module.exports=Widget.extend({el:"#shop-list-container",channels:{"activity.common.shopList show_list":"_renderShopList","activity.common.noShop no_list":"_renderNoShop","activity.common.shopData get_data":"_getDataByAjax"},init:function(e){cityid=e.data.city_id,self=this,this.data=e.data,!isnuomi&&NABridge.openInUrl("getAppVersion","",function(e){window.appversion=e.result}),$(window).bind("scroll",function(){var e=$("#more").offset().top-$(window).height(),t=$(window).scrollTop();t>=e&&(page++,self._getDataByAjax("",addressData))})},bindEvent:function(){var e=this;$("label.youhui").on("click"),$("label.youhui").on("click",function(t){e.toggleCoupon(t,this)})},toggleCoupon:function(e,t){e.stopPropagation(),e.preventDefault(),$(t).parents(".shop-item-wrapper").find(".warefare-details-card").toggle()},_renderNoShop:function(){if($(".loading").remove(),page)$("#more").remove();else{listener.trigger("activity.common.location","changeIcon");var e="";e+="<li class='no_res'>",e+='<p class="">附近没有参加活动的餐厅</p>',e+="</li>",this.$el.append(e)}},_cutData:function(e){var t={};return 0==e.errno&&(t=[e.data]),t},_renderShopList:function(e,t){$(".loading").remove();var a=this,s=this._cutData(t);cityid=s[0].city_id;var i=s[0].has_next;if(i||($(window).unbind("scroll"),$("#more").remove()),s&&!s.length)return void this._renderNoShop();if(!s[0].shop_list.length)return void this._renderNoShop();if($("#more").show(),i||$("#end").show(),s&&"{}"!=JSON.stringify(s)){var n=listRich({data:s,recall_info:"",city_info:s.data_notice?s.data_notice:"",channel:util.getParam("channel")});$(".swiper-wrapper").html(navList({data:s}));var o=$(".swiper-slide").length,p=o>3?4:o;new Swiper(".swiper-container",{slidesPerView:p,freeMode:!0}),$(".dmac-b-navlist").css("opacity",1),this.$el.append(n),this.bindEvent()}else a._renderNoShop();$(".lazy").lazyload({})},_getDataByAjax:function(e,t){var a=location.href;addressData=t,a+=a.indexOf("?")>-1?"&lng="+t.lng+"&lat="+t.lat+"&display=json&async=1&page="+page+"&city_id="+cityid:"?lng="+t.lng+"&lat="+t.lat+"&display=json&async=1&page="+page+"&city_id="+cityid,$.ajax({type:"get",dataType:"json",url:a,success:function(e){self._renderShopList("",e)},error:function(){self._renderNoShop()}})}})});
;/*!/widget/common/shopList/list.js*/
define("mactivity:widget/common/shopList/list",function(require,exports,module){function getIconUrl(e){return iconMap[e]}var util=require("mactivity:static/common/utils"),Stat=require("mactivity:static/common/stat"),list=[function(_template_object){var _template_fun_array=[],fn=function(__data__){function getImageUrl(e){if(e){var a=.38*$("#shop-list-container").width(),t="@s_0,w_"+2*Math.ceil(parseFloat(a))+",q_80";if(-1!=e.indexOf("http://img.waimai.bdimg.com")){var s=e+t;return s}e=encodeURIComponent(e);var i="http://webmap1.map.bdimg.com/maps/services/thumbnails?width="+2*Math.ceil(parseFloat(a))+"&height="+2*Math.ceil(parseFloat(.789473684*a))+"&align=center,center&quality=80&src="+e;return i}}var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");for(var i=0,lent=data.length;lent>i;i++){var item=data[i];_template_fun_array.push('<div class="dishlists dishlist',"undefined"==typeof i?"":baidu.template._encodeHTML(i)," "),0!=i&&_template_fun_array.push("hide"),_template_fun_array.push('"><!-- <div class="zhuanImg"><img src="',"undefined"==typeof item.wapZhuanUrl?"":baidu.template._encodeHTML(item.wapZhuanUrl),'" alt=""></div> --><section>    <ul class="shoplist">'),_template_fun_array.push("");var shoplist=item.shop_list;_template_fun_array.push("");for(var j=0,len=shoplist.length;len>j;j++){var shopItem=shoplist[j];_template_fun_array.push(""),shopItem.logo_url=getImageUrl(shopItem.logo_url),_template_fun_array.push("");var url="/mobile/waimai?qt=shopmenu&shop_id="+shopItem.release_id;if(recall_info){var lat=recall_info.lat,lng=recall_info.lng,addr=recall_info.address;url="/mobile/waimai?qt=shopmenu&shop_id="+shopItem.release_id+"&lat="+lat+"&lng="+lng+"&address="+addr+"&is_attr1"}if(_template_fun_array.push(""),channel){_template_fun_array.push('<li class="shop-item-wrapper" invoke-shopmenu="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-id="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-store="',"undefined"==typeof shopItem.is_store?"":baidu.template._encodeHTML(shopItem.is_store),'">  <div class="clearfix"><div class="list-img lazy" data-original="',"undefined"==typeof shopItem.logo_url?"":baidu.template._encodeHTML(shopItem.logo_url),'" ><i class="img-mark '),window.__flag_is_11_11&&_template_fun_array.push("is11-11"),_template_fun_array.push('" '),window.__flag_is_11_11&&window.__mark_img_url&&_template_fun_array.push('style="background-image: url(',"undefined"==typeof window.__mark_img_url?"":baidu.template._encodeHTML(window.__mark_img_url),');"'),_template_fun_array.push('></i></div><div class="list-wrapper"><h4 class="text-title">');var wlen=shopItem.welfare_basic_info.length;_template_fun_array.push("");var limit="";switch(wlen){case 0:case 1:case 2:limit="limit-width-7";break;case 3:limit="limit-width-6";break;case 4:limit="limit-width-5";break;case 5:limit="limit-width-4";break;default:limit="limit-width-4"}_template_fun_array.push('<p class="text-ellipsis ',"undefined"==typeof limit?"":baidu.template._encodeHTML(limit),'">',"undefined"==typeof(shopItem.shop_name||"")?"":baidu.template._encodeHTML(shopItem.shop_name||""),"</p><!--     show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    -->    <!-- <p>");for(var m=0;wlen>m;m++){_template_fun_array.push("                    ");var imgUrl=getIconUrl(shopItem.welfare_basic_info[m].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}if(_template_fun_array.push('</p> --></h4><div class="shop-status">'),1==shopItem.bussiness_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):2==shopItem.bussiness_status?(_template_fun_array.push('<span class="status order">预订中</span>'),shopItem.start_time&&_template_fun_array.push('<span class="business_time">',"undefined"==typeof shopItem.start_time?"":baidu.template._encodeHTML(shopItem.start_time),"开始配送</span>"),_template_fun_array.push("")):3==shopItem.bussiness_status?_template_fun_array.push('<span class="list-arrow"><span class="arrow_select" style="width:',"undefined"==typeof(20*shopItem.overall_rating)?"":baidu.template._encodeHTML(20*shopItem.overall_rating),'%"></span></span><span class="sell">月售',"undefined"==typeof shopItem.saled?"":baidu.template._encodeHTML(shopItem.saled),"份</span>"):4==shopItem.bussiness_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):5==shopItem.bussiness_status&&(_template_fun_array.push('<span class="status order">仅预定</span>'),shopItem.bussiness_status_text&&_template_fun_array.push('<span class="business_time">',"undefined"==typeof shopItem.bussiness_status_text?"":baidu.template._encodeHTML(shopItem.bussiness_status_text),"</span>"),_template_fun_array.push("")),_template_fun_array.push('</div><div class="shop-msg"><span>起送费￥',"undefined"==typeof(Math.round(100*Number(shopItem.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(shopItem.takeout_price))/100),"</span><span>配送费"),shopItem.discount_info&&1==shopItem.discount_info.is_discount_send?_template_fun_array.push("<del>￥0</del>"):_template_fun_array.push("￥","undefined"==typeof(parseInt(shopItem.takeout_cost)||"0")?"":baidu.template._encodeHTML(parseInt(shopItem.takeout_cost)||"0"),""),_template_fun_array.push('</span><span class="">',"undefined"==typeof shopItem.delivery_time?"":baidu.template._encodeHTML(shopItem.delivery_time),"分钟</span></div></div>  </div>"),shopItem.filtered_act_info){_template_fun_array.push("<div class='warefare-details-card' data-node=\"warefareDetail\">");for(key in shopItem.filtered_act_info){_template_fun_array.push("                    ");var imgUrl=getIconUrl(shopItem.filtered_act_info[key].type);_template_fun_array.push("            <div class='card-warefare-list'>                         <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),shopItem.filtered_act_info[key].msg&&_template_fun_array.push("                          <div class='msg'>            ","undefined"==typeof shopItem.filtered_act_info[key].msg?"":baidu.template._encodeHTML(shopItem.filtered_act_info[key].msg),"            </div>            "),_template_fun_array.push("            </div>        ")}_template_fun_array.push("</div>")}_template_fun_array.push("</li>")}else{_template_fun_array.push('<li class="shop-item-wrapper" invoke-shopmenu="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-id="',"undefined"==typeof shopItem.release_id?"":baidu.template._encodeHTML(shopItem.release_id),'" data-store="',"undefined"==typeof shopItem.is_store?"":baidu.template._encodeHTML(shopItem.is_store),'">    <div class="clearfix"><div class="list-img lazy" data-original="',"undefined"==typeof shopItem.logo_url?"":baidu.template._encodeHTML(shopItem.logo_url),'"><i class="img-mark '),window.__flag_is_11_11&&_template_fun_array.push("is11-11"),_template_fun_array.push('" '),window.__flag_is_11_11&&window.__mark_img_url&&_template_fun_array.push('style="background-image: url(',"undefined"==typeof window.__mark_img_url?"":baidu.template._encodeHTML(window.__mark_img_url),');"'),_template_fun_array.push('></i></div><div class="list-wrapper"><h4 class="text-title">');var wlen=shopItem.welfare_basic_info.length;_template_fun_array.push("");var limit="";switch(wlen){case 0:case 1:case 2:limit="limit-width-7";break;case 3:limit="limit-width-6";break;case 4:limit="limit-width-5";break;case 5:limit="limit-width-4";break;default:limit="limit-width-4"}_template_fun_array.push('<p class="text-ellipsis ',"undefined"==typeof limit?"":baidu.template._encodeHTML(limit),'">',"undefined"==typeof(shopItem.shop_name||"")?"":baidu.template._encodeHTML(shopItem.shop_name||""),"</p><!--     show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    -->    <!-- <p>");for(var k=0;wlen>k;k++){_template_fun_array.push("                    ");var imgUrl=getIconUrl(shopItem.welfare_basic_info[k].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}_template_fun_array.push('</p> --></h4><div class="shop-status">'),1==shopItem.bussiness_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):2==shopItem.bussiness_status?(_template_fun_array.push('<span class="status order">预订中</span>'),shopItem.start_time&&_template_fun_array.push('<span class="business_time">',"undefined"==typeof shopItem.start_time?"":baidu.template._encodeHTML(shopItem.start_time),"开始配送</span>"),_template_fun_array.push("")):3==shopItem.bussiness_status?_template_fun_array.push('<span class="list-arrow"><span class="arrow_select" style="width:',"undefined"==typeof(20*shopItem.overall_rating)?"":baidu.template._encodeHTML(20*shopItem.overall_rating),'%"></span></span><span class="sell">月售',"undefined"==typeof shopItem.saled?"":baidu.template._encodeHTML(shopItem.saled),"份</span>"):4==shopItem.bussiness_status?(_template_fun_array.push('<span class="status stop">休息中</span>'),shopItem.takeout_open_time&&_template_fun_array.push('<span class="business_time">营业时间:',"undefined"==typeof shopItem.takeout_open_time[0].start?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].start),"-","undefined"==typeof shopItem.takeout_open_time[0].end?"":baidu.template._encodeHTML(shopItem.takeout_open_time[0].end),"</span>"),_template_fun_array.push("")):5==shopItem.bussiness_status&&(_template_fun_array.push('<span class="status order">仅预定</span>'),shopItem.bussiness_status_text&&_template_fun_array.push('<span class="business_time">',"undefined"==typeof shopItem.bussiness_status_text?"":baidu.template._encodeHTML(shopItem.bussiness_status_text),"</span>"),_template_fun_array.push("")),_template_fun_array.push('</div><div class="shop-msg"><span>起送费￥',"undefined"==typeof(Math.round(100*Number(shopItem.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(shopItem.takeout_price))/100),"</span><span>配送费"),shopItem.discount_info&&1==shopItem.discount_info.is_discount_send?_template_fun_array.push("<del>￥0</del>"):_template_fun_array.push("￥","undefined"==typeof(parseInt(shopItem.takeout_cost)||"0")?"":baidu.template._encodeHTML(parseInt(shopItem.takeout_cost)||"0"),""),_template_fun_array.push('</span><span class="">',"undefined"==typeof shopItem.delivery_time?"":baidu.template._encodeHTML(shopItem.delivery_time),"分钟</span></div></div></div>");var className=shopItem.filtered_act_info?"warefare-details-card":"warefare-details-card noicon";if(_template_fun_array.push('<div class="',"undefined"==typeof className?"":baidu.template._encodeHTML(className),'" data-node="warefareDetail">'),shopItem.filtered_act_info){_template_fun_array.push("");for(key in shopItem.filtered_act_info){_template_fun_array.push("                    ");var imgUrl=getIconUrl(shopItem.filtered_act_info[key].type);_template_fun_array.push("            <div class='card-warefare-list'>                           <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),shopItem.filtered_act_info[key].msg&&_template_fun_array.push("                           <div class='msg'>            ","undefined"==typeof shopItem.filtered_act_info[key].msg?"":baidu.template._encodeHTML(shopItem.filtered_act_info[key].msg),"            </div>            "),_template_fun_array.push("            </div>        ")}_template_fun_array.push("        ")}_template_fun_array.push("</div></li>")}_template_fun_array.push("")}_template_fun_array.push("</ul></section></div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],navList=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");for(var i=0,len=data.length;len>i;i++){var item=data[i],className=0===i?"active":"";className+=" dmac-b-navelem"+i,_template_fun_array.push('<div class="swiper-slide">    <div class="dmac-b-navelem ',"undefined"==typeof className?"":baidu.template._encodeHTML(className),'" data-sectionid="',"undefined"==typeof i?"":baidu.template._encodeHTML(i),'">        <span class="status underway">',"undefined"==typeof item.navText?"":baidu.template._encodeHTML(item.navText),"</span>    </div></div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],client=util.getParam("client"),channel=util.getParam("channel"),isnuomi="nuomi"===client;if(!isnuomi)var NABridge=require("mactivity:static/common/NABridge");var self=this,noShopPic="/static/mactivity/images/wap-empty-result_4419fce.png",page=1,limit=40,lock=!1,iconMap={xin:"http://waimai.baidu.com/static/static/icon/xin.png",jian:"http://img.waimai.bdimg.com/pb/ecbf2041aef946798bd72410a6deb2687b",coupon:"http://img.waimai.bdimg.com/pb/d2c17e9833a4b52a50e40977f9b44de67c",te:"http://img.waimai.bdimg.com/pb/c340bad3ab809b54b7822c0e3ff85fbca8",shop_coupon:"http://img.waimai.bdimg.com/pb/db68db1a8f48408d9106769a367fa95626",zhe:"http://img.waimai.bdimg.com/pb/568a1d0e3681c21960259b3e229f7e1bac",fan:"http://img.waimai.bdimg.com/pb/fc6a74df6835bad880836e3d0244bcbfbd",preorder:"http://img.waimai.bdimg.com/pb/748db67219d28327b463b76955d1b92465",payenjoy:"http://img.waimai.bdimg.com/pb/ab0724c51e4281a9e16bb40827b956a004",mian:"http://img.waimai.bdimg.com/pb/4c68d001d877c970bb53fc572aaa53fa87",zeng:"http://img.waimai.bdimg.com/pb/1dd5b8833a40dfabbff22234de5a2a25a3",overtimepayment:"http://img.waimai.bdimg.com/pb/ec841f521ee2a7f9370abd2f3524b6d4ca",logistics:"http://img.waimai.bdimg.com/pb/0a9affecd9444565e60a840876701cc921",fanyue:"http://img.waimai.bdimg.com/pb/0fb0cf28b6f08192103caf4700aa9970cb",invoice:"http://img.waimai.bdimg.com/pb/763394b37b8e152250ddeaf7bb2c3f81a2",express:"http://img.waimai.bdimg.com/pb/6c6680c3b5236c92d45b05ba400631c8f4",certification:"http://img.waimai.bdimg.com/pb/be63bd0c1d42ab132aa5e16f76683cfc6a",pay:"http://img.waimai.bdimg.com/pb/62800c42947c4cd2a00a4aa4f858125c04",tespe:"http://img.waimai.bdimg.com/pb/4dc32b3270cac1c5b24f25c7ac2ec47739",shop_couponspe:"http://img.waimai.bdimg.com/pb/c6ceb3bddebd20c4a98cc7f2701dc14e64",fanspe:"http://img.waimai.bdimg.com/pb/38d8a6c62ae78b79964614fad4155a9f90",coupon_amount:"http://img.waimai.bdimg.com/pb/01b4720f40d16ab426c91b89dc17d7e7fa"};module.exports=Widget.extend({el:"#shop-list-container",channels:{"activity.common.shopList show_list":"_renderShopList","activity.common.noShop no_list":"_renderNoShop","activity.common.shopData get_data":"_getDataByAjax"},init:function(e){self=this,this.config=e.config,this.data=e.data,!isnuomi&&NABridge.openInUrl("getAppVersion","",function(e){window.appversion=e.result})},bindEvent:function(){var e=this;$("label.youhui").on("click"),$("label.youhui").on("click",function(a){e.toggleCoupon(a,this)})},toggleCoupon:function(e,a){e.stopPropagation(),e.preventDefault(),$(a).parents(".shop-item-wrapper").find(".warefare-details-card").toggle()},_renderNoShop:function(){listener.trigger("activity.common.location","changeIcon");var e="";e+="<li class='no_res'>",e+='<p class="">附近没有参加活动的餐厅</p>',e+="</li>",this.$el.html(e)},_cutData:function(e){if(e&&e.data&&e.data.rule_content){var a={},t=e.data.rule_content[0]&&e.data.rule_content[0].zhuanqu;return 0==e.errno&&t&&(a=e.data.rule_content[0].zhuanqu),a}},_renderShopList:function(e,a){var t=this,s=this._cutData(a);if(s&&!s.length)return void this._renderNoShop();if(this.$el.find(".loading").addClass("hide"),s&&"{}"!=JSON.stringify(s)){t._initScroll();var i=list({data:s,recall_info:"",city_info:s.data_notice?s.data_notice:"",channel:util.getParam("channel")});$(".swiper-wrapper").html(navList({data:s}));var n=$(".swiper-slide").length,p=n>3?4:n;new Swiper(".swiper-container",{slidesPerView:p,freeMode:!0}),$(".dmac-b-navlist").css("opacity",1),!$(".zhuanImg").length&&this.$el.prepend('<div class="zhuanImg"><img src="'+s[0].wapZhuanUrl+'"/></div>'),this.$el.append(i),this.bindEvent()}else t._renderNoShop();$(".lazy").lazyload({})},_getDataByAjax:function(e,a){var t=location.href;t=t+"&lng="+a.lng+"&lat="+a.lat+"&display=json&async=1",$.ajax({type:"get",dataType:"json",url:t,success:function(e){self._renderShopList("",e)},error:function(){self._renderNoShop()}})},_initScroll:function(){var e=this;$(window).off("scroll").on("scroll",function(){var a=$(document).height(),t=$(window).height();if(a<=t+$(window).scrollTop()+20&&!lock){$(".scroll-loading").remove(),e.$el.append('<div class="scroll-loading">上拉加载商户...</div>'),lock=!0,page++;var s={page:page,limit:limit,display:"json",async:!0};$.ajax({type:"GET",url:location.href,dataType:"json",data:s,success:function(a){$(".scroll-loading").addClass("hide"),a.data.rule_content[0].zhuanqu&&a.data.rule_content[0].zhuanqu.length?(e._renderShopList("",a),lock=!1):(!$(".over").length&&$("#shop-list-container").append("<p class='over'>全部加载完啦！</p>"),lock=!0)},error:function(){e._renderNoShop()}})}})}})});
;/*!/widget/common/activeLocation/location_h5.js*/
define("mactivity:widget/common/activeLocation/location_h5",function(t,a,o){var i=t("mactivity:static/common/stat"),s=function(){this.opts={enableHighAcuracy:!0,timeout:5e3}};s.prototype.locate=function(t,a){var o=this;lbstag&&lbstag.geolocation.getCurrentPosition(function(s){s?(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Success",da_act:"show"}),o.getAddressByBaidu(s,t,a)):(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Fail",da_act:"show"}),a&&a())},function(t){a&&a(t)},o.opts)},s.prototype.getAddressByBaidu=function(t,a,o){$.ajax({url:"/shopui/api/geo",type:"GET",dataType:"json",data:{lat:t.coords.y,lng:t.coords.x,display:"json"},success:function(o){if(o){var i={};i.address=o.result.poi_address,i.lat=t.coords.y,i.lng=t.coords.x,a(i)}},error:function(){o&&o(),alert("网络异常，请稍后重试")}})},o.exports=new s});
;/*!/widget/common/activeLocation/newlocation.js*/
define("mactivity:widget/common/activeLocation/newlocation",function(t,o,n){var a=(t("mactivity:static/common/Cookie"),t("mactivity:static/common/utils")),i=t("mactivity:widget/common/activeLocation/locationH5/positionManager"),e=t("mactivity:widget/common/activeLocation/locationH5/location_h5"),c=t("mactivity:static/common/coordService"),r=a.getParam("third_party")||"",d="nuomi"===r,s=navigator.userAgent.indexOf("MicroMessenger")>=0;n.exports=Widget.extend({el:"#location-searchbox",events:{'click [data-node="changeCity"]':"_changeCity"},channels:{"activity.common.location changeIcon":"_changeIcon"},NALocation:!1,NAReady:!1,LLtoMC:function(t){var o=20037508.34*Number(t[0])/180,n=Math.log(Math.tan((90+Number(t[1]))*Math.PI/360))/(Math.PI/180)*20037508.34/180;return[o,n]},setWXconfig:function(t){var o=$.extend({debug:!1,jsApiList:["getLocation"]},t);wx.config(o)},init:function(t){var o=this;o.judgeNa(t.token),o.initUrlParams(),o._fngetUrlAddr()||setTimeout(function(){!o.NALocation&&o._fngetAddr()},300)},judgeNa:function(t){var o=this,n=function(){o.$dom.changeCity.hide()};if(d){n();return void o._fngetNmAddr()}document.addEventListener("WMAppReady",function(){o.NALocation=!0,o.NAReady=!0,n(),o._fngetNaAddr()}),s&&(n(),o.setWXconfig(t),o.NALocation=!0,o.NAReady?o._fngetWXAddr():wx.ready(function(){o.NAReady=!0,o._fngetWXAddr()}))},initUrlParams:function(){this.params={channel:"",needlocation:"",lat:"",cityid:"",address:"",type:""},$.extend(this.params,a.getParams())},_fngetUrlAddr:function(){var t=this;if(t.params.lat&&t.params.lng){var o={};return o.coords={},o.coords.y=t.params.lat,o.coords.x=t.params.lng,t._triggerData({lat:t.params.lat,lng:t.params.lng}),t._getPioAddr(o),!0}return!1},_fngetAddr:function(){var t=this;if(i.getPosition().lat&&i.getPosition().lng){var o=i.getPosition();return t._triggerData(o),void t._showLocationIcon(o.address)}try{e.locate(function(o){t._triggerData({lng:o.lng,lat:o.lat}),t._showLocationIcon(o.address)},function(){t._showLocationIcon(),t._renderNoShop()})}catch(n){t._renderNoShop()}},_fngetNaAddr:function(){var t=this;if("undefined"!=typeof WMApp){var o=WMApp.location.getSyncLocation(),n={};o.lat&&o.lng?(n.lat=o.lat,n.lng=o.lng):o.locLat&&o.locLng?(n.lat=o.locLat,n.lng=o.locLng):(n.lat=WMApp.location.getLocLat(),n.lng=WMApp.location.getLocLng()),this._triggerData(n),o.address||(o.address=WMApp.location.getAddress()),t._showLocationIcon(o.address)}},_fngetNmAddr:function(){var t=this;BNJSReady(function(){if(BNJS.location.hasLocation){var o={lat:BNJS.location.latitude,lng:BNJS.location.longitude};t._triggerData(o),address=BNJS.location.address,address||t._showLocationIcon(address)}})},_fngetWXAddr:function(){var t=this;wx.getLocation({type:"wgs84",success:function(o){alert(o.longitude+" "+o.latitude);var n=c.convertLL2MC([o.longitude,o.latitude]),a={lng:n[0],lat:n[1]};t._triggerData(a);var i={};i.coords={},i.coords.x=a.lng,i.coords.y=a.lat,t._getPioAddr(i)},fail:function(){alert("微信定位无法使用~")}})},_changeCity:function(){var t="http://"+window.location.host+window.location.pathname,o={};$.extend(o,this.params),$.extend(o,{lat:"",lng:""});var n=0;for(var a in o)a&&(t+=(0===n++?"?":"&")+a+"="+o[a]);location.href="/mobile/waimai?qt=confirmcity&url="+encodeURIComponent(t)},_changeIcon:function(){$(".shop-list-title img").css("visibility","hidden"),this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location")},_showLocationIcon:function(t){t?(this.$dom.icon.removeClass("icon-sug-error").addClass("icon-location"),this.$dom.address.html(t)):(this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"))},_getPioAddr:function(t){var o=this;e.getAddressByBaidu(t,function(n){n.address?o._showLocationIcon(n.address):o._ajaxAddr(t)},function(){o._ajaxAddr(t)})},_ajaxAddr:function(t){var o=this;$.ajax({url:"http://api.map.baidu.com/?qt=rgc_standard&callback=",data:{x:t.coords.x,y:t.coords.y,dis_poi:"100",poi_num:"10",ie:"utf-8",oue:"1",res:"api"},context:this,dataType:"jsonp",success:function(t){return t.content&&t.content.address?void o._showLocationIcon(t.content.address):void o._showLocationIcon()},error:function(){o._showLocationIcon()}})},_renderNoShop:function(){this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"),setTimeout(function(){listener.trigger("activity.common.noShop","no_list"),window.loadData&&"function"==typeof window.loadData&&window.loadData()})},_renderShopLit:function(t){setTimeout(function(){listener.trigger("activity.common.shopList","show_list",t)})},_triggerData:function(t){window.loadData&&"function"==typeof window.loadData&&window.loadData(t),setTimeout(function(){listener.trigger("activity.common.shopData","get_data",t)})}})});