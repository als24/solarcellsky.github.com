var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?i(o):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},i.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},i.onResourceLoadComplete=function(e){"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},i.createScene=function(){if(this.isThemeLoadEnd&&this.isResourceLoadEnd){var e=new Index;this.stage.addChild(e),this.stage.removeChild(this)}},i.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},i.onResourceProgress=function(e){"preload"==e.groupName},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,i){function o(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Index=function(e){function t(){e.call(this),this.skinName="IndexSkin",this.bg_mp3=RES.getRes("bg_mp3").play(0,-1),this.rank=new Rank,this.panel_rank.addChild(this.rank),this.mobileURI="http://node.ekche.com:3001/mobile?rid="+window.srvConfig.rid,console.log("<===>",this.mobileURI),window.qrCode.show(this.mobileURI),this.isGameStart=!1,this.init()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){this.socket=new Socket(this),this.initEvent(),this.moveFly()},i.initEvent=function(){this.btn_start.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){window.qrCode.hide(),RES.getRes("click_wav").play(0,1),this.socket.sendStart.call(this.socket)},this),this.btn_again.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.again,this)},i.getError=function(e){console.log(e.msg)},i.moveFly=function(){for(var e=1;12>=e;e++){var t=this["fly"+e];t.org||(t.org=[t.x,t.y]);var n=t.org[0],i=t.org[1];egret.Tween.get(t).to({x:n,y:i,alpha:1},1500).call(function(){var e=this.org[0],t=this.org[1],n=200*(Math.random()-.5),i=200*(Math.random()-.5),o=60*Math.sqrt(n*n+i*i),s=2e3*Math.random();egret.Tween.get(this,{loop:!0}).to({x:e+n,y:t+i},o).wait(s).to({x:e,y:t},o)},t)}},i.stopFly=function(){for(var e=1;12>=e;e++){var t=this["fly"+e],n=t.x,i=t.y,o=200*(Math.random()-.5),s=100*(Math.random()-.5);egret.Tween.pauseTweens(t),egret.Tween.get(t).to({x:n+o,y:i+s,alpha:0},800)}},i.gameStart=function(e){console.log("==> 游戏开始"),this.bg_mp3.stop(),this.fight_mp3=RES.getRes("fight_mp3").play(0,-1),this.isGameStart=!0,this.cdTime=e,this.panel_info.visible=!1,this.panel_rank.visible=!0,this.countDown(),this.treeShake(),this.stopFly(),this.showLuckyMoney()},i.showLuckyMoney=function(){var e=this,t=setInterval(function(){if(!e.isGameStart)return void clearInterval(t);var n=new eui.Image,i=300*Math.random();n.source="mn_png",n.y=50,n.x=1300*Math.random()+100,e.tree.addChildAt(n,2),n.rotation=40,egret.Tween.get(n).to({y:930,rotation:i+n.rotation,alpha:.7},1500).call(function(){e.tree.removeChild(this)},n)},300)},i.updateUsers=function(e){this.users.text=e},i.countDown=function(){var e=Number(this.cdTime);console.log(e);var t=new egret.Timer(1e3,e);this.time.text=""+e,t.addEventListener(egret.TimerEvent.TIMER,function(){this.time.text=""+--e},this),t.start()},i.treeShake=function(){var e=this.leaf1.x,t=this.leaf2.x,n=this.leaf3.x,i=30,o=120;egret.Tween.get(this.leaf1,{loop:!0}).to({x:e+i},200).to({x:e-i},200),egret.Tween.get(this.leaf2,{loop:!0}).to({x:t-i},o).to({x:t+i},o),egret.Tween.get(this.leaf3,{loop:!0}).to({x:n+i},o).to({x:n-i},o)},i.treeStopShake=function(){egret.Tween.pauseTweens(this.leaf1),egret.Tween.pauseTweens(this.leaf2),egret.Tween.pauseTweens(this.leaf3)},i.again=function(){RES.getRes("click_wav").play(0,1),this.time.visible=this.time_bg.visible=!0,this.btn_again.visible=!1,this.panel_rank.visible=!1,this.panel_info.visible=!0,this.rank.update([]),window.qrCode.show(this.mobileURI)},i.gameOver=function(){console.log("游戏结束"),this.fight_mp3.stop(),this.bg_mp3=RES.getRes("bg_mp3").play(0,-1),this.treeStopShake(),this.moveFly(),this.time.visible=!1,this.time_bg.visible=!1,this.btn_again.visible=!0,this.isGameStart=!1},i.reset=function(){},t}(eui.Component);egret.registerClass(Index,"Index");var Rank=function(e){function t(){e.call(this),this.createDataGroupByTypeScript()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createDataGroupByTypeScript=function(){var e=new eui.DataGroup;e.layout=new eui.VerticalLayout,e.itemRenderer=LabelRender,e.dataProvider=this.collection=new eui.ArrayCollection,this.addChild(e),e.width=700,e.height=1e3,e.x=0,e.y=300},i.update=function(e){this.collection.removeAll(),this.collection.source=e},t}(egret.Sprite);egret.registerClass(Rank,"Rank");var LabelRender=function(e){function t(){e.call(this),this.skinName="rankSkin",this.bgSource=["list_red_png","list_yellow_png","list_yellow_png","list_green_png"]}__extends(t,e);var n=(__define,t),i=n.prototype;return i.dataChanged=function(){if(this.data){var e=Math.min(this.itemIndex,3);this.avatar.source=this.data.avatar,this.bgBar.source=this.bgSource[e],this.rank.text=""+(this.itemIndex+1),this.nickname.text=this.data.name,this.score.text=this.data.score}},t}(eui.ItemRenderer);egret.registerClass(LabelRender,"LabelRender");var Socket=function(){function e(e){this.parent=e,this.connect()}var t=(__define,e),n=t.prototype;return n.connect=function(){var e=this;this.sck=io.connect("http://"+window.config.host+":"+window.config.port+"/screen"),this.sck.on("connect",function(){e.doLogin.call(e),e.initSocketEvent.call(e)})},n.initSocketEvent=function(){var e=this.sck,t=this.parent;e.on("gameStart",function(e){!t.isGameStart&&t.gameStart.call(t,e.time)}),e.on("userJoin",function(e){console.log("userJoin",e),!t.isGameStart&&t.updateUsers.call(t,e)}),e.on("rank",function(e){console.log(e),t.isGameStart&&t.rank.update.call(t.rank,e)}),e.on("gameOver",function(){console.log("gameOver"),t.gameOver.call(t),t.updateUsers.call(t,0)})},n.doLogin=function(){this.sck.emit("login",{rid:window.srvConfig.rid})},n.sendStart=function(){this.sck.emit("gameStart")},e}();egret.registerClass(Socket,"Socket");