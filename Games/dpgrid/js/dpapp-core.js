!function(){function e(e,t){for(var n in t)e[n]=t[n];return e}var t="promise@^6.1.0",n="dpapp-core@1.1.2/lib/core.js",o="dpapp-core@1.1.2/lib/native-core.js",i="dpapp-core@1.1.2/lib/network.js",a="dpapp-core@1.1.2/lib/apis.js",r="dpapp-core@1.1.2/lib/decorate.js",c="dpapp-core@1.1.2/lib/queue.js",s="dpapp-core@1.1.2/lib/index.js",u={},l=u;define(s,[t,n,o,i],function(e,t,n){var o=e("./core"),i=e("./native-core"),a=e("./network"),r=e("promise");o.prototype._mixin(o.prototype,i),o.prototype._mixin(o.prototype,a),o.prototype.all=function(e){return r.all(e)},n.exports=o},{main:!0,map:e({"./core":n,"./native-core":o,"./network":i},l)}),define(n,[a,r],function(e,t,n){function o(e,t){for(var n in t)e[n]=t[n];return e}var i=n.exports=function(t){t=t||{};var n=this;for(var o in t)this[o]=t[o];var i=t.apis||e("./apis");(t.extraApis||[]).forEach(function(e){-1===i.indexOf(e)&&i.push(e)}),this.apis=i,this.allowBeforeReady=this.allowBeforeReady||["getRequestId"],i.forEach(function(e){n[e]||(n[e]=function(t){n._send(e,t)})}),this.decorate()};i.prototype={_cfg:{debug:!1},_isProduct:!!location.href.match(".dianping.com"),_isReady:!1,config:function(e){for(var t in e)this._cfg[t]=e[t]},isOldVersion:function(){return!1},getQuery:function(){var e=location.search.slice(1),t={};return e.split("&").forEach(function(e){var n=e.split("=");t[n[0]]=n[1]}),t},patchForType:function(e,t){this.uaType()==e&&(this.extend(t),this.decorate())},decorate:e("./decorate"),Semver:{eq:function(e,t){return e===t},gt:function(e,t){var n=e?e.split("."):[],o=t?t.split("."):[];return[0,1,2].forEach(function(e){n[e]=n[e]||0,o[e]=o[e]||0}),+n[0]!==+o[0]?+n[0]>+o[0]:+n[1]!==+o[1]?+n[1]>+o[1]:+n[2]>+(o[2]||0)},lt:function(e,t){return!this.gte(e,t)},gte:function(e,t){return this.eq(e,t)||this.gt(e,t)},lte:function(e,t){return this.eq(e,t)||this.lt(e,t)}},_parseUA:function(e){var t,n,o;return e.match(/iPhone/)?(t="iphone",n=e.match(/iPhone\sOS\s([\d_]+)/i)[1].replace(/_/g,".")):e.match(/Android/)?(t="android",o=e.match(/Android[\s|\/]([\w\.]+)/),n=o&&o[1]):(t=null,n=null),{name:t,version:n}},getTypeFromUA:function(e){return/dp\/com\.dianping\.(\w+)\//.test(e)?e.match(/dp\/com\.dianping\.(\w+)\//)[1]:"web"},uaType:function(){return this.getTypeFromUA(navigator.userAgent)},_trace:function(e,t){if(this.hippoPrefix){var n=this._cfg&&this._cfg.logFact||.05;t=t||{},t=this._mixin(t,{module:this.hippoPrefix+"_"+e}),Math.random()<n&&(console.log("_trace",e),window._hip&&_hip.push(["mv",t]))}},log:function(){for(var e=[],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):void 0!=arguments[t]&&e.push(JSON.stringify(arguments[t]));e=e.join(" "),this._cfg&&this._cfg.debug?setTimeout(function(){alert(e)}):console.log(e)},_mixin:o,extend:function(e){return this._mixin(this,e)},_notImplemented:function(e){e&&e.fail&&e.fail({errMsg:"ERR_NOT_IMPLEMENTED"})},isSupport:function(e){var t=this[e];return!(!t||"function"!=typeof t||t==this._notImplemented||1==t._notReady)}},i.prototype._osUA=i.prototype._parseUA(navigator.userAgent)},{map:e({"./apis":a,"./decorate":r},l)}),define(o,[c],function(e,t,n){var o={},i=["appear","disappear"],a=e("./queue"),r=a(function(e){DPApp._doSendMessage(e.method,e.args,e.callback)});n.exports={_dequeueTimeout:null,dequeue:function(){var e=this;setTimeout(function(){DPApp&&DPApp.log&&DPApp.log("Dequeue"),clearTimeout(this._dequeueTimeout),e._dequeueTimeout=null,r.dequeue()},0)},ready:function(e){var t=this;this._send("ready",{success:function(){t._isReady=!0,e()}})},openScheme:function(e){var t=e.url,n=e.extra;n&&(t+="?"+this._convertUrlParams(n),delete e.extra,e.url=t),this._send("openScheme",e)},_sendMessage:function(e,t,n){var o=this;r.push({method:e,args:t,callback:n}),this._dequeueTimeout=setTimeout(function(){o.dequeue()},1e3)},_generateCallbackId:function(){var e=Math.floor(1e3*Math.random()),t=(+new Date).toString(),n=t.substr(t.length-5,5);return+(n+""+e)},_generateCallbackName:function(e){return"DPApp_callback_"+e},_doSendMessage:function(e,t,n){var o=n&&"function"==typeof n;this.log("调用方法",e,t);var i=o?this._generateCallbackId():0;o&&(window[this._generateCallbackName(i)]=n),t&&"object"==typeof t||(t={}),t.callbackId=i,t=JSON.stringify(t);var a="js://_?method="+e+"&args="+encodeURIComponent(t)+"&callbackId="+i;this.log("创建iframe "+e,"callbackId:"+i),this._createIframe(a)},_createNode:function(e,t){function n(){o.onload=o.onerror=null,o.parentNode&&o.parentNode.removeChild(o)}var o=document.createElement(t);o.style.display="none",o.onload=o.onerror=n,setTimeout(n,5e3),o.src=e,document.body.appendChild(o)},_createIframe:function(e){this._createNode(e,"iframe")},_send:function(e,t){t=t||{};var n=this,o=t.success,i=t.fail,a=t.handle,r=function(t){n.log("调用失败 "+e,t),i&&i.call(n,t)},c=function(t){n.log("调用成功 "+e,t),o&&o.call(n,t)},s=function(t){n.log("回调 "+e,t),a&&a.call(n,t)},u=o||i||a?function(e){var t=e.status;"next"!=e.result&&delete e.result,"success"==t?c&&c(e):"action"==t?s&&s(e):r&&r(e)}:null;this._sendMessage(e,t,u)},_convertUrlParams:function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},_sanitizeAjaxOpts:function(e){e.method=e.method||"get",e.data=e.data||"";var t=e.url,n=e.data;if("get"==e.method){var o=[];for(var i in n)n.hasOwnProperty(i)&&(n[i]||0===n[i])&&o.push(i+"="+encodeURIComponent(n[i]));o.length&&(t+=-1==t.indexOf("?")?"?":"&",t+=o.join("&")),e.url=t,delete e.data}return e},_parseFeed:function(e){var t;return e?e.constructor.toString().indexOf("Array")>=0?(t=[0,0,0,0,0,0,0,0],e.forEach(function(e){t[7-e]=1}),parseInt(t.join(""),2)):void 0:255},_transModel:function(e,t){function n(e){var t=function(e){var t,n,o,i=0;if(0==e.length)return i;for(t=0,o=e.length;o>t;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i},n=t(e);return"0x"+(65535&n^n>>>16).toString(16)}function o(e){return"[object Array]"==Object.prototype.toString.call(e)}function i(e){return"[object Object]"==Object.prototype.toString.call(e)}function a(e){if(i(e)){delete e.__name;for(var t in e){var n;r[t]&&(n=e[r[t]]=e[t],a(n),delete e[t])}}else o(e)&&e.forEach(function(e){a(e)});return e}if(!e)return t;var r={};return e.forEach(function(e){r[n(e)]=e}),a(t)},_capital:function(e){return e.slice(0,1).toUpperCase()+e.slice(1)},subscribe:function(e){function t(e){o[c]&&o[c].length&&o[c].forEach(function(t){t&&t(e)})}function n(){a&&(r[a]=t,e.success&&e.success())}var a,r=this,c=e.action,s=(e.success,e.handle);o[c]?(e.success&&e.success(),o[c].push(s)):(-1!=i.indexOf(c)?(a="on"+r._capital(c),"scroll"==c?this._send(a,{success:n}):n()):this._send("subscribe",{action:c,success:e.success,handle:t}),o[c]=[s])},unsubscribe:function(e){function t(){c[l]=NOOP}var n=e.action,a=e.success,r=e.handle,c=this,s=o[n]?o[n].indexOf(r):-1;if(-1!=s?(o[n].splice(s,1),a&&a(),o[n].length||(o[n]=null)):r||(o[n]=null),!o[n])if(-1!=i.indexOf(n)&&after7_6){var u="off"+c._capital(n),l="on"+c._capital(n);"scroll"==n?this._send(u,{success:t}):t()}else this._send("unsubscribe",{action:n,success:a})},getUA:function(){},callback:function(e,t){var n=window,o=this._generateCallbackName(e),i=window[o];i&&(this.log("触发回调 ","callbackId:"+e),setTimeout(function(){i&&i.call(self,t)}),("complete"==t.result||"error"==t.result)&&(n[o]=null,delete n[o]))}}},{map:e({"./queue":c},l)}),define(i,[],function(e,t,n){n.exports={_iOSNetworkType:function(e){function t(e){switch(e){case"CTRadioAccessTechnologyGPRS":case"CTRadioAccessTechnologyEdge":case"CTRadioAccessTechnologyCDMA1x":return"2g";case"CTRadioAccessTechnologyLTE":return"4g";case"CTRadioAccessTechnologyWCDMA":case"CTRadioAccessTechnologyHSDPA":case"CTRadioAccessTechnologyHSUPA":case"CTRadioAccessTechnologyCDMA1x":case"CTRadioAccessTechnologyCDMAEVDORev0":case"CTRadioAccessTechnologyCDMAEVDORevA":case"CTRadioAccessTechnologyCDMAEVDORevB":case"CTRadioAccessTechnologyeHRPD":return"3g"}}var n,o={kSCNetworkReachabilityFlagsTransientConnection:1,kSCNetworkReachabilityFlagsReachable:2,kSCNetworkReachabilityFlagsConnectionRequired:4,kSCNetworkReachabilityFlagsConnectionOnTraffic:8,kSCNetworkReachabilityFlagsInterventionRequired:16,kSCNetworkReachabilityFlagsConnectionOnDemand:32,kSCNetworkReachabilityFlagsIsLocalAddress:65536,kSCNetworkReachabilityFlagsIsDirect:1<<17,kSCNetworkReachabilityFlagsIsWWAN:1<<18},i=+e.type,a=e.subType;return 0==(i&o.kSCNetworkReachabilityFlagsReachable)?"none":(0==(i&o.kSCNetworkReachabilityFlagsConnectionRequired)&&(n="wifi"),(0!=(i&o.kSCNetworkReachabilityFlagsConnectionOnDemand)||0!=(i&o.kSCNetworkReachabilityFlagsConnectionOnTraffic))&&0==(i&o.kSCNetworkReachabilityFlagsInterventionRequired)&&(n="wifi"),(i&o.kSCNetworkReachabilityFlagsIsWWAN)==o.kSCNetworkReachabilityFlagsIsWWAN&&(n=t(a)),n)},_androidNetworkType:function(e){var t=e.type,n=e.subType;if(0==t)switch(n){case 1:case 2:case 4:case 7:case 11:return"2g";case 3:case 5:case 6:case 8:case 9:case 10:case 12:case 14:case 15:return"3g";case 13:return"4g"}return 1==t?"wifi":"none"},getNetworkType:function(e){var t=this,n=e.success;this._send("getNetworkType",{success:function(e){var o,i=t._osUA;switch(i.name){case"iphone":o=this._iOSNetworkType(e);break;case"android":o=this._androidNetworkType(e)}n&&n({networkType:o,raw:{type:e.type,subType:e.subType}})},fail:e.fail})}}},{map:l}),define(a,[],function(e,t,n){n.exports=["getVersion","getNetworkType","getContactList","pickContact","getRequestId","getDeviceInfo","clearStorage","store","retrieve","publish","subscribe","unsubscribe","openScheme","jumpToScheme","closeWindow","sendSMS","downloadImage","setBackgroundColor","setTitle","setLLButton","setLRButton","setRLButton","setRRButton","isInstalledApp","alert","prompt","confirm","actionSheet"]},{map:l}),define(r,[t],function(e,t,n){var o=e("promise");n.exports=function(e){var t=this,n=this.apis,e=this.allowBeforeReady;n.forEach(function(e){t[e]||(t[e]=t._notImplemented)}),n.forEach(function(n){var i=t[n];t[n]&&t[n]._decorated||(t[n]=function(a){var r=t._mixin({},a);t._trace(n+"_call");var c=r.success,s=r.fail,u=function(e){if(s)s(e);else if(t.onerror)t.onerror({api:n,err:e});else{var o=e.errMsg?e.errMsg:JSON.stringify(e),i=new Error(o);i.name="DPAppError",console.warn("`DPApp."+n+"` call faild"),t._trace("throw"),console.warn(new Error(i))}},l=+new Date;return r.success=function(e){t._trace(n+"_success",{time:+new Date-l}),c&&c(e)},r.fail=function(e){var o={};o.args=a,o.result=e,t._trace(n+"_fail",{time:+new Date-l,note:JSON.stringify(o)}),u(e)},this._isReady||-1!==e.indexOf(n)||t._isProduct||!t.isOldVersion()?new o(function(e,n){var o=r.success,a=r.fail,c=function(t){o(t),e(t)},u=function(e){a(e),s||n(e)};r.success=c,r.fail=u,i.call(t,r)}):void u("use `DPApp.ready(fn)` to wrap api calls")},t[n]._decorated=!0,t[n]._notReady=i==t._notImplemented)})}},{map:l}),define(c,[],function(e,t,n){n.exports=function(e){var t=null,n=null,o={timeout:null,running:!1,tasks:[],push:function(e,t){var n=t||function(){};o.tasks.push({data:e,callback:n}),setTimeout(function(){o.process()},0)},dequeue:function(){n?n():o.running=!1},process:function(){if(o.tasks.length&&!o.running){var i=o.tasks.shift();o.running=!0,n=function(){o.running=!1,i.callback(i.data),o.process()},t=i.data,e(i.data,n)}}};return o}},{map:l})}();