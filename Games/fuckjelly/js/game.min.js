/*! jelly-collapse - 06a7a933608e-spil-zibbo minimified build */
var resources;!function(a){a.layout={TitleScreen:{CreditsButton:{id:"CreditsButton",x:512.45,y:657.6},PlayButton:{id:"PlayButton",x:320,y:512.95},GameTitle:{id:"GameTitle",x:0,y:35.5},ResetProgressButton:{id:"ResetProgressButton",x:127.85,y:657.6},MusicButton:{id:"MusicButton",x:488.95,y:59.6},SoundFXButton:{id:"SoundFXButton",x:581.55,y:59.6}},GameScreen:{GameMenuButton:{id:"GameMenuButton",x:62,y:50},ScoreText:{id:"ScoreText",x:395.15,y:9.25},LevelText:{id:"LevelText",x:116.75,y:7.2},BadgeText:{id:"BadgeText",x:116.75,y:58.9},BadgeLabel:{id:"BadgeLabel",x:55.55,y:-67.75},ProgressBar:{id:"ProgressBar",x:366.2,y:86.15},GoalText:{id:"GoalText",x:401.55,y:58.6}},GameOverScreen:{ScoreText:{id:"ScoreText",x:180.75,y:190.05},BestScoreText:{id:"BestScoreText",x:206.75,y:246.25},GameOverTitle:{id:"GameOverTitle",x:158.85,y:78.15},RestartButton:{id:"RestartButton",x:407.4,y:412.6},QuitButton:{id:"QuitButton",x:227.05,y:412.6},QuitLabel:{id:"QuitLabel",x:195.55,y:473.9},PlayAgainLabel:{id:"PlayAgainLabel",x:356.9,y:473.9}},GamePauseScreen:{ContinueLabel:{id:"ContinueLabel",x:247.4,y:370.2},QuitLabel:{id:"QuitLabel",x:210.45,y:530.25},RestartLabel:{id:"RestartLabel",x:341.15,y:528.25},PlayButton:{id:"PlayButton",x:319.1,y:278.05},RestartButton:{id:"RestartButton",x:401.4,y:471.6},QuitButton:{id:"QuitButton",x:241.1,y:473.6},MusicButton:{id:"MusicButton",x:488.95,y:59.6},SoundFXButton:{id:"SoundFXButton",x:581.55,y:59.6}},CreditsScreen:{PlayButton:{id:"PlayButton",x:321.1,y:637.1}},SponsorTitleScreen:{CreditsButton:{id:"CreditsButton",x:538.45,y:535.7},PlayButton:{id:"PlayButton",x:324.15,y:455.05},GameTitle:{id:"GameTitle",x:0,y:35.6},ResetProgressButton:{id:"ResetProgressButton",x:113,y:535.2},MusicButton:{id:"MusicButton",x:502.95,y:59.7},SoundFXButton:{id:"SoundFXButton",x:595.55,y:59.7},MoreGamesButton:{id:"MoreGamesButton",x:541.1,y:672.1},SponsorLogo:{id:"SponsorLogo",x:113.9,y:670.8}},ResetDialog:{RestartButton:{id:"RestartButton",x:173.85,y:481.7},QuitButton:{id:"QuitButton",x:481.15,y:481.7}},tutorialExtraShapes:{TutorialBlock$1:{id:"TutorialBlock$1",x:-71.5,y:-40.05},TutorialBlock$2:{id:"TutorialBlock$2",x:-4.3,y:-40.05},TutorialBlock$3:{id:"TutorialBlock$3",x:63.05,y:-40.05},TutorialBlock$4:{id:"TutorialBlock$4",x:-37.9,y:-106},TutorialBlock$5:{id:"TutorialBlock$5",x:29.3,y:-106}},tutorialCreateBomb:{TutorialBlock$1:{id:"TutorialBlock$1",x:-169.5,y:-38.05},TutorialBlock$2:{id:"TutorialBlock$2",x:-102.3,y:-38.05},TutorialBlock$3:{id:"TutorialBlock$3",x:-34.95,y:-38.05},TutorialBlock$4:{id:"TutorialBlock$4",x:-135.9,y:-104},TutorialBlock$5:{id:"TutorialBlock$5",x:-68.7,y:-104},TutorialBlock$6:{id:"TutorialBlock$6",x:33.75,y:-39.05},TutorialBlock$7:{id:"TutorialBlock$7",x:100.95,y:-39.05},TutorialBlock$8:{id:"TutorialBlock$8",x:168.3,y:-39.05},TutorialBlock$9:{id:"TutorialBlock$9",x:67.35,y:-105},TutorialBlock$10:{id:"TutorialBlock$10",x:134.55,y:-105}},GameOverChain1:{GlueyBlock1_1x1$1:{id:"GlueyBlock1_1x1$1",x:-112,y:-70},GlueyBlock1_1x1$8:{id:"GlueyBlock1_1x1$8",x:-52,y:50},GlueyBlock1_1x1$9:{id:"GlueyBlock1_1x1$9",x:8,y:50},GlueyBlock1_1x1$3:{id:"GlueyBlock1_1x1$3",x:-111.4,y:-10},GlueyBlock1_1x1$4:{id:"GlueyBlock1_1x1$4",x:-52,y:-10},GlueyBlock1_1x1$2:{id:"GlueyBlock1_1x1$2",x:-52,y:-69.5},GlueyBlock1_1x1$7:{id:"GlueyBlock1_1x1$7",x:127.4,y:-10.55},GlueyBlock1_1x1$10:{id:"GlueyBlock1_1x1$10",x:127.35,y:52.9},GlueyBlock1_1x1$5:{id:"GlueyBlock1_1x1$5",x:8,y:-10},GlueyBlock1_1x1$6:{id:"GlueyBlock1_1x1$6",x:68,y:-10},GlueyBlock1_1x1$11:{id:"GlueyBlock1_1x1$11",x:188,y:-10}},GameOverChain2:{GlueyBlock1_1x1$1:{id:"GlueyBlock1_1x1$1",x:-100,y:-60},GlueyBlock1_1x1$8:{id:"GlueyBlock1_1x1$8",x:-40.6,y:60},GlueyBlock1_1x1$9:{id:"GlueyBlock1_1x1$9",x:20,y:60},GlueyBlock1_1x1$3:{id:"GlueyBlock1_1x1$3",x:-100,y:60},GlueyBlock1_1x1$4:{id:"GlueyBlock1_1x1$4",x:-100,y:0},GlueyBlock1_1x1$2:{id:"GlueyBlock1_1x1$2",x:-159.4,y:-60},GlueyBlock1_1x1$7:{id:"GlueyBlock1_1x1$7",x:140,y:0},GlueyBlock1_1x1$10:{id:"GlueyBlock1_1x1$10",x:140,y:60},GlueyBlock1_1x1$5:{id:"GlueyBlock1_1x1$5",x:20,y:0},GlueyBlock1_1x1$6:{id:"GlueyBlock1_1x1$6",x:80,y:0},GlueyBlock1_1x1$11:{id:"GlueyBlock1_1x1$11",x:200,y:60}},GameOverChain3:{GlueyBlock1_1x1$1:{id:"GlueyBlock1_1x1$1",x:10,y:-59.5},GlueyBlock1_1x1$8:{id:"GlueyBlock1_1x1$8",x:-50,y:60},GlueyBlock1_1x1$9:{id:"GlueyBlock1_1x1$9",x:10,y:60},GlueyBlock1_1x1$3:{id:"GlueyBlock1_1x1$3",x:-110,y:60},GlueyBlock1_1x1$4:{id:"GlueyBlock1_1x1$4",x:70,y:60},GlueyBlock1_1x1$2:{id:"GlueyBlock1_1x1$2",x:-50,y:0},GlueyBlock1_1x1$10:{id:"GlueyBlock1_1x1$10",x:130,y:59.45},GlueyBlock1_1x1$5:{id:"GlueyBlock1_1x1$5",x:10,y:0},GlueyBlock1_1x1$6:{id:"GlueyBlock1_1x1$6",x:70,y:0}},GameOverChain4:{GlueyBlock1_1x1$1:{id:"GlueyBlock1_1x1$1",x:-50,y:-60},GlueyBlock1_1x1$8:{id:"GlueyBlock1_1x1$8",x:-50,y:60},GlueyBlock1_1x1$9:{id:"GlueyBlock1_1x1$9",x:70,y:-60},GlueyBlock1_1x1$3:{id:"GlueyBlock1_1x1$3",x:-110,y:60},GlueyBlock1_1x1$4:{id:"GlueyBlock1_1x1$4",x:-49.4,y:0},GlueyBlock1_1x1$7:{id:"GlueyBlock1_1x1$7",x:69.4,y:0},GlueyBlock1_1x1$10:{id:"GlueyBlock1_1x1$10",x:130,y:-59.5},GlueyBlock1_1x1$5:{id:"GlueyBlock1_1x1$5",x:10,y:0},GlueyBlock1_1x1$6:{id:"GlueyBlock1_1x1$6",x:130,y:60},GlueyBlock1_1x1$11:{id:"GlueyBlock1_1x1$11",x:70,y:59.45}},SponsorGamePauseScreen:{ContinueLabel:{id:"ContinueLabel",x:248.4,y:326.2},QuitLabel:{id:"QuitLabel",x:211.45,y:518.3},RestartLabel:{id:"RestartLabel",x:332.4,y:516.45},PlayButton:{id:"PlayButton",x:320.1,y:234.05},RestartButton:{id:"RestartButton",x:392.65,y:459.8},QuitButton:{id:"QuitButton",x:242.1,y:461.65},MusicButton:{id:"MusicButton",x:488.95,y:59.6},SoundFXButton:{id:"SoundFXButton",x:581.55,y:59.6},MoreGamesButton:{id:"MoreGamesButton",x:530,y:647.3},SponsorLogo:{id:"SponsorLogo",x:110,y:650}},SponsorGameOverScreen:{ScoreText:{id:"ScoreText",x:180.75,y:187.05},BestScoreText:{id:"BestScoreText",x:206.75,y:243.25},GameOverTitle:{id:"GameOverTitle",x:158.85,y:78.15},RestartButton:{id:"RestartButton",x:407.4,y:406.6},QuitButton:{id:"QuitButton",x:227.05,y:406.6},QuitLabel:{id:"QuitLabel",x:195.55,y:467.9},PlayAgainLabel:{id:"PlayAgainLabel",x:356.9,y:467.9},MoreGamesButton:{id:"MoreGamesButton",x:530,y:600},SponsorLogo:{id:"SponsorLogo",x:110,y:599.05}}}}(resources||(resources={}));var storage;!function(a){function b(b){h=b,a.bestScore=+window.localStorage.getItem(g("BestScore"))||0,a.completedLevel=+window.localStorage.getItem(g("CompletedLevel"))||0,a.completedLevelScore=+window.localStorage.getItem(g("CompletedLevelScore"))||0}function c(b,c){b>a.completedLevel&&(a.completedLevel=b,a.completedLevelScore=c,window.localStorage.setItem(g("CompletedLevel"),""+a.completedLevel),window.localStorage.setItem(g("CompletedLevelScore"),""+a.completedLevelScore))}function d(b){b>a.bestScore&&(a.bestScore=b,window.localStorage.setItem(g("BestScore"),""+a.bestScore))}function e(){return a.completedLevel>0}function f(){a.bestScore=0,a.completedLevel=0,a.completedLevelScore=0,window.localStorage.setItem(g("CompletedLevel"),""+a.completedLevel),window.localStorage.setItem(g("CompletedLevelScore"),""+a.completedLevelScore),window.localStorage.setItem(g("BestScore"),""+a.bestScore)}function g(a){return h+"."+a}a.bestScore=0,a.completedLevel=0,a.completedLevelScore=0;var h;a.initialize=b,a.recordLevelComplete=c,a.recordScore=d,a.isGameProgressRecorded=e,a.resetProgress=f}(storage||(storage={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},sound;!function(a){function b(){a.settings.getMusicSupported()&&a.settings.getMusic()&&!q&&(q=createjs.Sound.play("music",createjs.Sound.INTERRUPT_ANY,0,0,-1,.2))}function c(a){a?(q&&(q.stop(),q=null),b(!0)):(q.stop(),q=null)}function d(){o("removefailed")}function e(){o("levelcomplete",0)}function f(){o("gameover",0)}function g(){o("chainremoved",0,.5)}function h(){o("buttontap",0,.25)}function i(){o("grayremoved",600,.5)}function j(){o("bonusblobs",0,.5)}function k(){o("powerupgranted",0,.5)}function l(){o("explode",0,.5)}function m(){var b=[createjs.WebAudioPlugin,createjs.HTMLAudioPlugin];createjs.Sound.BrowserDetect.isFirefox&&(b=[createjs.HTMLAudioPlugin]),createjs.Sound.registerPlugins(b);var c=createjs.Sound.activePlugin,d=c instanceof createjs.WebAudioPlugin,e=!d,f=e&&!createjs.Sound.BrowserDetect.isIOS&&!createjs.Sound.BrowserDetect.isAndroid;this.settings.setSoundFXSupported(d||f),resources.config.disableMusic?(r=s,a.settings.setMusicSupported(!1)):createjs.Sound.BrowserDetect.isIOS&&!resources.config.soundUnMuted?(r=t,a.settings.setMusicSupported(!0)):e&&!f?(r=t,a.settings.setMusicSupported(!0)):(r=u,a.settings.setMusicSupported(!0))}function n(){}function o(b,c,d){if("undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),a.settings.getSoundFXSupported()&&a.settings.getSoundFX()){var e=.7*d;createjs.Sound.play(b,createjs.Sound.INTERRUPT_ANY,c,0,0,e)}}function p(a){for(var b=[],c=0,d=a.length;d>c;++c){var e=a[c];b.push({id:e,src:"assets/sound/"+e+".ogg"+"|assets/sound/"+e+".m4a",type:createjs.LoadQueue.SOUND})}return b}a.soundManifest=p(["music","removefailed","levelcomplete","gameover","chainremoved","buttontap","grayremoved","bonusblobs","explode","powerupgranted"]);var q;a.playMusic=b,a.setMusicEnabled=c,a.playRemoveFailed=d,a.playLevelComplete=e,a.playGameOver=f,a.playChainRemoved=g,a.playButtonTap=h,a.playGrayRemoved=i,a.playBonusBlobs=j,a.playPowerupGranted=k,a.playExplode=l;var r,s=0,t=1,u=2;a.initialize=m;var v=function(a){function b(){a.apply(this,arguments),this.soundFX=!0,this.music=!0,this.musicSupported=!1,this.soundFXSupported=!1}return __extends(b,a),b.prototype.setSoundFX=function(a){this.soundFX=a,this.dispatchEvent("change")},b.prototype.getSoundFX=function(){return this.soundFX},b.prototype.setMusic=function(a){this.music=a,this.dispatchEvent("change"),c(a)},b.prototype.getMusic=function(){return this.music},b.prototype.setSoundFXSupported=function(a){this.soundFXSupported!=a&&(this.soundFXSupported=a,this.dispatchEvent("change"))},b.prototype.getSoundFXSupported=function(){return this.soundFXSupported},b.prototype.setMusicSupported=function(a){this.musicSupported!=a&&(this.musicSupported=a,this.dispatchEvent("change"))},b.prototype.getMusicSupported=function(){return this.musicSupported},b}(createjs.EventDispatcher);a.SoundSettings=v,a.settings=new v,a.mute=n}(sound||(sound={}));var resources;!function(a){function b(b,f){i=new createjs.LoadQueue,e(),sound.initialize(),i.installPlugin(createjs.Sound),i.addEventListener("complete",function(){f&&f.parentElement.removeChild(f),d(),b&&b()}),i.addEventListener("progress",c),a.config.portal&&(a.config.portal.logo&&h.push({id:"sponsor_logo",src:a.config.portal.logo}),a.config.portal.splash&&h.push({id:"splash",src:a.config.portal.splash.img})),i.loadManifest(h),i.loadManifest(sound.soundManifest)}function c(a){try{if(!updatePreloaderProgress)return;var b=a.loaded/a.total;b>0&&(b>1&&(b=1),updatePreloaderProgress(b))}catch(c){}}function d(){var b=f("spritesheet_json");b.images=[f("spritesheet")],a.spritesheet=new createjs.SpriteSheet(b);var c=f("badge_spritesheet_json");c.images=[f("badge_spritesheet")],a.badgeSpritesheet=new createjs.SpriteSheet(c),a.textMessages=f("textMessages")}function e(){var a="en";h.push({id:"textMessages",src:"assets/text/messages_"+a+".json"})}function f(a){return i.getResult(a)}function g(b){return a.textMessages[b]}var h=[{id:"mainmenu_bg",src:"assets/img/mainmenu_bg.jpg"},{id:"game_bg",src:"assets/img/game_bg.jpg"},{id:"game_grid_bg",src:"assets/img/game_grid_bg.png"},{id:"game_title",src:"assets/img/gametitle.png"},{id:"spritesheet",src:"assets/img/spritesheet-glueytower.png"},{id:"spritesheet_json",src:"assets/img/spritesheet-glueytower.json"},{id:"badge_spritesheet",src:"assets/img/badges-jellycollapse.png"},{id:"badge_spritesheet_json",src:"assets/img/badges-jellycollapse.json"}];a.spritesheet,a.badgeSpritesheet,a.textMessages,a.config;var i;a.preloadGameAssets=b,a.get=f,a.getMessage=g;var j=function(){function a(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d}return a.prototype.toLocalY=function(a){return a-this.y},a.prototype.toLocalX=function(a){return a-this.x},a}();a.GameplayRectangle=j,a.gameplayRectangle}(resources||(resources={}));var controls;!function(a){function b(b,c){a.screenWidth=b,a.screenHeight=c}function c(a,b,c){var d=new n(b,function(){sound.playButtonTap(),c()});return a.addChild(d),d}function d(a){c(a,"MoreGamesButton",function(){resources.config.portal&&window.open(resources.config.portal.moreGamesURL,"_blank")})}function e(a){var b=resources.get("sponsor_logo"),c=new createjs.Container,d=new createjs.Bitmap(b);return d.x=-b.width/2,d.y=-b.height/2,d.hitArea=new createjs.Shape((new createjs.Graphics).beginFill("#f00").drawRect(0,0,b.width,b.height)),d.cursor="pointer",c.addChild(d),c.name="SponsorLogo",c.addEventListener("click",function(){resources.config.portal&&window.open(resources.config.portal.logoURL,"_blank")}),a.addChild(c),c}function f(a,b){var c=new createjs.Sprite(resources.spritesheet);return c.gotoAndStop(b),c.name=b,a.addChild(c),c}function g(b){var c=new createjs.Container;return c.regX=c.x=a.screenWidth/2,c.regY=c.y=a.screenHeight/2,b.addChild(c),c}function h(a,b){for(var c=0,d=a.getNumChildren();d>c;++c){var e=a.getChildAt(c);if(e.name){var f=b[e.name];f&&(e.x=Math.floor(f.x),e.y=Math.floor(f.y))}}}function i(){var b=new createjs.Sprite(resources.spritesheet);return b.gotoAndStop("WhiteRect"),b.scaleX=a.screenWidth/4,b.scaleY=a.screenHeight/4,b.y=-resources.gameplayRectangle.y,b}function j(a){a.addEventListener("tick",function(){var b=createjs.Ticker.getTime(),c=Math.cos(b/1e3)+.5;0>c&&(c=0);var d=1+.02*(Math.sin(b/100)+1)*c;a.scaleX=a.scaleY=d})}function k(a,b,c,d,e){var f=a.getChildByName(b);f.alpha=0;var g=f.y;if(f.y=d,f.scaleY=.5,createjs.Tween.get(f).wait(c).to({alpha:1},300),createjs.Tween.get(f).wait(c).to({y:g},1500,createjs.Ease.elasticOut),createjs.Tween.get(f).wait(c).to({scaleY:1},1500,createjs.Ease.elasticOut),e){var h=a.getChildByName(e);h.alpha=0,createjs.Tween.get(h,{override:!0}).wait(c+500).to({alpha:1},500)}}function l(a){var b=resources.config.portal;if(b&&b.splash){var c=new createjs.Shape,d=c.graphics;d.beginFill("#230037"),d.drawRect(0,0,640,712),d.endFill(),a.addChild(c);var e=new createjs.Bitmap(resources.get("splash"));a.addChild(e),e.alpha=0,createjs.Tween.get(e).to({alpha:1},300).wait(b.splash.timeMillis).to({alpha:0},500).call(function(){return a.removeChild(e)}),createjs.Tween.get(e).wait(300).call(function(){return a.removeChild(c)})}}function m(a){var b=resources.get(a),c=new createjs.Bitmap(b),d=b.height,e=712;return c.y=(e-d)/2,c}a.screenWidth,a.screenHeight,a.initialize=b;var n=function(a){function b(b,c){var d=this;a.call(this),this.innerContent=new createjs.Sprite(resources.spritesheet),this.buttonHelperLink=new createjs.ButtonHelper(this.innerContent,b+"Up",b+"Up",b+"Down"),this.name=b,this.cursor="pointer",this.addChild(this.innerContent),this.innerContent.addEventListener("mouseout",function(){return d.rollout()}),this.innerContent.addEventListener("mouseover",function(){return d.rollover()}),c&&(this.addEventListener("click",c),this.addEventListener("click",function(){return d.rollout()}))}return __extends(b,a),b.prototype.rollover=function(){createjs.Tween.removeTweens(this.innerContent),createjs.Tween.get(this.innerContent).to({scaleX:1.1,scaleY:1.1},200,createjs.Ease.quadOut)},b.prototype.rollout=function(){createjs.Tween.removeTweens(this.innerContent),createjs.Tween.get(this.innerContent).to({scaleX:1,scaleY:1},200)},b}(createjs.Container);a.IconButton=n;var o=function(a){function b(b,c,d){var e=this;a.call(this),this.onClick=d,this.innerContent=new createjs.Sprite(resources.spritesheet),this.addChild(this.innerContent),this.onButtonHelperLink=new createjs.ButtonHelper(this.innerContent,b+"Up",b+"Up",b+"Down"),this.offButtonHelperLink=new createjs.ButtonHelper(this.innerContent,c+"Up",c+"Up",c+"Down"),this.cursor="pointer",this.setChecked(!1),this.innerContent.addEventListener("mouseout",function(){return e.rollout()}),this.innerContent.addEventListener("mouseover",function(){return e.rollover()}),d&&this.addOnClickHandler()}return __extends(b,a),b.prototype.addOnClickHandler=function(){var a=this;this.addEventListener("click",function(){a.rollout(),a.onClick(),a.removeAllEventListeners("click"),setTimeout(function(){return a.addOnClickHandler()},100)})},b.prototype.setChecked=function(a){this.onButtonHelperLink.setEnabled(a),this.offButtonHelperLink.setEnabled(!a),a?this.innerContent.gotoAndStop(this.onButtonHelperLink.outLabel):this.innerContent.gotoAndStop(this.offButtonHelperLink.outLabel)},b.prototype.rollover=function(){createjs.Tween.removeTweens(this.innerContent),createjs.Tween.get(this.innerContent).to({scaleX:1.1,scaleY:1.1},200,createjs.Ease.quadOut)},b.prototype.rollout=function(){createjs.Tween.removeTweens(this.innerContent),createjs.Tween.get(this.innerContent).to({scaleX:1,scaleY:1},200)},b}(createjs.Container);a.CheckIconButton=o,a.createIconButton=c,a.createMoreGamesButton=d,a.createSponsorLogo=e,a.createStaticImage=f,a.createFullScreenContainer=g,a.readLayout=h,a.getFullScreenWipeImage=i,a.addDefaultButtonAnimation=j,a.bounceButton=k,a.showSplashScreen=l,a.createBackgroundBitmap=m}(controls||(controls={}));var soundControls;!function(a){function b(a,b){var c=new d;return c.name=b,a.addChild(c),c}function c(a,b){var c=new e;return c.name=b,a.addChild(c),c}a.soundFXOnButtonName="MuteButton",a.soundFXOffButtonName="MuteOffButton",a.musicOnButtonName="MusicButton",a.musicOffButtonName="MusicOffButton";var d=function(b){function c(){var c=this;b.call(this,a.soundFXOnButtonName,a.soundFXOffButtonName,function(){return c.toggleSound()}),sound.settings.addEventListener("change",function(){return c.refreshSoundSettings()}),this.refreshSoundSettings()}return __extends(c,b),c.prototype.toggleSound=function(){sound.settings.setSoundFX(!sound.settings.getSoundFX()),console.log("Toggle soundFX: "+sound.settings.getSoundFX())},c.prototype.refreshSoundSettings=function(){console.log("Refreshing sound settings: "+sound.settings.getSoundFX()),this.setChecked(sound.settings.getSoundFX()),this.visible=sound.settings.getSoundFXSupported()},c}(controls.CheckIconButton),e=function(b){function c(){var c=this;b.call(this,a.musicOnButtonName,a.musicOffButtonName,function(){return c.toggleSound()}),sound.settings.addEventListener("change",function(){return c.refreshSoundSettings()}),this.refreshSoundSettings()}return __extends(c,b),c.prototype.toggleSound=function(){sound.settings.setMusic(!sound.settings.getMusic()),console.log("Toggle music: "+sound.settings.getMusic())},c.prototype.refreshSoundSettings=function(){console.log("Refreshing music settings: "+sound.settings.getMusic()),this.setChecked(sound.settings.getMusic()),this.visible=sound.settings.getMusicSupported()},c}(controls.CheckIconButton);a.createSoundFXButton=b,a.createMusicButton=c}(soundControls||(soundControls={}));var game;!function(a){var b=function(a){function b(){a.call(this);var b=new createjs.Sprite(resources.spritesheet);b.gotoAndStop("GameOverMessage"),b.x=320,b.y=320,this.gameOverMessage=b;var c=new createjs.Sprite(resources.spritesheet);c.gotoAndStop("LevelCompleteMessage"),c.x=320,c.y=320,this.levelCompleteMessage=c;var d=new createjs.Sprite(resources.spritesheet);d.gotoAndStop("RefillMessage"),this.refillMessage=d}return __extends(b,a),b.prototype.showRefillMessage=function(a,b){280>a?a=280:a>360&&(a=360),150>b?b=150:b>550&&(b=550),this.refillMessage.x=a,this.refillMessage.y=b,this.refillMessage.scaleX=this.refillMessage.scaleY=0,this.refillMessage.alpha=1,this.addChild(this.refillMessage),createjs.Tween.removeTweens(this.refillMessage),createjs.Tween.get(this.refillMessage).to({scaleX:.9,scaleY:.9},2500,createjs.Ease.getElasticOut(1,.3))},b.prototype.hideRefillMessage=function(){var a=this;this.refillMessage.parent&&createjs.Tween.get(this.refillMessage).wait(500).to({alpha:0},300).call(function(){return a.removeChild(a.refillMessage)})},b.prototype.showLevelCompleteMessage=function(){var a=this;this.refillMessage.parent&&(createjs.Tween.removeTweens(this.refillMessage),this.removeChild(this.refillMessage)),this.addChild(this.levelCompleteMessage),this.levelCompleteMessage.scaleX=0,this.levelCompleteMessage.scaleY=0,this.levelCompleteMessage.alpha=1,createjs.Tween.get(this.levelCompleteMessage).to({scaleX:1,scaleY:1},1500,createjs.Ease.elasticOut).wait(1700).to({alpha:0,scaleX:2,scaleY:2},300,createjs.Ease.quadOut).call(function(){return a.removeChild(a.levelCompleteMessage)})},b.prototype.floatScore=function(a,b,c,d){"undefined"==typeof d&&(d=0);var e=this,f=new createjs.BitmapText("+"+a,resources.spritesheet);f.letterSpacing=-7,f.x=b-f.measureTextWidth()/2,f.y=c-50,this.addChild(f),f.alpha=0,createjs.Tween.get(f).wait(d).to({y:c-120},1200,createjs.Ease.circOut),createjs.Tween.get(f).wait(d).to({alpha:1},30).wait(1100).to({alpha:0},100).call(function(){return e.removeChild(f)})},b.prototype.showGameOverMessage=function(){this.addChild(this.gameOverMessage),this.gameOverMessage.scaleX=0,this.gameOverMessage.scaleY=0,createjs.Tween.get(this.gameOverMessage).to({scaleX:1,scaleY:1},1e3)},b.prototype.clear=function(){this.removeAllChildren()},b}(createjs.Container);a.MessageCanvas=b}(game||(game={}));var tutorialZone;!function(a){var b=function(a){function b(b,c,d,e,f){a.call(this),this.zoneX=b,this.zoneY=c,this.zoneWidth=d,this.zoneHeight=e,this.fillColor=f}return __extends(b,a),b.prototype.createRectHole=function(a,b){"undefined"==typeof b&&(b=0),this.removeAllChildren();var d=new createjs.Shape,e=d.graphics;e.beginFill(this.fillColor),e.drawRoundRect(a.x-b,a.y-b,a.width+2*b,a.height+2*b,b),e.moveTo(this.zoneX,this.zoneY).lineTo(this.zoneX,this.zoneHeight).lineTo(this.zoneWidth,this.zoneHeight).lineTo(this.zoneWidth,this.zoneY).lineTo(this.zoneX,this.zoneY).closePath(),this.addChild(d),this.cache(this.zoneX,this.zoneY,this.zoneWidth,this.zoneHeight),this.zone=new c(a)},b.prototype.checkPoint=function(a,b){return this.zone?this.zone.checkPoint(a,b):!0},b}(createjs.Container);a.TutorialZoneSprite=b;var c=function(){function a(a){this.rectangle=a}return a.prototype.checkPoint=function(a,b){var c=this.rectangle;return a>=c.x&&b>=c.y&&a<c.x+c.width&&b<c.y+c.height},a}()}(tutorialZone||(tutorialZone={}));var game;!function(a){!function(a){a.SIZE=2,a.BOX_2x1={probability:10,faceAnimationName:"2x1",animationName:"2x1",rotation:0,cells:[!0,!0,!1,!1],width:2,height:1,bottomEdge:[0,0],eyeCount:2},a.BOX_1x2={probability:10,faceAnimationName:"1x2",animationName:"2x1",rotation:90,cells:[!0,!1,!0,!1],width:1,height:2,bottomEdge:[1],eyeCount:1},a.BOX_1x1={probability:50,faceAnimationName:"1x1",animationName:"1x1",rotation:0,cells:[!0,!1,!1,!1],width:1,height:1,bottomEdge:[0],eyeCount:1},a.BOX_2x2={probability:5,faceAnimationName:"2x1",animationName:"2x2",rotation:0,cells:[!0,!0,!0,!0],width:2,height:2,bottomEdge:[1,1],eyeCount:2},a.LIST=[a.BOX_1x1,a.BOX_2x2]}(a.layouts||(a.layouts={})),a.layouts}(game||(game={}));var game;!function(a){a.BOMB_COLOR_INDEX=5,a.POWERUP_START_INDEX=5;var b=function(){function a(a,b,c,d){this.column=a,this.row=b,this.layout=c,this.colorIndex=d,this.chainId=0,this.gameShapeSprite=null}return a}();a.GameShape=b;var c=function(){function a(){this.gameShape=null}return a.prototype.isOccupied=function(){return null!=this.gameShape},a}();a.GridCell=c;var d=function(){function a(a,b,d){this.columnCount=a,this.rowCount=b,this.gridVisualRect=d;var e=d.width/this.columnCount,f=d.height/this.rowCount;this.cellWidth=e,this.cellHeight=f;var g=new Array(b);this.cells=g;for(var h=d.x,i=d.y,j=0;b>j;++j){var k=new Array(a);g[j]=k;for(var l=0;a>l;++l){var m=new c;m.column=l,m.row=j,m.left=h+e*l,m.right=h+e*(l+1),m.top=i+f*j,m.bottom=i+f*(j+1),m.xCenter=(m.left+m.right)/2,m.yCenter=(m.top+m.bottom)/2,k[l]=m}}}return a.prototype.getCell=function(a,b){var c=this.cells[b];return c?c[a]:void 0},a.prototype.getCellByPixels=function(a,b){var c=Math.floor((a-this.gridVisualRect.x)/this.cellWidth),d=Math.floor((b-this.gridVisualRect.y)/this.cellHeight),e=this.cells[d];return e?e[c]:void 0},a.prototype.getCellPixelRect=function(a,b,c,d){var e=this.getCell(a,b),f=this.getCell(a+c-1,b+d-1);return new createjs.Rectangle(e.left,e.top,f.right-e.left,f.bottom-e.top)},a.prototype.clear=function(){for(var a=this.rowCount,b=this.columnCount,c=0;a>c;++c)for(var d=this.cells[c],e=0;b>e;++e){var f=d[e];f.gameShape=null}},a}();a.Grid=d}(game||(game={}));var game;!function(a){function b(a,b){switch(a){case 1:return new d(b);case 2:return new e(b);case 3:return new f(b);case 4:return new g(b);default:return new h(b)}}var c=function(a){function b(b){a.call(this),this.grid=b,this.tutorialZone=new tutorialZone.TutorialZoneSprite(0,-124,640,960,"#200020"),this.tutorialZone.alpha=.7,this.addChild(this.tutorialZone);var c=new createjs.Text("","bold 32px arial, helvetica, sans-serif","#FFFFFF");c.shadow=new createjs.Shadow("#000000",2,2,1),c.x=320,c.lineWidth=500,c.textAlign="center",this.addChild(c),this.tutorialMessage=c,this.visible=!1}return __extends(b,a),b.prototype.disable=function(){this.visible=!1,this.tutorialImage&&(this.removeChild(this.tutorialImage),this.tutorialImage=null)},b.prototype.enable=function(a,b,c,d){this.disable(),this.visible=!0,this.alpha=0,createjs.Tween.get(this,{override:!0}).wait(d).to({alpha:1},400),this.tutorialMessage.y=b,this.tutorialMessage.text=resources.getMessage(a);var e=this.tutorialMessage.getMeasuredWidth()+5,f=this.tutorialMessage.getMeasuredHeight()+5;this.tutorialMessage.cache(-e/2,0,e,f),this.tutorialZone.createRectHole(c,25);var g=resources.layout[a];g&&(this.tutorialImage=uiComponents.createCompositeImage(resources.spritesheet,g),this.tutorialImage.x=320,this.tutorialImage.y=b,this.addChild(this.tutorialImage))},b.prototype.checkPoint=function(){return!0},b}(createjs.Container);a.TutorialCanvas=c,a.createTutorial=b;var d=function(){function a(a){this.tutorialCanvas=a,this.tutorialCanvas.enable("tutorialTapChains",200,this.tutorialCanvas.grid.getCellPixelRect(1,3,8,7),800)}return a.prototype.nextStep=function(){},a.prototype.gameComplete=function(){this.tutorialCanvas.disable()},a}();a.BasicTutorial=d;var e=function(){function a(a){this.tutorialCanvas=a,this.tutorialCanvas.enable("tutorialExtraShapes",300,this.tutorialCanvas.grid.getCellPixelRect(2,5,6,4),800),this.stepCount=0}return a.prototype.nextStep=function(){this.stepCount>=1&&this.tutorialCanvas.disable(),this.stepCount++},a.prototype.gameComplete=function(){},a}();a.ExtraShapesTutorial=e;var f=function(){function a(a){this.tutorialCanvas=a,this.tutorialCanvas.enable("tutorialCreateBomb",350,this.tutorialCanvas.grid.getCellPixelRect(1,6,8,3),800)}return a.prototype.nextStep=function(){this.tutorialCanvas.disable()},a.prototype.gameComplete=function(){},a}();a.BombTutorial=f;var g=function(){function a(a){this.tutorialCanvas=a,this.tutorialCanvas.enable("tutorialCookie",250,this.tutorialCanvas.grid.getCellPixelRect(1,5,8,5),800)}return a.prototype.nextStep=function(){this.tutorialCanvas.disable()},a.prototype.gameComplete=function(){},a}();a.CookieTutorial=g;var h=function(){function a(a){a.disable()}return a.prototype.nextStep=function(){},a.prototype.gameComplete=function(){},a}();a.NullTutorial=h}(game||(game={}));var pause;!function(a){function b(){return null!=g}function c(a,b){f=a,h=b}function d(){g||(g=new i,f.addChild(g),h.pauseGame())}function e(){g&&(f.removeChild(g),g=null,h.resumeGame())}var f,g,h;a.isPaused=b,a.initialize=c,a.pauseGame=d,a.continueGame=e;var i=function(a){function b(){a.call(this);var b=controls.createBackgroundBitmap("game_bg");this.addChild(b),b.alpha=0,createjs.Tween.get(b).to({alpha:.9},1e3,createjs.Ease.quartOut);var c=controls.createIconButton(this,"PlayButton",e);controls.addDefaultButtonAnimation(c),controls.createIconButton(this,"RestartButton",function(){e(),h.restartGame()}),controls.createIconButton(this,"QuitButton",function(){e(),h.quitGame()}),soundControls.createSoundFXButton(this,"SoundFXButton"),soundControls.createMusicButton(this,"MusicButton"),controls.createStaticImage(this,"QuitLabel"),controls.createStaticImage(this,"RestartLabel"),controls.createStaticImage(this,"ContinueLabel"),controls.readLayout(this,resources.layout.GamePauseScreen),resources.config.portal?(controls.createMoreGamesButton(this),controls.createSponsorLogo(this),controls.readLayout(this,resources.layout.SponsorGamePauseScreen)):controls.readLayout(this,resources.layout.GamePauseScreen),controls.bounceButton(this,"PlayButton",0,500,"ContinueLabel"),controls.bounceButton(this,"QuitButton",100,700,"QuitLabel"),controls.bounceButton(this,"RestartButton",200,700,"RestartLabel"),controls.bounceButton(this,"MoreGamesButton",300,600),controls.bounceButton(this,"SoundFXButton",300,0),controls.bounceButton(this,"MusicButton",350,0)}return __extends(b,a),b}(createjs.Container);a.PauseDialog=i}(pause||(pause={}));var strings;!function(a){function b(a){for(var b=a+"";b.length<6;)b="0"+b;var c=b.length;return b.substr(0,c-6)+" "+b.substr(c-6,3)+" "+b.substr(c-3,3)}a.padScore=b}(strings||(strings={}));var uiComponents;!function(a){function b(a,b){var c=new createjs.Container;for(var d in b){var e=b[d],f=d.split("$")[0],g=new createjs.Sprite(a);g.gotoAndStop(f),g.x=e.x,g.y=e.y,c.addChild(g)}return c}var c=function(a){function b(){a.call(this);var b=new createjs.Sprite(resources.spritesheet);b.gotoAndStop("TimeProgressBarBack"),this.addChild(b);var c=resources.spritesheet.getAnimation("TimeProgressBar"),d=resources.spritesheet.getFrame(c.frames[0]),e=new createjs.Bitmap(d.image);e.sourceRect=d.rect,this.addChild(e),this.timeProgress=e,this.originalWidth=d.rect.width}return __extends(b,a),b.prototype.setProgress=function(a){0>a&&(a=0),a>1&&(a=1);var b=Math.floor(this.originalWidth*a);b>0?(this.timeProgress.sourceRect.width=b,this.timeProgress.visible=!0):this.timeProgress.visible=!1},b}(createjs.Container);a.ProgressBarBitmap=c,a.createCompositeImage=b}(uiComponents||(uiComponents={}));var game;!function(a){var b=function(a){function b(){a.call(this),this.score=0,this.scoreText=new createjs.BitmapText("",resources.spritesheet),this.scoreText.name="ScoreText",this.scoreText.letterSpacing=-7,this.scoreText.spaceWidth=9,this.scoreText.scaleX=this.scoreText.scaleY=1,this.scoreText.mouseEnabled=!1,this.addChild(this.scoreText),this.levelText=new createjs.BitmapText("",resources.spritesheet),this.levelText.name="LevelText",this.levelText.letterSpacing=-7,this.levelText.spaceWidth=13,this.levelText.scaleX=this.scoreText.scaleY=1,this.levelText.mouseEnabled=!1,this.addChild(this.levelText),this.goalText=new createjs.BitmapText("",resources.spritesheet),this.goalText.name="GoalText",this.goalText.letterSpacing=-7,this.goalText.spaceWidth=13,this.goalText.scaleX=this.goalText.scaleY=.7,this.goalText.mouseEnabled=!1,this.addChild(this.goalText);var b=new createjs.Sprite(resources.badgeSpritesheet);b.name="BadgeText",this.addChild(b),this.badgeSprite=b,this.setBadge(1);var c=new uiComponents.ProgressBarBitmap;c.name="ProgressBar",this.addChild(c),this.progressBarBitmap=c,c.rotation=-90,controls.createIconButton(this,"GameMenuButton",function(){pause.pauseGame()}),controls.readLayout(this,resources.layout.GameScreen),this.initialLevelY=this.levelText.y,this.initialProgressBitmapY=this.progressBarBitmap.y}return __extends(b,a),b.prototype.startBounceInAnimation=function(){this.y=-250,createjs.Tween.get(this,{override:!0}).wait(1300).to({y:0},700,createjs.Ease.backOut)},b.prototype.setLevelProgress=function(a,b,c,d){this.setLevel(a),this.setGoal(this.score,b),this.setBadge(c),d&&createjs.Tween.get(this.levelText).to({y:this.initialLevelY-25},200,createjs.Ease.quadOut).to({y:this.initialLevelY},800,createjs.Ease.bounceOut)},b.prototype.setBadge=function(a){a>=b.RANK_ANIMATIONS.length&&(a=b.RANK_ANIMATIONS.length-1);var c=b.RANK_ANIMATIONS[a];this.badgeSprite.gotoAndStop(c)},b.prototype.setLevel=function(a){this.levelText.text="L "+a
},b.prototype.setScore=function(a){var b=this;this.score!=a&&(this.y=0,createjs.Tween.get(this,{override:!0}).to({score:a},800).addEventListener("change",function(){return b.updateScoreTextField()}),createjs.Tween.hasActiveTweens(this.progressBarBitmap)||(this.progressBarBitmap.y=this.initialProgressBitmapY,createjs.Tween.get(this.progressBarBitmap).to({y:this.progressBarBitmap.y-10},200,createjs.Ease.quadOut).to({y:this.progressBarBitmap.y},600,createjs.Ease.bounceOut)))},b.prototype.initializeScore=function(a){this.score=a,this.updateScoreTextField()},b.prototype.setGoal=function(a,b){this.goal!=b&&(this.score=a,this.startingScore=a,this.goal=b,this.updateProgress(),this.goalText.text="G"+strings.padScore(Math.floor(b)))},b.prototype.updateScoreTextField=function(){this.scoreText.text=strings.padScore(Math.floor(this.score)),this.updateProgress()},b.prototype.updateProgress=function(){var a=this.goal-this.startingScore;if(.1>a)return this.progressBarBitmap.setProgress(0),void 0;var b=this.score-this.startingScore;this.progressBarBitmap.setProgress(b/a)},b.RANK_ANIMATIONS=["BadgeBeginner","BadgeNovice","BadgeApprentice","BadgeAdept","BadgeExpert","BadgeMaster","BadgeGuru"],b}(createjs.Container);a.Hud=b}(game||(game={}));var game;!function(a){var b=function(a){function b(b){"undefined"==typeof b&&(b="LeftEye"),a.call(this,resources.spritesheet),this.animationName=b,this.gotoAndStop(b),this.alpha=0,createjs.Tween.get(this).to({alpha:1},200+400*Math.random())}return __extends(b,a),b.prototype.triggerAnimation=function(){Math.random()>.2||this.forceTriggerAnimation()},b.prototype.forceTriggerAnimation=function(){this.gotoAndPlay(this.animationName)},b}(createjs.Sprite);a.SingleEyeMarker=b;var c=function(a){function c(){a.call(this),this.leftEye=new b("LeftEye"),this.rightEye=new b("RightEye"),this.addChild(this.leftEye),this.addChild(this.rightEye),this.rightEye.x=30}return __extends(c,a),c.prototype.triggerAnimation=function(){Math.random()>.2||(this.leftEye.forceTriggerAnimation(),this.rightEye.forceTriggerAnimation())},c}(createjs.Container);a.TwoEyesMarker=c;var d=function(a){function b(b,c){var d=c.faceAnimationName;a.call(this,resources.spritesheet),this.scaleX=this.scaleY=.8,this.animationName="JellyFace"+b+"_"+d,this.gotoAndStop(this.animationName);var e=this.spriteSheet.getFrame(this.currentFrame).rect;this.regX=e.width/2-31*c.width+31,this.regY=e.height/2-31*c.height+27}return __extends(b,a),b.prototype.triggerAnimation=function(){!this.paused||Math.random()>.2||this.gotoAndPlay(this.animationName)},b}(createjs.Sprite);a.FaceMarker=d;var e=function(a){function b(){a.call(this,resources.spritesheet),this.gotoAndStop("ExtraShapesMarker"),this.alpha=0,this.scaleX=this.scaleY=0,createjs.Tween.get(this).to({scaleX:1,scaleY:1},1200,createjs.Ease.getElasticOut(1.5,.3)),createjs.Tween.get(this).to({alpha:.9},300)}return __extends(b,a),b.prototype.triggerAnimation=function(){createjs.Tween.hasActiveTweens(this)||(createjs.Tween.get(this).to({scaleX:1.2,scaleY:1.2},200,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},1e3,createjs.Ease.elasticOut),createjs.Tween.get(this).to({alpha:1},200,createjs.Ease.quadOut).to({alpha:.9},1e3,createjs.Ease.elasticOut))},b}(createjs.Sprite);a.ExtraShapePowerupMarker=e;var f=function(a){function b(){a.call(this,resources.spritesheet),this.gotoAndStop("BombMarker"),this.scaleX=this.scaleY=.7,this.alpha=0,createjs.Tween.get(this).to({scaleX:.7,scaleY:.7},1200,createjs.Ease.getElasticOut(1.5,.3)),createjs.Tween.get(this).to({alpha:.9},300)}return __extends(b,a),b.prototype.triggerAnimation=function(){createjs.Tween.hasActiveTweens(this)||(createjs.Tween.get(this).to({scaleX:1,scaleY:1},200,createjs.Ease.quadOut).to({scaleX:.7,scaleY:.7},1e3,createjs.Ease.elasticOut),createjs.Tween.get(this).to({alpha:1},200,createjs.Ease.quadOut).to({alpha:1},1e3,createjs.Ease.elasticOut))},b}(createjs.Sprite);a.BombPowerupMarker=f;var g=function(a){function b(b,c){a.call(this),this.visualLayout=b,this.colorIndex=c,this.shakeIntensity=0,this.shapeSprite=new createjs.Sprite(resources.spritesheet);var d=-1==c?"Disabled":""+c,e="GlueyBlock"+d+"_"+b.animationName;this.addChild(this.shapeSprite),this.shapeSprite.gotoAndStop(e),this.shapeSprite.rotation=b.rotation,this.height=61*b.height,this.width=61*b.width}return __extends(b,a),b.prototype.animateShake=function(){this.shapeSprite.x=2*Math.random()*this.shakeIntensity-1,this.shapeSprite.y=2*Math.random()*this.shakeIntensity-1},b.prototype.enableEyes=function(){this.replaceMarker(d)},b.prototype.replaceMarker=function(a){if(this.marker){if(this.marker instanceof a)return;this.removeMarker()}console.log("New marker created",a),this.marker=new a(this.colorIndex,this.visualLayout),this.addChild(this.marker)},b.prototype.removeMarker=function(){this.marker&&(this.removeChild(this.marker),this.marker=null)},b.prototype.checkMarkersEnabled=function(){return null!=this.marker},b.prototype.updateColor=function(a){var b=-1==a?"Disabled":""+a,c="GlueyBlock"+b+"_"+this.visualLayout.animationName;this.shapeSprite.gotoAndStop(c)},b.prototype.triggerAnimation=function(){this.marker&&this.marker.triggerAnimation()},b.prototype.jump=function(){createjs.Tween.hasActiveTweens(this)||createjs.Tween.hasActiveTweens(this.shapeSprite)||createjs.Tween.get(this.shapeSprite).to({y:-15},100,createjs.Ease.quadOut).to({y:0},500,createjs.Ease.bounceOut)},b.prototype.wave=function(){if(!createjs.Tween.hasActiveTweens(this.shapeSprite)){var a=this.parent;a.removeChild(this),a.addChild(this),createjs.Tween.get(this.shapeSprite).wait(150*Math.random()).to({y:-15},200,createjs.Ease.quadOut).to({y:0},1500,createjs.Ease.elasticOut)}},b}(createjs.Container);a.GameShapeSprite=g;var h=function(b){function c(c){b.call(this),this.grid=c,this.gameBackground=controls.createBackgroundBitmap("game_bg"),this.gameObjects=new createjs.Container,this.effects=new createjs.Container,this.messages=new a.MessageCanvas,this.hud=new a.Hud;var d=new createjs.Container;d.addChild(this.gameBackground);var e=new createjs.Shape;e.alpha=.3,e.graphics.beginFill("000000").drawRect(0,0,640,100),e.y=-124,d.addChild(e);var f=new createjs.Shape;f.alpha=.3,f.graphics.beginFill("000000").drawRect(0,0,640,120),f.y=716,d.addChild(f),d.cache(0,-124,640,960),this.addChild(d),this.addChild(this.gameObjects),this.tutorialCanvas=new a.TutorialCanvas(this.grid),this.addChild(this.tutorialCanvas),this.addChild(this.effects),this.addChild(this.messages),this.addChild(this.hud)}return __extends(c,b),c.prototype.createGameShapeSprite=function(a,b,c,d){var e=new g(c,d);return e.x=a,e.y=b,this.gameObjects.addChild(e),e},c.prototype.fadeBombIn=function(a){a.scaleX=4,a.scaleY=4,a.alpha=0,createjs.Tween.get(a).to({scaleX:1,scaleY:1},900,createjs.Ease.bounceOut),createjs.Tween.get(a).to({alpha:1},500)},c.prototype.animateWrongTap=function(a){a.shapeSprite.x=10,createjs.Tween.get(a.shapeSprite).to({x:0},800,createjs.Ease.elasticOut)},c.prototype.moveGameShapeSprite=function(a,b,c,d){var e=c-a.y,f=15*Math.sqrt(e),g=.8,h=(1-g)*a.height+31*g-31,i=a.width/2-31;a.x=b,createjs.Tween.get(a).wait(d).to({y:a.y-20},100,createjs.Ease.quadOut).to({y:c-h},f,createjs.Ease.quadIn).to({y:c+h},150,createjs.Ease.cubicOut).to({y:c},250,createjs.Ease.cubicOut);var j=a.colorIndex>=0;j&&createjs.Tween.get(a).wait(d).to({x:b+.2*i,scaleY:1.2,scaleX:.8},100+f,createjs.Ease.quadIn).to({x:b-.1*i,scaleY:.8,scaleX:1.1},150,createjs.Ease.cubicOut).to({x:b,scaleY:1,scaleX:1},250,createjs.Ease.cubicOut)},c.prototype.collectGameShapeSprite=function(a,b){var c=this;this.gameObjects.removeChild(a),this.gameObjects.addChild(a);var d=50*Math.random()+350;b+=75*Math.random(),createjs.Tween.get(a).wait(b).to({y:50,scaleX:.4,scaleY:.4},d,createjs.Ease.quadOut).call(function(){return c.gameObjects.removeChild(a)}),createjs.Tween.get(a).wait(b).to({x:380,alpha:0},d)},c.prototype.killGameShapeSprite=function(a,b,c){var d=this,e=Math.random()*b+1.1;this.gameObjects.removeChild(a),this.gameObjects.addChild(a),createjs.Tween.get(a).wait(c+100*Math.random()).to({scaleX:e,scaleY:e,alpha:0},200).call(function(){return d.gameObjects.removeChild(a)})},c.prototype.killUnremovableGameShapeSprite=function(a){var b=this,c=3+1.5*Math.random(),d=600;this.gameObjects.removeChild(a),this.gameObjects.addChild(a),120+100*Math.random(),a.shakeIntensity=0,createjs.Tween.get(a).to({shakeIntensity:5},d).addEventListener("change",function(){return a.animateShake()}),createjs.Tween.get(a).wait(d).to({scaleX:c,scaleY:c,alpha:0},300,createjs.Ease.cubicIn).call(function(){return b.gameObjects.removeChild(a)})},c.prototype.explode=function(a,b){var c=this,d=new createjs.Sprite(resources.spritesheet);d.x=a,d.y=b,d.scaleX=2.5,d.scaleY=2.5,d.gotoAndPlay("Boom"),d.addEventListener("animationend",function(){d.stop(),c.effects.removeChild(d)}),this.effects.addChild(d)},c.prototype.clear=function(){this.gameObjects.removeAllChildren(),this.messages.clear()},c.prototype.fadeInGrid=function(){},c.prototype.fadeOutGrid=function(){},c.prototype.gameOver=function(){this.messages.showGameOverMessage()},c}(createjs.Container);a.Canvas=h}(game||(game={}));var game;!function(a){function b(b,d){if(c(b,1e5,d),0==a.candidateCount)return null;var e=Math.floor(a.candidateCount*Math.random());return c(b,e,d)}function c(b,c,e){a.candidateCount=0;for(var f=b.columnCount,g=0;f>g;++g){var h=0,i=b.getCell(g,h),j=d(b,i,e);if(j){if(a.candidateCount>=c)return i;a.candidateCount++}}return null}function d(b,c,d){if(c.column+d.width>b.columnCount)return!1;for(var e=c.column,f=c.row,g=d.cells,h=a.layouts.SIZE,i=d.width,j=d.height,k=0;j>k;++k)for(var l=0;i>l;++l){var m=k*h+l,n=g[m];if(n){var o=b.getCell(e+l,f+k);if(o.gameShape)return!1}}return!0}function e(a){return a&&0!=a.length?a[Math.floor(a.length*Math.random())]:null}function f(a){if(!a||0==a.length)return null;for(var b=a.length,c=0,d=0;b>d;++d)c+=a[d].probability;var e=Math.random(),f=0;for(d=0;b>d;++d){var g=a[d];if(f+=g.probability,f/c>e)return g}return a[a.length-1]}function g(a,b){if(!a||0==a.length)return null;for(var c=a.length,d=0,e=0;c>e;++e)d+=b[e];var f=Math.random(),g=0;for(e=0;c>e;++e){var h=a[e];if(g+=b[e],g/d>f)return h}return a[a.length-1]}a.pickRandomDropCell=b,a.candidateCount,a.pickDropCellByColumn=c,a.pickRandomObject=e,a.pickRandomObjectWithProbability=f,a.pickRandomObjectWithProbabilityArray=g}(game||(game={}));var game;!function(a){function b(a,b){var d=c(b),e=50;return Math.round((a+d)/e)*e}function c(a){if(1==a)return 200;var b=e.LEVEL_CONFIGS.length,c=Math.floor((a-1)/b),d=Math.floor((a-1)%b);return 4e3+4e3*c+400*d}function d(a){if(4>a)return 0;if(10>a)return 1;if(16>a)return 2;var b=a-16;return Math.floor(b/15)+3}a.getLevelScoreTarget=b,a.getLevelRandIndex=d,a.predefinedLevelLayout={1:"                               0     00  01  2211  01001100  22 00 22  1122   2  111    2  22110011 ",2:"                                                  22  1 1 0010 2222 1101 1 11 0020221 2 220101220110",3:"                                                               1 1 1   11111111   2121212   3003300 ",4:"                                                      0        22 11      *0*     22221122 2222233001"};var e=function(){function b(){this.movesTillNextUnremovableBox=0,this.unremovableBoxesEnabled=!1,this.currentUnremovableIntervalIndex=0}return b.prototype.setLevel=function(a){this.level=a;var c=b.LEVEL_CONFIGS.length;if(this.stageIndex=Math.floor((this.level-1)/c),this.levelConfigIndex=Math.floor((this.level-1)%c),console.log("levelConfigIndex",this.levelConfigIndex),this.stageIndex>0){console.log("Picking complex level: ",this.levelConfigIndex);var d=b.COMPLEX_LEVEL_CONFIG_OVERRIDES[this.levelConfigIndex];d?(console.log("Complex level exists"),this.currentLevelConfig=d):(console.log("Fall back to normal level"),this.currentLevelConfig=b.LEVEL_CONFIGS[this.levelConfigIndex])}else console.log("Picking simple level: ",this.levelConfigIndex),this.currentLevelConfig=b.LEVEL_CONFIGS[this.levelConfigIndex];console.log("Stage: ",this.stageIndex),console.log("levelConfigIndex: ",this.levelConfigIndex),this.currentLevelConfig.unremovableShapeIntervalList&&this.currentLevelConfig.unremovableShapeIntervalList.length>0?(this.currentUnremovableIntervalIndex=0,this.movesTillNextUnremovableBox=this.currentLevelConfig.unremovableShapeIntervalList[0],this.unremovableBoxesEnabled=!0):this.unremovableBoxesEnabled=!1},b.prototype.pick=function(){if(this.unremovableBoxesEnabled){if(this.movesTillNextUnremovableBox<=0)return this.nextColorIndex=-1,this.nextLayout=a.pickRandomObject(this.currentLevelConfig.unremovableShapes),this.currentUnremovableIntervalIndex<this.currentLevelConfig.unremovableShapeIntervalList.length-1&&this.currentUnremovableIntervalIndex++,this.movesTillNextUnremovableBox=this.currentLevelConfig.unremovableShapeIntervalList[this.currentUnremovableIntervalIndex],void 0;this.movesTillNextUnremovableBox--}this.nextColorIndex=a.pickRandomObject(this.currentLevelConfig.colors),this.nextLayout=a.pickRandomObjectWithProbabilityArray(this.currentLevelConfig.shapes,this.currentLevelConfig.probabilities)},b.COMPLEX_LEVEL_CONFIG_OVERRIDES=[{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1],probabilities:[50,10],colors:[0,1,2,3]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,10,10],colors:[1,2,3,4]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2],probabilities:[50,20],colors:[1,2,3,4],unremovableShapeIntervalList:[205,105,45,35],unremovableShapes:[a.layouts.BOX_1x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,5,1],colors:[1,2,3,4],unremovableShapeIntervalList:[105,75,45,35],unremovableShapes:[a.layouts.BOX_1x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,5,1],colors:[1,2,3,4],unremovableShapeIntervalList:[105,75,45,35],unremovableShapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1]}],b.LEVEL_CONFIGS=[{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1],probabilities:[50,4],colors:[0,1,2]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1],probabilities:[50,4],colors:[0,1,2]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,10,5],colors:[0,1,2,3]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2],probabilities:[50,20],colors:[1,2,3,4],unremovableShapeIntervalList:[25,100,75,75,45,45],unremovableShapes:[a.layouts.BOX_1x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,5,1],colors:[1,2,3,4],unremovableShapeIntervalList:[45,105,105,75,45,25],unremovableShapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1,a.layouts.BOX_1x2],probabilities:[100,1,10],colors:[0,1,2,3,4]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1,a.layouts.BOX_1x2],probabilities:[80,1,3],colors:[0,1,2,3,4],unremovableShapeIntervalList:[105,75,45,45,45,35,25],unremovableShapes:[a.layouts.BOX_1x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2],probabilities:[50,5],colors:[0,1,2,3,4],unremovableShapeIntervalList:[45,205,105,75,45,45,45,35,25],unremovableShapes:[a.layouts.BOX_2x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2],probabilities:[50,5],colors:[0,1,2,3,4],unremovableShapeIntervalList:[45,105,105,75,75,45,35],unremovableShapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x1,a.layouts.BOX_1x2],probabilities:[50,1,5],colors:[0,1,2,3,4],unremovableShapeIntervalList:[45,205,105,105,75,75,45],unremovableShapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x2],probabilities:[100,2],colors:[0,1,2,3,4]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_1x2,a.layouts.BOX_2x1],probabilities:[50,5,1],colors:[1,2,3,4],unremovableShapeIntervalList:[45,105,75,75,45],unremovableShapes:[a.layouts.BOX_2x2]},{shapes:[a.layouts.BOX_1x1],probabilities:[50],colors:[0,1,2,3,4],unremovableShapeIntervalList:[55,105,105,75,45,35],unremovableShapes:[a.layouts.BOX_1x2]},{shapes:[a.layouts.BOX_1x1],probabilities:[50],colors:[0,1,2,3,4],unremovableShapeIntervalList:[55,205,105,105,75],unremovableShapes:[a.layouts.BOX_2x2]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x2],probabilities:[50,2],colors:[0,1,2,3,4]},{shapes:[a.layouts.BOX_1x1,a.layouts.BOX_2x2],probabilities:[50,2],colors:[0,1,2,3,4],unremovableShapeIntervalList:[75,120,120,100],unremovableShapes:[a.layouts.BOX_1x1]}],b}();a.LevelShapeDropStrategy=e}(game||(game={}));var game;!function(a){var b=function(){function b(a,b,c){this.gameCanvas=a,this.grid=b,this.dropStrategy=c,this.bombBonusEnabled=!1,this.refillBonusEnabled=!1,this.gameShapeList=[],this.atLeastOneChainExists=!1,this.atLeastOnePowerupExists=!1,this.currentCollapseRow=0,this.currentCollapseColumn=0,this.dropDelayTimeout=0,this.dropRequested=!1,this.victoryAnimationRequested=!1,this.hintTimeout=0,this.moveStarted=!1,this.collapseDelay=0,this.rowCollapsed=!1,this.dropPicked=!1,this.chainSizes=[],this.groupIdToBestEye=[],this.groupIdToBestEyeWeight=[],this.clearField()}return b.prototype.startGame=function(a,b){"undefined"==typeof b&&(b=null),console.log("World: game start"),this.clearField(),this.gameCanvas.fadeInGrid(),this.moveStarted=!1,this.victoryAnimationRequested=!1,a&&this.requestDrop(),b&&this.readFromLayout(b),this.beginStateCollapsing(),this.userInputStartTime=createjs.Ticker.getTime()+750},b.prototype.winGame=function(){this.victoryAnimationRequested=!0},b.prototype.onGameStarted=function(){},b.prototype.setScore=function(a){this.score=a,this.gameCanvas.hud.initializeScore(this.score)},b.prototype.requestTap=function(a){return this.userInputStartTime>createjs.Ticker.getTime()?(this.tappedCell=null,void 0):(this.tappedCell=a,void 0)},b.prototype.onMoveStarted=function(){},b.prototype.onMoveComplete=function(){},b.prototype.requestDrop=function(){this.dropRequested=!0},b.prototype.onAllGroupsKilled=function(){},b.prototype.delayGame=function(a){this.dropDelayTimeout+=a},b.prototype.clearField=function(){this.gameCanvas&&this.gameCanvas.clear(),this.state=b.STATE_OFF,this.grid.clear(),this.gameShapeList.length=0,this.tappedCell=null,this.atLeastOneChainExists=!1,this.dropRequested=!1,this.dropPicked=!1,this.hintTimeout=5e3},b.prototype.setGameShapeCurrentPositionToGrid=function(b){for(var c=b.column,d=b.row,e=b.layout.cells,f=0,g=a.layouts.SIZE,h=0;g>h;++h)for(var i=0;g>i;++i){var j=e[f];if(j){var k=this.grid.getCell(c+i,d+h);k.gameShape=b}f++}},b.prototype.clearGameShapeCurrentPositionOnGrid=function(b){for(var c=b.column,d=b.row,e=b.layout.cells,f=0,g=a.layouts.SIZE,h=0;g>h;++h)for(var i=0;i<a.layouts.SIZE;++i){var j=e[f];if(j){var k=this.grid.getCell(c+i,d+h);k.gameShape=null}f++}},b.prototype.animate=function(b){this.hintTimeout-=b,this.dropDelayTimeout>0&&(this.dropDelayTimeout-=b),this.dropDelayTimeout<=0&&(this.dropDelayTimeout=0,this.animateGrid(b));var c=this.getRandomCell(),d=c.gameShape;if(d&&d.gameShapeSprite&&d.gameShapeSprite.triggerAnimation(),Math.random()<.5){var e=this.getRandomCell(),f=e.gameShape;f&&f.colorIndex>=a.POWERUP_START_INDEX&&f.gameShapeSprite&&f.gameShapeSprite.jump()}this.hintTimeout<=0&&this.waveChain()},b.prototype.animateGrid=function(){switch(this.state){case b.STATE_WAITING_FOR_PLAYER:this.tappedCell&&(this.nextMove(this.tappedCell)&&(this.moveStarted=!0,this.atLeastOneChainExists=!1,this.atLeastOnePowerupExists=!1,this.victoryAnimationRequested?this.beginStateDetectingChains():this.beginStateCollapsing()),this.tappedCell=null);break;case b.STATE_COLLAPSING:for(var a=10,c=!0;this.stepCollapse();)if(--a<=0){c=!1;break}if(c){this.requestTap(null),this.delayGame(this.collapseDelay);var d=this.killBottomUnremovableChains();d?(this.delayGame(600),this.startCollapse()):this.dropRequested?this.beginStateRefilling():this.beginStateDetectingChains()}break;case b.STATE_REFILLING:for(var e=3,f=!0;this.dropRandom();)if(--e<=0){f=!1;break}if(f){this.dropRequested=!1,this.gameCanvas.messages.hideRefillMessage();var d=this.killBottomUnremovableChains();d?(this.delayGame(600),this.beginStateCollapsing()):this.beginStateDetectingChains()}break;case b.STATE_DETECTING_CHAINS:var g=this.detectChains();g&&(this.atLeastOneChainExists=!0),g||(this.computeGroupSizes(),this.findAllEyes(),this.moveStarted?this.onMoveComplete():this.onGameStarted(),this.state=b.STATE_WAITING_FOR_PLAYER,this.victoryAnimationRequested&&(this.killAllGroups(),this.state=b.STATE_OFF))}},b.prototype.beginStateCollapsing=function(){this.state=b.STATE_COLLAPSING,this.startCollapse()},b.prototype.beginStateRefilling=function(){this.state=b.STATE_REFILLING},b.prototype.beginStateDetectingChains=function(){this.state=b.STATE_DETECTING_CHAINS,this.resetChains()},b.prototype.waveChain=function(){var a=this.getRandomCell();if(this.gameCanvas.tutorialCanvas.checkPoint(a.xCenter,a.yCenter)){var b=a.gameShape,c=0;if(b&&this.chainSizes[b.chainId]>=2){for(var d=this.grid,e=d.columnCount,f=d.rowCount,g=b.chainId,h=0;f>h;++h)for(var i=0;e>i;++i){var j=d.getCell(i,h),k=j.gameShape;k&&k.chainId==g&&(k.gameShapeSprite.wave(c),c+=150)}this.hintTimeout=4e3}}},b.prototype.getRandomCell=function(){var a=this.grid,b=Math.floor(Math.random()*a.columnCount),c=Math.floor(Math.random()*a.rowCount);return a.getCell(b,c)},b.prototype.createGameShape=function(b,c,d,e){var f=new a.GameShape(b,c,d,e);this.setGameShapeCurrentPositionToGrid(f),this.gameShapeList.push(f);var g=this.gameCanvas;if(g){var h=this.grid.getCell(b,c);f.gameShapeSprite=g.createGameShapeSprite(h.xCenter,h.yCenter,d,e)}return f},b.prototype.readFromLayout=function(b,c){"undefined"==typeof c&&(c=0),this.clearField();for(var d=this.grid,e=d.columnCount,f=d.rowCount,g=0,h=f-1;h>=0;--h){for(var i=0;e>i;++i){var j=d.getCell(i,h);if(!j.gameShape){var k=i+h*e,l=b.charAt(k);if(" "!=l){var m;if(m=c>0?Math.floor(Math.random()*c):"*"!=l?+l:-1,e-1>i){var n=k+1,o=b.charAt(n);if(console.log(l,o),l==o&&null==d.getCell(i+1,h).gameShape){this.dropShapeToLayoutPosition(this.createGameShape(i,h,a.layouts.BOX_2x1,m),g);continue}}if(f-1>h){var p=i+(h+1)*e,q=b.charAt(p);if(l==q&&null==d.getCell(i,h+1).gameShape){this.dropShapeToLayoutPosition(this.createGameShape(i,h,a.layouts.BOX_1x2,m),g);continue}}this.dropShapeToLayoutPosition(this.createGameShape(i,h,a.layouts.BOX_1x1,m),g)}}}g+=65+50*Math.random()}this.resetChains()},b.prototype.dropShapeToLayoutPosition=function(a,b){if(this.gameCanvas&&a){var c=a.gameShapeSprite,d=c.y;c.y=-124-64*a.layout.height,this.gameCanvas.moveGameShapeSprite(c,c.x,d,b+50*Math.random())}},b.prototype.killBottomUnremovableChains=function(){for(var a=this.grid,b=a.columnCount,c=a.rowCount-1,d=!1,e=0;b>e;++e){var f=a.getCell(e,c),g=f.gameShape;if(g&&-1==g.colorIndex){this.killUnremovableShape(g,0);var h=250*g.layout.width*g.layout.height;this.increaseScore(h,f,700),d=!0}}return d&&sound.playGrayRemoved(),d},b.prototype.detectChains=function(){for(var b=!1,c=this.grid,d=c.columnCount,e=c.rowCount,f=0;e>f;++f)for(var g=0;d>g;++g){var h=c.getCell(g,f),i=h.gameShape;if(i&&-1!=i.colorIndex)if(i.colorIndex>=a.POWERUP_START_INDEX)this.atLeastOnePowerupExists=!0;else{var j=c.getCell(g+1,f);if(j){var k=j.gameShape;k&&k!=i&&k.colorIndex==i.colorIndex&&(i.chainId<k.chainId?(k.chainId=i.chainId,b=!0):i.chainId>k.chainId&&(i.chainId=k.chainId,b=!0))}var l=c.getCell(g,f+1);if(l){var m=l.gameShape;m&&m!=i&&m.colorIndex==i.colorIndex&&(i.chainId<m.chainId?(m.chainId=i.chainId,b=!0):i.chainId>m.chainId&&(i.chainId=m.chainId,b=!0))}}}return b},b.prototype.getChainShapes=function(a){var b=a.gameShape;if(!b)return[];for(var c=b.chainId,d=[],e=this.gameShapeList,f=0,g=e.length;g>f;++f){var h=e[f];h.chainId==c&&d.push(h)}return d},b.prototype.resetChains=function(){for(var a=this.gameShapeList,b=0,c=a.length;c>b;++b){var d=a[b];d.chainId=b}},b.prototype.nextMove=function(b){var c=this.getChainShapes(b),d=c.length;if(0==d)return!1;this.hintTimeout=4500;var e=c[0],f=e.colorIndex;return this.bombBonusEnabled&&f==a.BOMB_COLOR_INDEX?(this.explode(b),this.requestBonusDrop(b),this.onMoveStarted(b,c),!0):2>d?(this.gameCanvas.animateWrongTap(e.gameShapeSprite),sound.playRemoveFailed(),!1):(this.killShapes(c,b),this.grantBonuses(b,d),this.onMoveStarted(b,c),sound.playChainRemoved(),!0)},b.prototype.grantBonuses=function(b,c){var d=this.getBonusType(c);d==a.ExtraShapePowerupMarker&&(sound.playBonusBlobs(),this.requestBonusDrop(b)),d==a.BombPowerupMarker&&(sound.playPowerupGranted(),this.requestBonusDrop(b),this.grantPowerup(b,5))},b.prototype.requestBonusDrop=function(a){this.requestDrop(),this.gameCanvas.messages.showRefillMessage(a.xCenter,a.yCenter)},b.prototype.grantPowerup=function(b){var c=this.createGameShape(b.column,b.row,a.layouts.BOX_1x1,a.BOMB_COLOR_INDEX);this.gameCanvas.fadeBombIn(c.gameShapeSprite),this.delayGame(700)},b.prototype.explode=function(b){this.gameCanvas.explode(b.xCenter,b.yCenter),sound.playExplode();var c=3,d=c*c,e=b.column-c;0>e&&(e=0);var f=b.column+c;f>=this.grid.columnCount&&(f=this.grid.columnCount-1);var g=b.row-c;0>g&&(g=0);var h=b.row+c;h>=this.grid.rowCount&&(h=this.grid.rowCount-1);for(var i=g;h>=i;++i)for(var j=e;f>=j;++j){var k=i-b.row,l=j-b.column;if(!(k*k+l*l>d)){var m=this.grid.getCell(j,i);if(m&&m.gameShape&&m.gameShape.colorIndex>=0){var n=this.getChainShapes(m);(m==b||n[0].colorIndex<a.BOMB_COLOR_INDEX)&&this.killShapes(n,null)}}}this.delayGame(700)},b.prototype.increaseScore=function(a,b,c){"undefined"==typeof c&&(c=1),this.score+=a,this.gameCanvas.hud.setScore(this.score),this.gameCanvas.messages.floatScore(a,b.xCenter,b.yCenter,c)},b.prototype.startCollapse=function(){this.currentCollapseColumn=0,this.currentCollapseRow=this.grid.rowCount-1,this.collapseDelay=0,this.rowCollapsed=!1,this.delayGame(100)},b.prototype.stepCollapse=function(){for(var a=this.grid,b=a.columnCount;this.currentCollapseRow>=0;){for(;this.currentCollapseColumn<b;){var c=a.getCell(this.currentCollapseColumn,this.currentCollapseRow).gameShape;if(c&&c.column==this.currentCollapseColumn&&c.row==this.currentCollapseRow&&this.tryMoveDown(c,this.collapseDelay+50*Math.random()))return this.rowCollapsed=!0,!0;this.currentCollapseColumn++}this.currentCollapseColumn=0,this.currentCollapseRow--,this.rowCollapsed&&(this.collapseDelay+=50+25*Math.random()),this.rowCollapsed=!1}return!1},b.prototype.dropRandom=function(){this.dropPicked||(this.dropStrategy.pick(),this.dropPicked=!0);var b=a.pickRandomDropCell(this.grid,this.dropStrategy.nextLayout);if(b){var c=this.dropStrategy.nextColorIndex,d=this.createGameShape(b.column,b.row,this.dropStrategy.nextLayout,c);return d.gameShapeSprite.y=-124-64*d.layout.height,this.tryMoveDown(d,0)||this.gameCanvas&&this.gameCanvas.moveGameShapeSprite(d.gameShapeSprite,b.xCenter,b.yCenter,0),this.dropPicked=!1,!0}return!1},b.prototype.checkDropZone=function(){for(var a=this.grid,b=a.columnCount,c=0,d=0;2>d;++d)for(var e=0;b>e;++e){var f=a.getCell(e,d),g=f.gameShape;if(g&&g.column==e&&g.row==d&&(c++,c>=3))return!1}return!0},b.prototype.tryMoveDown=function(a,b){var c=this.getFallDepth(a);if(c>0){this.clearGameShapeCurrentPositionOnGrid(a),a.row+=c,this.setGameShapeCurrentPositionToGrid(a);var d=this.grid.getCell(a.column,a.row),e=this.gameCanvas;return e&&e.moveGameShapeSprite(a.gameShapeSprite,d.xCenter,d.yCenter,b),!0}return!1},b.prototype.getFallDepth=function(a){for(var b=a.column,c=a.row,d=a.layout.bottomEdge,e=this.grid,f=e.rowCount,g=0,h=d.length;h>g;++g){for(var i,j=b+g,k=c+d[g]+1,l=0;(i=e.getCell(j,k))&&!i.gameShape;)l++,k++;f>l&&(f=l)}return f},b.prototype.killShapes=function(b,c,d){if("undefined"==typeof d&&(d=0),0!=b.length){if(!c){var e=b[0];c=this.grid.getCell(e.column,e.row)}var f=b.length,g=f*(f-1),g=15*(f-1)*f/2,h=b[0];h.colorIndex==a.BOMB_COLOR_INDEX?g=200:h.colorIndex<0&&(g=250*h.layout.width*h.layout.height),g>0&&this.increaseScore(g,c,d);var i=this.gameShapeList,j=this.gameCanvas,f=b.length,k=f/10;.3>k&&(k=.3),k>2&&(k=2);for(var l=0,m=b.length;m>l;++l){var h=b[l];this.victoryAnimationRequested?j&&j.collectGameShapeSprite(h.gameShapeSprite,d):j&&j.killGameShapeSprite(h.gameShapeSprite,k,d),this.clearGameShapeCurrentPositionOnGrid(h);var n=i.indexOf(h);n>-1&&i.splice(n,1)}}},b.prototype.killUnremovableShape=function(a,b){var c=this.gameCanvas;this.clearGameShapeCurrentPositionOnGrid(a),c&&c.killUnremovableGameShapeSprite(a.gameShapeSprite,b);var d=this.gameShapeList.indexOf(a);d>-1&&this.gameShapeList.splice(d,1)},b.prototype.checkNoMovesLeft=function(){return!this.atLeastOneChainExists&&!this.atLeastOnePowerupExists},b.prototype.computeGroupSizes=function(){var a=this.grid,b=a.columnCount,c=a.rowCount,d=this.chainSizes;d.length=0;for(var e=0;c>e;++e)for(var f=0;b>f;++f){var g=a.getCell(f,e),h=g.gameShape;if(h&&h.column==f&&h.row==e){var i=h.chainId;d[i]?d[i]++:d[i]=1}}},b.prototype.findAllEyes=function(){var a=this.grid,b=a.columnCount,c=a.rowCount;this.clearBestEyeSet();for(var d=0;c>d;++d)for(var e=0;b>e;++e){var f=a.getCell(e,d),g=f.gameShape;if(g&&g.column==e&&g.row==d){var h=g.chainId,i=this.chainSizes[h];1>=i?g.gameShapeSprite.removeMarker():this.recordEyeCandidate(g)}}this.enableWinningEyeCandidates()},b.prototype.clearBestEyeSet=function(){this.groupIdToBestEye.length=0,this.groupIdToBestEyeWeight.length=0},b.prototype.recordEyeCandidate=function(a){var b=0;a.gameShapeSprite.checkMarkersEnabled()&&(b+=2),b+=10*a.layout.width,b+=10*a.layout.height,b+=Math.random();var c=a.chainId,d=this.groupIdToBestEye[c];if(d){var e=this.groupIdToBestEyeWeight[c];b>e?(d.gameShapeSprite.removeMarker(),this.groupIdToBestEye[c]=a,this.groupIdToBestEyeWeight[c]=b):a.gameShapeSprite.removeMarker()}else this.groupIdToBestEye[c]=a,this.groupIdToBestEyeWeight[c]=b},b.prototype.enableWinningEyeCandidates=function(){for(var a=this.groupIdToBestEye,b=0,c=a.length;c>b;++b){var d=a[b];if(d){var e=this.chainSizes[b],f=this.getBonusType(e);f?d.gameShapeSprite.replaceMarker(f):d.gameShapeSprite.enableEyes()}}},b.prototype.killAllGroups=function(){this.gameCanvas.fadeOutGrid();for(var a=this.grid,b=a.columnCount,c=a.rowCount,d=0;c>d;++d)for(var e=0;b>e;++e){var f=this.grid.getCell(e,d);if(f.gameShape){var g=this.getChainShapes(f);this.killShapes(g,f,300*Math.random()+100*d+700)}}},b.prototype.getBonusType=function(b){return b>=10&&this.bombBonusEnabled?a.BombPowerupMarker:b>=5&&this.refillBonusEnabled?a.ExtraShapePowerupMarker:null},b.STATE_OFF=0,b.STATE_WAITING_FOR_PLAYER=1,b.STATE_COLLAPSING=2,b.STATE_REFILLING=3,b.STATE_DETECTING_CHAINS=4,b}();a.World=b}(game||(game={}));var game;!function(a){var b=function(){function b(){var b=this;this.gameLost=!1,this.dropStrategy=new a.LevelShapeDropStrategy;var d=6;this.grid=new a.Grid(10,10,{x:d,y:98,width:640-2*d,height:608}),this.canvas=new a.Canvas(this.grid),this.world=new a.World(this.canvas,this.grid,this.dropStrategy),this.gameControls=new c(this),this.canvas.addEventListener("tick",function(a){return b.handleTick(a)}),this.world.onMoveStarted=function(a,c){return b.onMoveStarted(a,c)},this.world.onGameStarted=function(){return b.onGameStarted()},this.world.onMoveComplete=function(){return b.onMoveComplete()}}return b.prototype.startGame=function(){pause.continueGame(),this.gameControls.enable(),this.gameLost=!1,this.world.setScore(storage.completedLevelScore),this.startLevel(storage.completedLevel+1),this.canvas.hud.setLevelProgress(this.level,this.nextLevelGoal,a.getLevelRandIndex(this.level),!1),this.canvas.hud.startBounceInAnimation()},b.prototype.stopGame=function(){this.gameControls.disable()},b.prototype.restartGame=function(){this.stopGame(),this.startGame()},b.prototype.pauseGame=function(){this.gameControls.disable()},b.prototype.resumeGame=function(){this.gameControls.enable()},b.prototype.quitGame=function(){this.loseGame()},b.prototype.loseGame=function(){var a=this;this.world.victoryAnimationRequested||this.gameLost||(this.gameLost=!0,this.canvas.gameOver(),setTimeout(function(){return a.gameOverComplete()},2500),sound.playGameOver())},b.prototype.gameOverComplete=function(){this.stopGame(),this.onGameOver()},b.prototype.tap=function(a,b){var c=this.world.grid.getCellByPixels(a,b);
c&&this.canvas.tutorialCanvas.checkPoint(c.xCenter,c.yCenter)&&this.world.requestTap(c)},b.prototype.onMoveStarted=function(){console.log("Move started"),this.world.score>=this.nextLevelGoal&&this.nextLevel(),this.tutorial.nextStep()},b.prototype.onGameStarted=function(){console.log("Game started"),this.tutorial=a.createTutorial(this.level,this.canvas.tutorialCanvas),this.onWorldUpdate()},b.prototype.onMoveComplete=function(){console.log("Move complete"),this.onWorldUpdate()},b.prototype.onWorldUpdate=function(){this.world.checkNoMovesLeft()&&this.loseGame()},b.prototype.handleTick=function(a){if(!pause.isPaused()){var b=a.params[0],c=b.delta;this.world.animate(c)}},b.prototype.nextLevel=function(){var b=this;this.canvas.messages.showLevelCompleteMessage(),sound.playLevelComplete(),this.world.winGame(),this.tutorial.gameComplete(),setTimeout(function(){storage.recordLevelComplete(b.level,b.world.score),resources.config.api&&resources.config.api.levelComplete(b.world.score,b.level),b.startLevel(b.level+1),b.canvas.hud.setLevelProgress(b.level,b.nextLevelGoal,a.getLevelRandIndex(b.level),!0)},3500)},b.prototype.startLevel=function(b){this.level=b,this.dropStrategy.setLevel(b),this.nextLevelGoal=a.getLevelScoreTarget(this.world.score,this.level);var c=a.predefinedLevelLayout[this.level];this.world.bombBonusEnabled=this.level>=3,this.world.refillBonusEnabled=this.level>=2,this.world.startGame(null==c,c)},b.prototype.onGameOver=function(){},b.DROP_SCORE_INTERVAL=50,b}();a.Game=b;var c=function(){function a(a){this.game=a}return a.prototype.enable=function(){var a=this;if(!this.onStageMouseDownHandler){var b=this.game.canvas.getStage();this.onStageMouseDownHandler=function(b){return a.onMouseDown(b)},this.onStageMouseMoveHandler=function(b){return a.onMouseMove(b)},this.onStageMouseUpHandler=function(b){return a.onMouseUp(b)},b.addEventListener("stagemousedown",this.onStageMouseDownHandler),b.addEventListener("stagemousemove",this.onStageMouseMoveHandler),b.addEventListener("stagemouseup",this.onStageMouseUpHandler)}},a.prototype.disable=function(){if(this.onStageMouseDownHandler){var a=this.game.canvas.getStage();a.removeEventListener("stagemousedown",this.onStageMouseDownHandler),a.removeEventListener("stagemousemove",this.onStageMouseMoveHandler),a.removeEventListener("stagemouseup",this.onStageMouseUpHandler),this.onStageMouseDownHandler=null,this.onStageMouseUpHandler=null}},a.prototype.onMouseDown=function(){},a.prototype.onMouseMove=function(a){var b=resources.gameplayRectangle,c=this.game.world.grid.getCellByPixels(b.toLocalX(a.stageX),b.toLocalY(a.stageY));document.body.style.cursor=c&&c.gameShape?"pointer":"auto"},a.prototype.onMouseUp=function(a){var b=resources.gameplayRectangle;this.game.tap(b.toLocalX(a.stageX),b.toLocalY(a.stageY))},a}()}(game||(game={}));var ui;!function(a){var b=function(){function a(a){var b=this;this.mainMenu=new c,this.game=new game.Game,this.gameOver=new d,this.credits=new e,this.restartDialog=new f,this.uiContainer=a,this.mainMenu.onStartGame=function(){return b.startGame()},this.game.onGameOver=function(){return b.showGameOver()},this.gameOver.onRetry=function(){return b.startGame()},this.gameOver.onQuit=function(){return b.showMenu()},this.mainMenu.onShowCredits=function(){return b.showCredits()},this.mainMenu.onResetProgress=function(){return b.requestResetProgress()},this.credits.onQuit=function(){return b.showMenu()},this.restartDialog.onRestart=function(){return b.resetProgress()},this.restartDialog.onQuit=function(){return b.showMenu()},pause.initialize(a,this.game)}return a.prototype.showUI=function(){this.showMenu(),controls.showSplashScreen(this.uiContainer)},a.prototype.showMenu=function(){this.clear(),this.uiContainer.addChild(this.mainMenu),this.mainMenu.show()},a.prototype.startGame=function(){this.clear(),this.uiContainer.addChild(this.game.canvas),this.game.startGame(),sound.playMusic(!0),resources.config.api&&resources.config.api.gameStarted()},a.prototype.showGameOver=function(){this.clear(),this.uiContainer.addChild(this.gameOver),this.gameOver.show(this.game.world.score,this.game.nextLevelGoal),resources.config.api&&resources.config.api.gameLost(this.game.world.score,this.game.level),storage.recordScore(this.game.world.score)},a.prototype.requestResetProgress=function(){return storage.isGameProgressRecorded()?(this.clear(),this.uiContainer.addChild(this.restartDialog),this.restartDialog.show(),void 0):(this.startGame(),void 0)},a.prototype.resetProgress=function(){storage.resetProgress(),this.startGame()},a.prototype.showCredits=function(){this.clear(),this.uiContainer.addChild(this.credits),this.credits.show()},a.prototype.clear=function(){this.uiContainer.removeAllChildren(),this.game.stopGame()},a}();a.Controller=b;var c=function(a){function b(){var b=this;a.call(this);var c=controls.createBackgroundBitmap("mainmenu_bg");this.addChild(c);var d=new createjs.Bitmap(resources.get("game_title"));d.name="GameTitle",this.addChild(d),soundControls.createSoundFXButton(this,"SoundFXButton"),soundControls.createMusicButton(this,"MusicButton");var e=controls.createIconButton(this,"PlayButton",function(){return b.onStartGame()});controls.addDefaultButtonAnimation(e),controls.createIconButton(this,"CreditsButton",function(){return b.onShowCredits()}),this.resetProgressButton=controls.createIconButton(this,"ResetProgressButton",function(){return b.onResetProgress()}),resources.config.portal&&(controls.createMoreGamesButton(this),controls.createSponsorLogo(this))}return __extends(b,a),b.prototype.show=function(){controls.readLayout(this,resources.config.portal?resources.layout.SponsorTitleScreen:resources.layout.TitleScreen),controls.bounceButton(this,"PlayButton",100,600),controls.bounceButton(this,"MoreGamesButton",300,600),controls.bounceButton(this,"CreditsButton",300,600),controls.bounceButton(this,"ResetProgressButton",500,600),controls.bounceButton(this,"SoundFXButton",100,-100),controls.bounceButton(this,"MusicButton",150,-100);var a=this.getChildByName("GameTitle");a.alpha=0,createjs.Tween.get(a).to({alpha:1},300)},b.prototype.onStartGame=function(){},b.prototype.onShowCredits=function(){},b.prototype.onResetProgress=function(){},b}(createjs.Container),d=function(a){function b(){var b=this;a.call(this),this.chainIndex=0;var c=controls.createBackgroundBitmap("game_bg");this.addChild(c),controls.createStaticImage(this,"GameOverTitle");var d=new createjs.BitmapText("",resources.spritesheet);d.name="ScoreText",d.letterSpacing=-7,d.spaceWidth=9,this.scoreText=d,this.addChild(this.scoreText);var e=new createjs.BitmapText("",resources.spritesheet);e.name="BestScoreText",e.letterSpacing=-7,e.spaceWidth=9,this.goalText=e,this.addChild(this.goalText);var f=controls.createIconButton(this,"RestartButton",function(){return b.onRetry()});controls.addDefaultButtonAnimation(f),controls.createIconButton(this,"QuitButton",function(){return b.onQuit()}),controls.createStaticImage(this,"QuitLabel"),controls.createStaticImage(this,"PlayAgainLabel"),resources.config.portal?(controls.createMoreGamesButton(this),controls.createSponsorLogo(this),controls.readLayout(this,resources.layout.SponsorGameOverScreen)):controls.readLayout(this,resources.layout.GameOverScreen);var g=new createjs.Text(resources.getMessage("tip"),"bold 20px arial, helvetica, sans-serif","#1d2a44");g.x=320,g.y=670,g.textAlign="center",this.addChild(g)}return __extends(b,a),b.prototype.setChainImage=function(){resources.config.portal||(this.hugeChain&&this.removeChild(this.hugeChain),this.hugeChain=uiComponents.createCompositeImage(resources.spritesheet,b.chainDefs[this.chainIndex%b.chainDefs.length]),this.hugeChain.scaleX=this.hugeChain.scaleY=.6,this.hugeChain.x=320,this.hugeChain.y=600,this.addChild(this.hugeChain),this.chainIndex++)},b.prototype.show=function(a,b){var c=this;this.setChainImage(),this.score=0,createjs.Tween.get(this).to({score:a},2500).addEventListener("change",function(){return c.updateText()}),this.goalText.text="G"+strings.padScore(Math.floor(b)),controls.bounceButton(this,"GameOverTitle",0,0),controls.bounceButton(this,"RestartButton",400,500,"PlayAgainLabel"),controls.bounceButton(this,"QuitButton",500,500,"QuitLabel"),controls.bounceButton(this,"MoreGamesButton",300,600)},b.prototype.onRetry=function(){},b.prototype.onQuit=function(){},b.prototype.updateText=function(){this.scoreText.text="S"+strings.padScore(Math.floor(this.score))},b.chainDefs=[resources.layout.GameOverChain1,resources.layout.GameOverChain2,resources.layout.GameOverChain3,resources.layout.GameOverChain4],b}(createjs.Container),e=function(a){function b(){var b=this;a.call(this);var c=controls.createBackgroundBitmap("mainmenu_bg");this.addChild(c);var d=controls.getFullScreenWipeImage();this.addChild(d),this.wipeImage=d;var e=controls.createFullScreenContainer(this);this.screenContainer=e;var f=controls.createIconButton(e,"PlayButton",function(){return b.onQuit()});f.scaleX=.7,f.scaleY=.7,this.textY=30;var g=resources.config.coldUrlDisabled,h=g?"http://www.1758.com 2014":"1758微游戏，即点即玩";this.addTitle(h,"http://www.1758.com"),this.addTitle("官方微信号：wx1758com","mailto:hezuo@1758.com"),controls.readLayout(e,resources.layout.CreditsScreen)}return __extends(b,a),b.prototype.show=function(){var a=this.wipeImage;a.alpha=0,createjs.Tween.get(a).to({alpha:.8},1e3,createjs.Ease.quartOut);var b=this.screenContainer;b.scaleX=b.scaleY=.7,createjs.Tween.get(b).to({scaleX:1,scaleY:1},1e3,createjs.Ease.getElasticOut(1,.5))},b.prototype.onQuit=function(){},b.prototype.addTitle=function(a,b){this.textY+=15;var c=10,d=new createjs.Text(a,"bold 32px arial, helvetica, sans-serif","#300030");d.x=320,d.y=this.textY,d.textAlign="center",d.hitArea=new createjs.Shape((new createjs.Graphics).beginFill("#000000").drawRect(-c,-c,d.getMeasuredWidth()+2*c,d.getMeasuredHeight()+2*c)),this.screenContainer.addChild(d);var e=d.getMeasuredWidth(),f=100;d.cache(-e/2,-f/2,e,f),this.textY+=45,this.addURLHandler(d,b)},b.prototype.addEntry=function(a,b){var c=10,d=new createjs.Text(a,"bold 25px arial, helvetica, sans-serif","#300030");d.x=320,d.y=this.textY,d.lineWidth=640,d.textAlign="center",d.hitArea=new createjs.Shape((new createjs.Graphics).beginFill("#000000").drawRect(-c,-c,d.getMeasuredWidth()+2*c,d.getMeasuredHeight()+2*c)),this.screenContainer.addChild(d);var e=d.lineWidth,f=100;d.cache(-e/2,-f/2,e,f),this.textY+=45,this.addURLHandler(d,b)},b.prototype.addURLHandler=function(a,b){if(""!=b){var c=resources.config.hotUrlDisabled;c||a.addEventListener("click",function(){return window.open(b)})}},b}(createjs.Container),f=function(a){function b(){var b=this;a.call(this);var c=controls.createBackgroundBitmap("mainmenu_bg");this.addChild(c);var d=controls.getFullScreenWipeImage();this.addChild(d),this.wipeImage=d;var e=new createjs.Text(resources.getMessage("restartConfirm"),"bold 32px arial, helvetica, sans-serif","#");e.x=320,e.y=200,e.textAlign="center",this.addChild(e),controls.createIconButton(this,"RestartButton",function(){return b.onRestart()}),controls.createIconButton(this,"QuitButton",function(){return b.onQuit()}),controls.readLayout(this,resources.layout.ResetDialog)}return __extends(b,a),b.prototype.show=function(){var a=this.wipeImage;a.alpha=0,createjs.Tween.get(a).to({alpha:.8},1e3,createjs.Ease.quartOut)},b.prototype.onRestart=function(){},b.prototype.onQuit=function(){},b}(createjs.Container)}(ui||(ui={}));var viewporter,main;!function(a){function b(b,d,f){resources.config=f,a.canvas=b,a.stage=new createjs.Stage(a.canvas),a.stage.autoClear=!1;var g="ontouchstart"in window||navigator.msMaxTouchPoints>0;g||a.stage.enableMouseOver(15),createjs.Touch.enable(a.stage),resources.gameplayRectangle=new resources.GameplayRectangle(0,124,640,712),resources.preloadGameAssets(c,d),viewporter&&viewporter.ACTIVE?(window.addEventListener("viewportready",e,!1),window.addEventListener("viewportchange",e,!1)):window.addEventListener("resize",e,!1),e()}function c(){storage.initialize(a.gameId),controls.initialize(a.canvas.width,a.canvas.height);var b=new createjs.Container;a.stage.addChild(b),b.y=124,a.uiController=new ui.Controller(b),a.uiController.showUI(),a.stage.update(),createjs.Ticker.setFPS(30),createjs.Ticker.useRAF=!0,createjs.Ticker.addEventListener("tick",d),sound.playMusic(!1)}function d(b){a.stage.update(b)}function e(){var b=window.innerWidth,c=window.innerHeight;if(viewporter&&viewporter.ACTIVE){var d=document.getElementById("portraitLock"),e=b>c;e&&640>=b?(d.style.display="block",a.canvas.style.display="none"):(d.style.display="none",a.canvas.style.display="block")}if(f!==b||g!==c){f=b,g=c;var h=a.canvas.width,i=a.canvas.height,j=resources.gameplayRectangle.height,k=b/h,l=c/j,m=Math.min(k,l);"?fixed"==window.location.search&&(m=1);var n=h*m,o=i*m;a.canvas.style.width=n+"px",a.canvas.style.height=o+"px";var p=(c-o)/2,q=a.canvas.parentElement;0>p?(a.canvas.style.top=p+"px",q.style.height=o+2*p+"px"):(a.canvas.style.top="0px",q.style.height=o+"px"),q.style.width=n+"px";var r=(b-n)/2;q.style.left=r+"px",q.style.top=p>0?p+"px":"0px"}}a.canvas,a.stage,a.uiController,a.gameId="com.jellimatic.JellyCollapse",a.portraitLock=null,a.initialize=b;var f=-1,g=-1}(main||(main={}));
